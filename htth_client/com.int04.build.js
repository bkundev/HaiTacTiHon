(()=>{"use strict";const e=(e,t,i)=>{let n=e.box,h=n.w,a=n.h,l=.9*a,o=.2*h;o=o>50?50:o;let d=new PIXI.Graphics;d.beginFill(0,1e-10),d.drawRect(0,0,o,l),d.endFill(),d.interactive=!0,d.x=(e.gameWidth-h)/2,d.y=(e.gameHeight-a)/2+.1*a,n.addChild(d),d.alpha=0,new TWEEN.Tween(d).to({alpha:1},500).start();let r="";t.forEach(((t,n)=>{let h=t[0],a=t[1],l=t[2],o=t[3],s=t[4],c=.2*d.height;c=c>48?48:c;let g=new PIXI.Sprite(e.coverImg(h));if(g.x=0,g.y=0+n*(c+5),g.width=c,g.height=c,g.interactive=!0,g.cursor="help",d.addChild(g),a==i){r=l;let e=new PIXI.Graphics;e.beginFill(16755200,.8),e.drawCircle(0,0,c/2),e.endFill(),e.x=g.x+c/2,e.y=g.y+c/2,d.addChild(e)}let p=0;g.on("pointerdown",(()=>{p=Date.now()})),g.on("pointerup",(()=>{Date.now()-p<200&&s(e,o)}))}));let s=h-o,c=new PIXI.Graphics;c.beginFill(16311469,1),c.drawRect(0,0,s,l),c.endFill(),c.interactive=!0,c.x=(e.gameWidth-h)/2+o,c.y=(e.gameHeight-a)/2+.1*a,n.addChild(c),c.name="body";let g=new PIXI.Graphics;g.beginFill(15906382,1),g.drawRect(0,0,s,.1*a),g.endFill(),g.interactive=!0,n.addChild(g),g.x=(e.gameWidth-h)/2+h-s,g.y=0,new TWEEN.Tween(g).to({y:(e.gameHeight-a)/2},500).easing(TWEEN.Easing.Back.Out).start();let p=new PIXI.Text(r,{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center"});p.x=g.width/2-p.width/2,p.y=g.height/2-p.height/2,g.addChild(p);let m=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_point_closetab.png")),w=[];for(let e=0;e<2;e++){let t=new PIXI.Texture(m.texture,new PIXI.Rectangle(0,36*e,36,36));w.push(t)}let u=new PIXI.AnimatedSprite(w);u.anchor.set(.5),u.name="buttonclose",u.x=0,u.y=g.height/2,u.animationSpeed=.1,u.loop=!1,u.interactive=!0,u.cursor="pointer";let y=0;u.on("pointerdown",(()=>{y=Date.now()})),u.on("pointerup",(()=>{Date.now()-y<200&&(u.play(),e.closeBox())})),g.addChild(u),new TWEEN.Tween(u).to({x:g.width-u.width/2},1e3).easing(TWEEN.Easing.Back.Out).start()},t=(i,h)=>{let a=i.cache.idShop.find((e=>e[0]===h));if(!a)return i.chipi("Không tìm thấy danh mục cửa hàng");a[1],i.backGroundBox(),e(i,[[9209,"shop","Cửa hàng",h,n],[9200,"hanhtrang","Hành trang",h,t]],"hanhtrang");let l=i.box.getChildByName("body"),o=new PIXI.Container;o.name="container";let d=new PIXI.Graphics;d.beginFill(0,.5),d.drawRect(0,0,l.width,l.height),d.endFill(),o.mask=d,l.addChild(d);let r=i.my.ruong.data.filter((e=>"hanhtrang"===e.active));if(r.sort(((e,t)=>e.time-t.time)),l){let e=i.my.ruong.max,t=.2*l.width;t=t>48?48:t;let n=t,h=2,a=2,d=Math.floor(l.width/(t+h));for(let l=0;l<e;l++){let e=new PIXI.Graphics;e.beginFill(11440233,.5),e.drawRect(0,0,t,n),e.endFill(),e.x=l%d*(t+h),e.y=Math.floor(l/d)*(n+a),e.interactive=!0,e.keycode="int04",e.cursor="pointer";let s=0;r[l]&&(e.on("pointerdown",(()=>{s=Date.now()})),e.on("pointerup",(()=>{Date.now()-s<200&&i.previewItemBag(e,r[l],"btnShopSell","buy")})),e=i.showItem(e,r[l])),o.addChild(e)}if(o.height<l.height){let e=l.height,t=l.width,i=new PIXI.Graphics;i.beginFill(0,5e-9),i.drawRect(0,0,t,e),i.endFill(),o.addChild(i)}let s=new pixi_viewport.Viewport({screenWidth:l.width,screenHeight:l.height,worldWidth:o.width,worldHeight:o.height});s.name="viewport",s.drag({direction:"y",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),s.bounce({top:!0,bottom:!0,friction:.5,time:3.5,ease:"easeInOutSine"}),s.setZoom(1),s.addChild(o),l.addChild(s);let c=0,g=-1,p=-1,m=-1;s.on("pointerdown",(e=>{c=Date.now()})),s.on("pointerup",(e=>{if(Date.now()-c<200){let t=e.data.global.x,n=e.data.global.y,h=o.toLocal(new PIXI.Point(t,n));h.x=Math.round(h.x),h.y=Math.round(h.y);let a=o.children.filter((e=>"int04"==e.keycode));for(let e=0;e<a.length;e++)a[e].removeChild(a[e].getChildByName("xanhle"));for(let e=0;e<a.length;e++)if(a[e].x<=h.x&&h.x<=a[e].x+a[e].width&&a[e].y<=h.y&&h.y<=a[e].y+a[e].height){let t=a[e].width,n=a[e].height,h=new PIXI.Graphics;h.lineStyle(1,16777215,1),h.beginFill(16318026,1e-6),h.drawRoundedRect(0,0,t,n,0),h.endFill(),h.name="xanhle",a[e].addChild(h);let l=a[e],o=i.findInteractiveObjects(l);o.length>0&&(o[0].emit("pointerdown"),o[0].emit("pointerup")),p=e%d,m=Math.floor(e/d),g=e}}else clearInterval(i.pcSettimeEntactive),setTimeout((function(){clearInterval(i.pcSettimeEntactive),w()}),200)}));let w=()=>{i.pcSettimeEntactive&&clearInterval(i.pcSettimeEntactive),i.pcSettimeEntactive=setInterval((()=>{let e=i.pcKey;if(i.box.children.length<=0)return clearInterval(i.pcSettimeEntactive),!1;let t=o.children.filter((e=>"int04"==e.keycode));if("ArrowUp"==e?-1==m?m=0:m--:"ArrowDown"==e?-1==m?m=0:m++:"ArrowLeft"==e?-1==p?p=0:p--:"ArrowRight"==e&&(-1==p?p=0:p++),g=p>=0&&m>=0?m*d+p:p>=0&&-1==m?p:-1==p&&m>=0?m:-1,"Enter"==e&&g>=0){let e=t[g],n=i.findInteractiveObjects(e);n.length>0&&(n[0].emit("pointerdown"),n[0].emit("pointerup"))}if(t[g]&&i.pcKey.length>=1){for(let e=0;e<t.length;e++)t[e].removeChild(t[e].getChildByName("xanhle"));s.moveCenter(t[g].x,t[g].y);let e=t[g].width,n=t[g].height,h=new PIXI.Graphics;h.lineStyle(1,16777215,1),h.beginFill(16318026,1e-9),h.drawRoundedRect(0,0,e,n,0),h.endFill(),h.name="xanhle",t[g].addChild(h);let a=t[g],l=i.findInteractiveObjects(a);l.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{l[0].emit("pointerdown")})),h.on("pointerup",(()=>{l[0].emit("pointerup")})))}i.pcKey=""}),30)};w()}},i=(n,h)=>{let a=n.cache.idShop.find((e=>e[0]===h));if(!a)return n.chipi("Không tìm thấy danh mục cửa hàng");let l=a[1],o=(n.backGroundBox(),e(n,[[9209,"shop","Cửa hàng",h,i],[9200,"hanhtrang","Hành trang",h,t]],"shop"),n.box.getChildByName("body")),d=new PIXI.Container;d.name="container";let r=new PIXI.Graphics;r.beginFill(0,.5),r.drawRect(0,0,o.width,o.height),r.endFill(),d.mask=r,o.addChild(r),n.my;let s=[];if(l.forEach((e=>{s.push({id:e,item:e,soluong:1})})),o){let e=s.length+10,t=.2*o.width;t=t>48?48:t;let i=t,h=2,a=2,l=Math.floor(o.width/(t+h));for(let o=0;o<e;o++){let e=new PIXI.Graphics;e.beginFill(11440233,.5),e.drawRect(0,0,t,i),e.endFill(),e.x=o%l*(t+h),e.y=Math.floor(o/l)*(i+a),e.interactive=!0,e.keycode="int04",e.cursor="pointer";let r=0;s[o]&&(e.on("pointerdown",(()=>{r=Date.now()})),e.on("pointerup",(()=>{Date.now()-r<200&&n.previewItemBag(e,s[o],"btn_shop","buy")})),e=n.showItem(e,s[o])),d.addChild(e)}if(d.height<o.height){let e=o.height,t=o.width,i=new PIXI.Graphics;i.beginFill(0,5e-9),i.drawRect(0,0,t,e),i.endFill(),d.addChild(i)}let r=new pixi_viewport.Viewport({screenWidth:o.width,screenHeight:o.height,worldWidth:d.width,worldHeight:d.height});r.name="viewport",r.drag({direction:"y",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),r.bounce({top:!0,bottom:!0,friction:.5,time:3.5,ease:"easeInOutSine"}),r.setZoom(1),r.addChild(d),o.addChild(r);let c=0,g=-1,p=-1,m=-1;r.on("pointerdown",(e=>{c=Date.now()})),r.on("pointerup",(e=>{if(Date.now()-c<200){let t=e.data.global.x,i=e.data.global.y,h=d.toLocal(new PIXI.Point(t,i));h.x=Math.round(h.x),h.y=Math.round(h.y);let a=d.children.filter((e=>"int04"==e.keycode));for(let e=0;e<a.length;e++)a[e].removeChild(a[e].getChildByName("xanhle"));for(let e=0;e<a.length;e++)if(a[e].x<=h.x&&h.x<=a[e].x+a[e].width&&a[e].y<=h.y&&h.y<=a[e].y+a[e].height){let t=a[e].width,i=a[e].height,h=new PIXI.Graphics;h.lineStyle(1,16777215,1),h.beginFill(16318026,1e-6),h.drawRoundedRect(0,0,t,i,0),h.endFill(),h.name="xanhle",a[e].addChild(h);let o=a[e],d=n.findInteractiveObjects(o);d.length>0&&(d[0].emit("pointerdown"),d[0].emit("pointerup")),p=e%l,m=Math.floor(e/l),g=e}}else clearInterval(n.pcSettimeEntactive),setTimeout((function(){clearInterval(n.pcSettimeEntactive),w()}),200)}));let w=()=>{n.pcSettimeEntactive&&clearInterval(n.pcSettimeEntactive),n.pcSettimeEntactive=setInterval((()=>{let e=n.pcKey;if(n.box.children.length<=0)return clearInterval(n.pcSettimeEntactive),!1;let t=d.children.filter((e=>"int04"==e.keycode));if("ArrowUp"==e?-1==m?m=0:m--:"ArrowDown"==e?-1==m?m=0:m++:"ArrowLeft"==e?-1==p?p=0:p--:"ArrowRight"==e&&(-1==p?p=0:p++),g=p>=0&&m>=0?m*l+p:p>=0&&-1==m?p:-1==p&&m>=0?m:-1,"Enter"==e&&g>=0){let e=t[g],i=n.findInteractiveObjects(e);i.length>0&&(i[0].emit("pointerdown"),i[0].emit("pointerup"))}if(t[g]&&n.pcKey.length>=1){for(let e=0;e<t.length;e++)t[e].removeChild(t[e].getChildByName("xanhle"));r.moveCenter(t[g].x,t[g].y);let e=t[g].width,i=t[g].height,h=new PIXI.Graphics;h.lineStyle(1,16777215,1),h.beginFill(16318026,1e-9),h.drawRoundedRect(0,0,e,i,0),h.endFill(),h.name="xanhle",t[g].addChild(h);let a=t[g],l=n.findInteractiveObjects(a);l.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{l[0].emit("pointerdown")})),h.on("pointerup",(()=>{l[0].emit("pointerup")})))}n.pcKey=""}),30)};w()}},n=(e,t)=>{console.log("open"),i(e,t)},h=(e,t,i=1)=>{if((i=+i)<0)return!1;if(i>999999)return(void 0).chipi("Số lượng mua không hợp lệ");let n=e.cache.costShop.find((e=>e[0]==t));n||e.chipi("Không tìm thấy vật phẩm này");let h=n[1],a=(n[2],n[3]),l=e.my;if(!h||h<=0)return e.chipi("Vật phẩm này không thể mua");if(!(l&&l.tien&&l.tien.beri&&l.tien.ruby))return e.chipi("Tài khoản bạn không có đủ tiền để thực hiện.");let o=l.tien;return 1===a&&o.beri<h*i?e.chipi("Bạn không đủ Beri"):2===a&&o.ruby<h*i?e.chipi("Bạn không đủ Ruby"):(e.send(-8,[1,t,i]),e.wait(e._("Xin chờ,...")))};let a=(e,t,i=0)=>((e,t,i)=>{let n=(e,n="")=>{e.closeInput();let h=parseInt(n);h>0&&i(e,t,h)},h=.8*e.gameWidth,a=.5*e.gameHeight;h=h>500?500:h,a=a>300?300:a;let l=new PIXI.Graphics;l.beginFill(8744014,1),l.lineStyle(2,6966058,1),l.drawRect(0,0,h,a),l.endFill(),l.x=(e.gameWidth-h)/2,l.y=.7*(e.gameHeight-a),e.input.addChild(l);let o=e.div(l,8744014,[.99,.3]);o.alpha=1;let d=e.div(o,15906382,[.8,.5]);d.x=(o.width-d.width)/2,d.y=(o.height-d.height)/2,d.alpha=1;let r=new PIXI.Text(e._("Mua vật phẩm"),{fontFamily:"Arial",fontSize:16,fill:16777215,align:"center"});r.x=(d.width-r.width)/2,r.y=(d.height-r.height)/2,d.addChild(r);let s=e.animation("x2Main_Image_point_closetab",36,72,2);s.animationSpeed=1,s.loop=!1,s.width=d.width>36?36:d.width,s.height=d.height>36?36:d.height,d.addChild(s),s.x=d.width-s.width/2,s.y=d.height/2-s.height/2,s.interactive=!0,s.cursor="pointer";let c=0;s.on("pointerdown",(function(){c=Date.now(),s.gotoAndStop(1)})),s.on("pointerup",(function(){s.gotoAndStop(0),Date.now()-c<200&&n(e)}));let g=e.div(l,8744014,[.99,.7]);g.alpha=1,g.y=o.height;let p=new PIXI.Container;g.addChild(p);let m=new PIXI.Text(e._("Nhập số lượng cần mua:"),{fontFamily:"Arial",fontSize:16,fill:16777215,align:"center"});p.addChild(m);let w=new PIXI.TextInput({input:{fontSize:"17px",padding:"10px",color:"#7a1125",width:.8*g.width,height:e.max(.5*(g.height-m.height),50)},box:{default:{fill:15647621,rounded:0,stroke:{color:16774891,width:1}},focused:{fill:11006636,rounded:0,stroke:{color:16774891,width:1}},disabled:{fill:14408667,rounded:0}}});w.restrict="0123456789",w.placeholder="Số lượng",w.y=m.height+10,p.addChild(w);let u=()=>{w.blur(),n(e,w.text),w.text=""};setTimeout((()=>{w.focus()}),200),w.on("keyup",(e=>{13===e&&u()})),p.x=(g.width-p.width)/2,p.y=(g.height-p.height)/2;let y=e.div(l,8810843,[.5,.3],[100,50]);y.alpha=1,y.y=l.height,y.x=(l.width-y.width)/2;let f=new PIXI.Text(e._("OK"),{fontFamily:"Arial",fontSize:16,fill:16777215,align:"center"});f.x=(y.width-f.width)/2,f.y=(y.height-f.height)/2,y.addChild(f),y.interactive=!0,y.cursor="pointer",y.on("pointerdown",(function(){u()}))})(e,t,h);const l=(e,t,i=1)=>{let n=e.my;if(n.id<=0)return!1;let h=n.ruong.data.find((e=>e.id==t&&"hanhtrang"===e.active));if(!h)return!1;let a=e.item.find((e=>e.id==h.item));if(!a)return e.chipi(e._("Không tìm thấy vật phẩm"));let l=e.cache.costShop.find((e=>e[0]==h.item));if(!l)return e.chipi(e._("Vật phẩm này không thể bán"));if(-999===i&&(i=h.soluong),(i=i<0?1:i)>h.soluong)return e.chipi(e._("Bạn không có đủ vật phẩm để bán"));let o=l[2]*i,d=l[3];e.confirm("Bạn có muốn bán x"+i+" "+a.name+" với giá "+o+" "+(1===d?"Beri":"Ruby Không ?"),(()=>{((e,t,i=1)=>{let n=e.my;if(n.id<=0)return!1;let h=n.ruong.data.find((e=>e.id==t&&"hanhtrang"===e.active));if(!h)return!1;let a=e.item.find((e=>e.id==h.item));if(!a)return e.chipi(e._("Không tìm thấy vật phẩm"));let l=e.cache.costShop.find((e=>e[0]==h.item));l?(-999===i&&(i=h.soluong),(i=i<0?1:i)>h.soluong?e.chipi(e._("Bạn không có đủ vật phẩm để bán")):(e.send(-8,[2,t,i]),e.wait(e._("Xin chờ,...")))):e.chipi(e._("Vật phẩm này không thể bán"))})(e,t,i)}),(()=>{}))};var o={};function d(e,t,i){for(var n=0,h=0,a=i.length;h<a;h++)(n=i.charCodeAt(h))<128?e.setUint8(t++,n):n<2048?(e.setUint8(t++,192|n>>6),e.setUint8(t++,128|63&n)):n<55296||n>=57344?(e.setUint8(t++,224|n>>12),e.setUint8(t++,128|n>>6&63),e.setUint8(t++,128|63&n)):(h++,n=65536+((1023&n)<<10|1023&i.charCodeAt(h)),e.setUint8(t++,240|n>>18),e.setUint8(t++,128|n>>12&63),e.setUint8(t++,128|n>>6&63),e.setUint8(t++,128|63&n))}function r(e,t,i){var n=typeof i,h=0,a=0,l=0,o=0,d=0,s=0;if("string"===n){if(d=function(e){for(var t=0,i=0,n=0,h=e.length;n<h;n++)(t=e.charCodeAt(n))<128?i+=1:t<2048?i+=2:t<55296||t>=57344?i+=3:(n++,i+=4);return i}(i),d<32)e.push(160|d),s=1;else if(d<256)e.push(217,d),s=2;else if(d<65536)e.push(218,d>>8,d),s=3;else{if(!(d<4294967296))throw new Error("String too long");e.push(219,d>>24,d>>16,d>>8,d),s=5}return t.push({_str:i,_length:d,_offset:e.length}),s+d}if("number"===n)return Math.floor(i)===i&&isFinite(i)?i>=0?i<128?(e.push(i),1):i<256?(e.push(204,i),2):i<65536?(e.push(205,i>>8,i),3):i<4294967296?(e.push(206,i>>24,i>>16,i>>8,i),5):(l=i/Math.pow(2,32)>>0,o=i>>>0,e.push(207,l>>24,l>>16,l>>8,l,o>>24,o>>16,o>>8,o),9):i>=-32?(e.push(i),1):i>=-128?(e.push(208,i),2):i>=-32768?(e.push(209,i>>8,i),3):i>=-2147483648?(e.push(210,i>>24,i>>16,i>>8,i),5):(l=Math.floor(i/Math.pow(2,32)),o=i>>>0,e.push(211,l>>24,l>>16,l>>8,l,o>>24,o>>16,o>>8,o),9):(e.push(203),t.push({_float:i,_length:8,_offset:e.length}),9);if("object"===n){if(null===i)return e.push(192),1;if(Array.isArray(i)){if((d=i.length)<16)e.push(144|d),s=1;else if(d<65536)e.push(220,d>>8,d),s=3;else{if(!(d<4294967296))throw new Error("Array too large");e.push(221,d>>24,d>>16,d>>8,d),s=5}for(h=0;h<d;h++)s+=r(e,t,i[h]);return s}if(i instanceof Date){var c=i.getTime();return l=Math.floor(c/Math.pow(2,32)),o=c>>>0,e.push(215,0,l>>24,l>>16,l>>8,l,o>>24,o>>16,o>>8,o),10}if(i instanceof ArrayBuffer){if((d=i.byteLength)<256)e.push(196,d),s=2;else if(d<65536)e.push(197,d>>8,d),s=3;else{if(!(d<4294967296))throw new Error("Buffer too large");e.push(198,d>>24,d>>16,d>>8,d),s=5}return t.push({_bin:i,_length:d,_offset:e.length}),s+d}if("function"==typeof i.toJSON)return r(e,t,i.toJSON());var g=[],p="",m=Object.keys(i);for(h=0,a=m.length;h<a;h++)"function"!=typeof i[p=m[h]]&&g.push(p);if((d=g.length)<16)e.push(128|d),s=1;else if(d<65536)e.push(222,d>>8,d),s=3;else{if(!(d<4294967296))throw new Error("Object too large");e.push(223,d>>24,d>>16,d>>8,d),s=5}for(h=0;h<d;h++)s+=r(e,t,p=g[h]),s+=r(e,t,i[p]);return s}if("boolean"===n)return e.push(i?195:194),1;if("undefined"===n)return e.push(212,0,0),3;throw new Error("Could not encode")}function s(e){if(this._offset=0,e instanceof ArrayBuffer)this._buffer=e,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer,this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}s.prototype._array=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=this._parse();return t},s.prototype._map=function(e){for(var t={},i=0;i<e;i++)t[this._parse()]=this._parse();return t},s.prototype._str=function(e){var t=function(e,t,i){for(var n="",h=0,a=t,l=t+i;a<l;a++){var o=e.getUint8(a);if(0!=(128&o))if(192!=(224&o))if(224!=(240&o)){if(240!=(248&o))throw new Error("Invalid byte "+o.toString(16));(h=(7&o)<<18|(63&e.getUint8(++a))<<12|(63&e.getUint8(++a))<<6|(63&e.getUint8(++a))<<0)>=65536?(h-=65536,n+=String.fromCharCode(55296+(h>>>10),56320+(1023&h))):n+=String.fromCharCode(h)}else n+=String.fromCharCode((15&o)<<12|(63&e.getUint8(++a))<<6|(63&e.getUint8(++a))<<0);else n+=String.fromCharCode((31&o)<<6|63&e.getUint8(++a));else n+=String.fromCharCode(o)}return n}(this._view,this._offset,e);return this._offset+=e,t},s.prototype._bin=function(e){var t=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,t},s.prototype._parse=function(){var e,t=this._view.getUint8(this._offset++),i=0,n=0,h=0,a=0;if(t<192)return t<128?t:t<144?this._map(15&t):t<160?this._array(15&t):this._str(31&t);if(t>223)return-1*(255-t+1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return i=this._view.getUint8(this._offset),this._offset+=1,this._bin(i);case 197:return i=this._view.getUint16(this._offset),this._offset+=2,this._bin(i);case 198:return i=this._view.getUint32(this._offset),this._offset+=4,this._bin(i);case 199:return i=this._view.getUint8(this._offset),n=this._view.getInt8(this._offset+1),this._offset+=2,[n,this._bin(i)];case 200:return i=this._view.getUint16(this._offset),n=this._view.getInt8(this._offset+2),this._offset+=3,[n,this._bin(i)];case 201:return i=this._view.getUint32(this._offset),n=this._view.getInt8(this._offset+4),this._offset+=5,[n,this._bin(i)];case 202:return e=this._view.getFloat32(this._offset),this._offset+=4,e;case 203:return e=this._view.getFloat64(this._offset),this._offset+=8,e;case 204:return e=this._view.getUint8(this._offset),this._offset+=1,e;case 205:return e=this._view.getUint16(this._offset),this._offset+=2,e;case 206:return e=this._view.getUint32(this._offset),this._offset+=4,e;case 207:return h=this._view.getUint32(this._offset)*Math.pow(2,32),a=this._view.getUint32(this._offset+4),this._offset+=8,h+a;case 208:return e=this._view.getInt8(this._offset),this._offset+=1,e;case 209:return e=this._view.getInt16(this._offset),this._offset+=2,e;case 210:return e=this._view.getInt32(this._offset),this._offset+=4,e;case 211:return h=this._view.getInt32(this._offset)*Math.pow(2,32),a=this._view.getUint32(this._offset+4),this._offset+=8,h+a;case 212:return n=this._view.getInt8(this._offset),this._offset+=1,0===n?void(this._offset+=1):[n,this._bin(1)];case 213:return n=this._view.getInt8(this._offset),this._offset+=1,[n,this._bin(2)];case 214:return n=this._view.getInt8(this._offset),this._offset+=1,[n,this._bin(4)];case 215:return n=this._view.getInt8(this._offset),this._offset+=1,0===n?(h=this._view.getInt32(this._offset)*Math.pow(2,32),a=this._view.getUint32(this._offset+4),this._offset+=8,new Date(h+a)):[n,this._bin(8)];case 216:return n=this._view.getInt8(this._offset),this._offset+=1,[n,this._bin(16)];case 217:return i=this._view.getUint8(this._offset),this._offset+=1,this._str(i);case 218:return i=this._view.getUint16(this._offset),this._offset+=2,this._str(i);case 219:return i=this._view.getUint32(this._offset),this._offset+=4,this._str(i);case 220:return i=this._view.getUint16(this._offset),this._offset+=2,this._array(i);case 221:return i=this._view.getUint32(this._offset),this._offset+=4,this._array(i);case 222:return i=this._view.getUint16(this._offset),this._offset+=2,this._map(i);case 223:return i=this._view.getUint32(this._offset),this._offset+=4,this._map(i)}throw new Error("Could not parse")},o.encode=function(e){var t=[],i=[],n=r(t,i,e),h=new ArrayBuffer(n),a=new DataView(h),l=0,o=0,s=-1;i.length>0&&(s=i[0]._offset);for(var c,g=0,p=0,m=0,w=t.length;m<w;m++)if(a.setUint8(o+m,t[m]),m+1===s){if(g=(c=i[l])._length,p=o+s,c._bin)for(var u=new Uint8Array(c._bin),y=0;y<g;y++)a.setUint8(p+y,u[y]);else c._str?d(a,p,c._str):void 0!==c._float&&a.setFloat64(p,c._float);o+=g,i[++l]&&(s=i[l]._offset)}return h},o.decode=function(e){var t=new s(e),i=t._parse();if(t._offset!==e.byteLength)throw new Error(e.byteLength-t._offset+" trailing bytes");return i};var c={exports:{}};!function(e){function t(e){if(e)return function(e){for(var i in t.prototype)e[i]=t.prototype[i];return e}(e)}c.exports=t,t.prototype.on=t.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},t.prototype.once=function(e,t){function i(){this.off(e,i),t.apply(this,arguments)}return i.fn=t,this.on(e,i),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var h=0;h<n.length;h++)if((i=n[h])===t||i.fn===t){n.splice(h,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},t.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),i=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(i){n=0;for(var h=(i=i.slice(0)).length;n<h;++n)i[n].apply(this,t)}return this},t.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},t.prototype.hasListeners=function(e){return!!this.listeners(e).length}}();var g=c.exports,p={},m=o,w=g,u=(p.protocol=5,p.PacketType={CONNECT:0,DISCONNECT:1,EVENT:2,ACK:3,CONNECT_ERROR:4}),y=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},f=function(e){return"string"==typeof e},x=function(e){return"[object Object]"===Object.prototype.toString.call(e)};function I(){}function _(){}I.prototype.encode=function(e){return[m.encode(e)]},w(_.prototype),_.prototype.add=function(e){var t=m.decode(e);this.checkPacket(t),this.emit("decoded",t)},_.prototype.checkPacket=function(e){if(!(y(e.type)&&e.type>=u.CONNECT&&e.type<=u.CONNECT_ERROR))throw new Error("invalid packet type");if(!f(e.nsp))throw new Error("invalid namespace");if(!function(e){switch(e.type){case u.CONNECT:return void 0===e.data||x(e.data);case u.DISCONNECT:return void 0===e.data;case u.CONNECT_ERROR:return f(e.data)||x(e.data);default:return Array.isArray(e.data)}}(e))throw new Error("invalid payload");if(void 0!==e.id&&!y(e.id))throw new Error("invalid packet id")},_.prototype.destroy=function(){},p.Encoder=I,p.Decoder=_;class b{constructor(){this.cache={},this.pcSettimeEntactive=null,this.pcKey="",this.click="int04",this.images=[],this.cache_player=[],this.cache_skill=[],this.cache_action=[],this.cache_chat=[],this.item=[],this.skill=[],this.objectMy(),this.tab={},this.expskill=[],this.explevel=[],this.pcSettimeEntactiveY=null,this.auto=!1,this.cache_thong_bao=["trò chơi dành cho người trên 18 tuổi, chơi quá 180 phút sẽ có hại cho sức khỏe."],this.cache_chat_the_gioi=[],this.danh=!1,this.cache_event=[],this.pointer=null,this.listPointer=[],this.listMap=[],this.isGoToZone=!1,this.config={map:0}}deletePointer=e=>{let t=this.listPointer.find((t=>t[0]===e));t&&this.listPointer.splice(this.listPointer.indexOf(t),1)};getPointer=e=>{let t=this.listPointer.find((t=>t[0]===e));return!!t&&t[1]};addPointer=(e,t)=>{let i=this.listPointer.find((t=>t[0]===e));i||this.listPointer.push([e,t]),this.pointer=e};deleteEvent=e=>{let t=this.cache_event.find((t=>t[0]===e));if(t){let e=t[1];clearInterval(e),this.cache_event.splice(this.cache_event.indexOf(t),1)}};objectMy=()=>{this.my={id:0,username:"admin",name:"int04",skin:{dau:"iLvVMIbTpy",ao:"kFFosytneB",quan:"QSHGPlNDTK",toc:"axDwxOtydX",non:"axDwxOtydX",lung:"axDwxOtydX",tay:"axDwxOtydX"},pos:{map:0,zone:0,x:30,y:200},action:{move:"left",action:"dungyen"},info:{chiso:{},coban:{speed:5}},type:"player"}};randomAZ(e){let t="";for(let i=0;i<e;i++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return t}rand(e,t){return Math.floor(Math.random()*(t-e+1))+e}getSprite=e=>{let t=this.getMy(e);return t&&this.player.getChildByName(t.id)||!1};getSpriteItem=e=>this.playerItem.getChildByName(e)||!1;deleteObject=e=>{let t=this.cache_player.find((t=>t.id==e));t&&(this.cache_player.splice(this.cache_player.indexOf(t),1),this.deleteSprite(e))};deleteSprite=e=>{let t=this.player.getChildByName(e);t&&(this.player.removeChild(t),console.log("Xóa"));let i=this.playerItem.getChildByName(e);i&&this.playerItem.removeChild(i)};getMy=e=>{if(e==this.my.id)return this.my;let t=this.cache_player.find((t=>t.id==e));return t||!1};getImg=e=>{let t=this.images.find((t=>t.name==e));return t?t.list:{}};coverImg(e,t="./assets/int04/"){return"number"==typeof e&&(e=e.toString()),PIXI.Texture.from(t+e+".png")}action=(e,t)=>{let i=this.cache_action.find((t=>t.id==e));i?i.action=t:this.cache_action.push({id:e,action:t});let n=this.getMy(e);n&&(n.action.action=t)};getAction=e=>{let t=this.cache_action.find((t=>t.id==e));return!!t&&t.action};ConnectToServer=()=>{this.CallWebsocket(),this.methodWebsocket(),this.createObjectIO(),this.handleData()};CallWebsocket(){this.ws=io(this.gameInfo.server,{transports:["websocket"]})}methodWebsocket(){this.send=function(e,t){t?this.ws.emit(e,t):this.ws.emit(e)},this.to=function(e,t){t?this.send(e,t):this.send(e)}}lang=e=>e;_=e=>this.lang(e);setCookie=(e,t,i=30)=>{let n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);let h="expires="+n.toUTCString();document.cookie=e+"="+t+";"+h+";path=/"};getCookie=e=>{let t=e+"=",i=document.cookie.split(";");for(let e=0;e<i.length;e++){let n=i[e];for(;" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""};countAllChild=e=>{let t=0;return Date.now(),e.children.length>=1&&e.children.forEach((e=>{t+=this.countAllChild(e)})),t+1};deleteAllChild=(e,t=!0)=>{e.children.length>=1&&e.children.forEach((e=>{this.deleteAllChild(e)})),t&&e.destroy(),e.removeChildren()};deleteChild=e=>{e.children.length>=1&&e.children.forEach((e=>{this.deleteAllChild(e)})),e.removeChildren()};memoryUsed=()=>{if("memory"in window.performance){const e=window.performance.memory;return Math.round(e.usedJSHeapSize/1048576)}return 0}}class v extends b{constructor(){super()}createBackGroundGame=()=>{let e=new PIXI.Container,t=this.gameWidth,i=this.gameHeight,n=new PIXI.Container;e.addChild(n);let h=2*Math.ceil(t/418);for(let e=0;e<h;e++){let t=new PIXI.Sprite(PIXI.Texture.from("./assets/map/chantroi/x2Main_Image_bg_b21.png"));t.x=418*e,n.addChild(t)}n.y=.1*i,TweenMax.to(n,50,{x:-418,repeat:-1,ease:Linear.easeNone});let a=new PIXI.Container;e.addChild(a);let l=Math.ceil(t/96);for(let e=0;e<l;e++){let t=new PIXI.Sprite(PIXI.Texture.from("./assets/map/dat/23020_0_8.png")),i=new PIXI.Sprite(PIXI.Texture.from("./assets/map/dat/23020_0_9.png")),n=new PIXI.Sprite(PIXI.Texture.from("./assets/map/dat/23023_3_6.png")),h=new PIXI.AnimatedSprite([t.texture,i.texture,n.texture]);h.animationSpeed=.1,h.play(),h.x=96*e,a.addChild(h)}a.y=.1*i+80;let o=new PIXI.Container;e.addChild(o);let d=Math.ceil(t/48);for(let e=0;e<d;e++){new PIXI.Sprite(PIXI.Texture.from("./assets/map/dat/23020_0_7.png"));let t=new PIXI.Sprite(PIXI.Texture.from("./assets/map/dat/23070_0_0.png")),i=new PIXI.Sprite(PIXI.Texture.from("./assets/map/dat/23070_0_3.png")),n=new PIXI.AnimatedSprite([t.texture,i.texture]);n.animationSpeed=.05,n.play(),n.width=48,n.height=48,n.x=48*e,o.addChild(n)}o.y=.1*i+80+96;let r=.1*i+80+96+48,s=Math.ceil(t/48),c=Math.ceil((i-r)/48),g=new PIXI.Container;e.addChild(g);for(let e=0;e<s;e++)for(let t=0;t<c;t++){let i=new PIXI.Sprite(PIXI.Texture.from("./assets/map/dat/23020_0_"+this.rand(5,6)+".png"));i.width=48,i.height=48,i.x=48*e,i.y=48*t+r,g.addChild(i)}let p=new PIXI.Sprite(PIXI.Texture.from("./assets/map/caycoi/5.png"));p.x=0,p.name="caydua",p.scale.set(.5),p.y=r-200,e.addChild(p);let m=new PIXI.Sprite(PIXI.Texture.from("./assets/map/caycoi/5.png"));return m.x=t,m.name="caydua2",m.scale.set(.5),m.scale.x=-.5,m.y=r-200,e.addChild(m),e}}class C extends v{constructor(){super()}animation=(e,t,i,n,h=.1,a=!1)=>this.createAnimation(e,t,i/n,n,h,a);animationw=(e,t,i,n,h,a=0,l=[])=>{let o=new PIXI.Sprite(this.coverImg(e)),d=[];const r=i/n,s=t/h;for(let e=0;e<n;e++){let t=new PIXI.Texture(o.texture,new PIXI.Rectangle(s*a,r*e,s,r));d.push(t)}if(l&&l.length>0){let e=[];l.forEach((t=>{e.push(d[t])})),d=e}let c=new PIXI.AnimatedSprite(d);return c.animationSpeed=.3,c.loop=!1,c};animationX=(e,t,i,n,h=.1,a=!1)=>{t/=n;let l=new PIXI.Sprite(this.coverImg(e)),o=[];for(let e=0;e<n;e++){let n=new PIXI.Texture(l.texture,new PIXI.Rectangle(t*e,0,t,i));o.push(n)}let d=new PIXI.AnimatedSprite(o);return d.animationSpeed=h,d.loop=a,d};createAnimation=(e,t,i,n,h=.1,a=!1)=>{let l=new PIXI.Sprite(this.coverImg(e)),o=[];for(let e=0;e<n;e++){let n=new PIXI.Texture(l.texture,new PIXI.Rectangle(0,i*e,t,i));o.push(n)}let d=new PIXI.AnimatedSprite(o);return d.animationSpeed=h,d.loop=a,d};createAnimationArray=(e,t=.1,i=!1,n="./assets/int04/")=>{let h=[];e.forEach((e=>{let t=this.coverImg(e,n);new PIXI.Sprite(t),h.push(t)}));let a=new PIXI.AnimatedSprite(h);return a.animationSpeed=t,a.loop=i,a};animationEvent=(e,t=!1)=>{let i=0;return e.interactive=!0,e.cursor="pointer",e.on("pointerdown",(()=>{e.gotoAndStop(1),i=Date.now()})),e.on("pointerup",(()=>{e.gotoAndStop(0),Date.now()-i<200&&t&&t()})),e.on("pointerupoutside",(()=>{e.gotoAndStop(0)})),e.on("pointerover",(()=>{e.gotoAndStop(0)})),e};cropImg=(e,t,i,n,h)=>{let a=new PIXI.Sprite(this.coverImg(e));return new PIXI.Texture(a.texture,new PIXI.Rectangle(t,i,n,h))};caculatorSpeed=(e,t,i)=>Math.sqrt(Math.pow(t-i,2))/e;moveSpeed=(e,t,i,n=TWEEN.Easing.Linear.None,h=null,a=null)=>{n||(n=TWEEN.Easing.Linear.None);let l=t.x,o=t.y,d=i.x,r=i.y,s=Math.sqrt(Math.pow(l-d,2)+Math.pow(o-r,2))/e;return new TWEEN.Tween(t).to({x:d,y:r},s).easing(n).start().onUpdate((()=>{h&&h()})).onComplete((()=>{a&&a()}))};move=(e,t,i,n=TWEEN.Easing.Back.Out,h=null,a=null,l=!1)=>(n||(n=TWEEN.Easing.Back.Out),new TWEEN.Tween(e).to(t,i).easing(n).start().onUpdate((()=>{h&&h()})).onComplete((()=>{a&&a()})))}class P extends C{constructor(){super()}getThuocTinh=e=>{let t={_haki:["Haki vũ trang","%"],haki:["Haki vũ trang",""],sat_thuong_phep:["Sát thương phép",""],_sat_thuong_phep:["Sát thương phép","%"],sat_thuong_vat_ly:["Sát thương vật lý",""],_sat_thuong_vat_ly:["Sát thương vật lý","%"],khang_phep:["Kháng phép",""],_khang_phep:["Kháng phép","%"],khang_vat_ly:["Kháng vật lý",""],_khang_vat_ly:["Kháng vật lý","%"],hpmax:["Máu",""],_hpmax:["Máu","%"],mpmax:["Năng lượng",""],_mpmax:["Năng lượng","%"],hoi_chieu:["Hồi chiêu"," mili giây"],_chi_mang:["Tỉ lệ chí mạng","%"],_sat_thuong_chi_mang:["Sát thương chí mạng","%"],_giam_sat_thuong_chi_mang:["Giảm sát thương chí mạng","%"],_hoi_mau:["Hồi máu mỗi 15 giây","%"],_hoi_mp:["Hồi năng lượng mỗi 15 giây","%"],_tru_hp:["Giảm máu mỗi 1 giây","%"]};return t[e]?{name:t[e][0],value:t[e][1]}:{name:e,value:""}};number_format(e){return e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1.")}collide=(e,t,i=!1)=>(e=e.getBounds(),t=t.getBounds(),e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y);collideMove=(e,t,i=!1,n)=>(e=e.getBounds(),t=t.getBounds(),"up"==i&&(e.y+=e.height),"right"!=i&&"left"!=i||(e.y+=e.height),e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y);hitTestRectangleDown(e,t,i){const n=e.getBounds();if(!n)return!1;const h=t.getBounds();return h.x=h.x+h.width,!!h&&(0!=move&&("right"==move&&(n.x+=td),"left"==move&&(n.x-=td),"up"==move&&(n.y-=td),"down"==move&&(n.y+=td)),n.x<h.x+h.width&&n.x+n.width>h.x&&n.y<h.y+h.height&&n.y+n.height>h.y)}dx=(e,t,i,n)=>{let h=e-i,a=t-n;return Math.sqrt(h*h+a*a)};distanceXY=(e,t,i,n)=>{let h=e-i,a=t-n;return Math.sqrt(h*h+a*a)};circleCollision=(e,t)=>this.distance(e.x,e.y,t.x,t.y)<=e.radius+t.radius;circlePointCollision=(e,t,i)=>this.distance(e,t,i.x,i.y)<i.radius;pointInRect=(e,t,i)=>this.inRange(e,i.x,i.x+i.width)&&this.inRange(t,i.y,i.y+i.height);getTime=()=>{const e=(new Date).toLocaleString("en-US",{timeZone:"Asia/Ho_Chi_Minh"});return Math.floor(new Date(e).getTime())};coverTime=e=>{let t=this.getTime()-e;return t=Math.abs(Math.round(t/1e3)),t<=60?t+"s":t>60&&t<=3600?Math.round(t/60)+"m":t>3600&&t<=86400?Math.round(t/3600)+"h":t>86400&&t<=604800?Math.round(t/86400)+"d":t>604800&&t<=2592e3?Math.round(t/604800)+"w":t>2592e3&&t<=31536e3?Math.round(t/2592e3)+"m":t>31536e3?Math.round(t/31536e3)+"y":void 0};checkDanh=e=>{if("object"!=typeof e||!e||e.length<=0)return!0;let t=!0;for(let i=0;i<e.length;i++){let n=e[i],h=n[0],a=n[1],l=this.skill.find((e=>e.id===h));if(l&&l.buff&&"object"==typeof l.buff){let e=l.buff[a];if(e){let i=e[6];if(i=i||[0,0],1==i[1]){t=!1;break}}}}return t};checkDi=e=>{if("object"!=typeof e||!e||e.length<=0)return!0;let t=!0;for(let i=0;i<e.length;i++){let n=e[i],h=n[0],a=n[1],l=this.skill.find((e=>e.id===h));if(l&&l.buff&&"object"==typeof l.buff){let e=l.buff[a];if(e){let i=e[6];if(i=i||[0,0],1==i[0]){t=!1;break}}}}return t};isMenu=()=>!(this.box&&this.box.children.length>=1)&&!(this.boxGiaoTiep&&this.boxGiaoTiep.children.length>=1)&&!(this.menu&&this.menu.children.length>=1)&&!(this.menuLeft&&this.menuLeft.children.length>=1)&&(!this.danh||!0!==this.danh)&&!(this.input&&this.input.children.length>=1)&&void 0;isDi=(e=[])=>!(this.my.id<=0)&&!1!==this.isMenu()&&this.checkDi(e);isAttack=(e=[])=>!(this.my.id<=0)&&!1!==this.isMenu()&&this.checkDanh(e)}class S extends P{constructor(){super()}findText=e=>{let t=(e,i)=>{let n=!1;for(let h=0;h<i.length;h++){let a=i[h];if(a.name==e){n=a;break}if(a.children.length>=1&&(n=t(e,a.children),n))break}return n};return t(e,this.app.stage.children)};findAllText=(e,t="")=>{let i=(e,n)=>{let h=[];for(let a=0;a<n.length;a++){let l=n[a];if(l.name==e&&(h.push(l),t&&(l.text=t)),l.children.length>=1){let t=i(e,l.children);t.length>=1&&(h=h.concat(t))}}return h};return i(e,this.app.stage.children)};findAllAndHideText=(e,t=!1)=>{let i=(e,n)=>{for(let h=0;h<n.length;h++){let a=n[h];a.name==e&&(a.visible=t),a.children.length>=1&&i(e,a.children)}};i(e,this.app.stage.children)};hideTextChild=(e,t=!1)=>{let i=(e,n)=>{for(let h=0;h<n.length;h++){let a=n[h];a.visible=t,a.children.length>=1&&i(e,a.children)}};e.interactive=!1,i(name,e.children)}}class X extends S{constructor(){super(),this.runGame=!1,this.created_Scene()}resize=(e,t)=>{this.gameWidth=e,this.gameHeight=t,this.renderButton()};created_Scene=()=>{this.gameWidth=window.innerWidth,this.gameHeight=window.innerHeight,this.app=new PIXI.Application({backgroundColor:1683704,resolution:window.devicePixelRatio,autoDensity:!0,resizeTo:window,hello:!0,powerPreference:"high-performance",antialias:!0,fps:120,frameRate:120}),this.app.stage.name="Dragon Boy H5 with int04",globalThis.__PIXI_APP__=this.app,this.gameWidth=this.app.screen.width,this.gameHeight=this.app.screen.height,document.body.appendChild(this.app.view),document.body.style.overflow="hidden",this.Created_Object_Scene(),this.runGame=!0,window.addEventListener("resize",(()=>{console.log("rezie","old",this.gameWidth,this.gameHeight,"new",window.innerWidth,window.innerHeight),this.resize(window.innerWidth,window.innerHeight)}))};Created_Object_Scene=()=>{this.main=new PIXI.Container,this.main.name="main",this.game=new PIXI.Container,this.game.name="Ingame",this.main.addChild(this.game),this.container=new PIXI.Container,this.container.name="lớp bản đồ, nhân vật",this.background=new PIXI.Container,this.background.name="lớp nền",this.game.addChild(this.background),this.game.addChild(this.container),this.may=new PIXI.Container,this.may.name="may",this.background.addChild(this.may),this.bien=new PIXI.Container,this.bien.name="bien",this.background.addChild(this.bien),this.nui2=new PIXI.Container,this.nui2.name="nui2",this.background.addChild(this.nui2),this.nui1=new PIXI.Container,this.nui1.name="nui1",this.background.addChild(this.nui1),this.map=new PIXI.Container,this.map.name="map",this.container.addChild(this.map),this.eff2=new PIXI.Container,this.eff2.name="eff2",this.container.addChild(this.eff2),this.thuyenNen=new PIXI.Container,this.thuyenNen.name="thuyenSau",this.playerItem=new PIXI.Container,this.playerItem.name="playerItem",this.player=new PIXI.Container,this.player.name="player",this.thuyen=new PIXI.Container,this.thuyen.name="thuyenTruoc",this.camera=new PIXI.Graphics,this.camera.name="camera",this.camera.beginFill(0,.5),this.camera.drawRect(0,0,48,48),this.camera.endFill(),this.camera.visible=!1,this.container.addChild(this.camera),this.eff=new PIXI.Container,this.eff.name="skill",this.Chat=new PIXI.Container,this.Chat.name="chat",this.container.addChild(this.thuyenNen),this.container.addChild(this.playerItem),this.container.addChild(this.player),this.container.addChild(this.thuyen),this.container.addChild(this.eff),this.container.addChild(this.Chat),this.che=new PIXI.Container,this.che.name="map",this.container.addChild(this.che),this.textVitri=new PIXI.Text("Vị trí: ",{fontFamily:"Arial",fontSize:24,fill:16715792,align:"center"}),this.textVitri.name="textVitri",this.textVitri.x=0,this.textVitri.y=this.gameHeight-this.textVitri.height,this.main.addChild(this.textVitri),this.button=new PIXI.Container,this.button.name="nut man hinh",this.main.addChild(this.button),this.box=new PIXI.Container,this.box.name="box",this.main.addChild(this.box),this.boxGiaoTiep=new PIXI.Container,this.boxGiaoTiep.name="boxGiaoTiep",this.main.addChild(this.boxGiaoTiep),this.menu=new PIXI.Container,this.menu.name="menu",this.main.addChild(this.menu),this.menuLeft=new PIXI.Container,this.menuLeft.name="menuLeft",this.main.addChild(this.menuLeft),this.input=new PIXI.Container,this.input.name="input",this.main.addChild(this.input),this.mainLogin=new PIXI.Container,this.mainLogin.name="mainLogin",this.loadGame=new PIXI.Container,this.loadGame.name="loadgame",this.noticeMain=new PIXI.Container,this.noticeMain.name="noticeMain",this.app.stage.addChild(this.main),this.preItem=new PIXI.Container,this.preItem.name="preItem",this.app.stage.addChild(this.preItem),this.main.interactive=!0,this.main.on("pointerdown",(()=>{this.deleteAllChild(this.preItem,!1)})),this.chipiBox=new PIXI.Container,this.chipiBox.name="chipiBox",this.app.stage.addChild(this.mainLogin),this.app.stage.addChild(this.loadGame),this.app.stage.addChild(this.noticeMain),this.app.stage.addChild(this.chipiBox)}}let k=(e,t="")=>{if(e.closeInput(),t.length<=0)return!1;if(t.length>=150)return!1;let i=e.my.tien;if(i.beri<5&&i.ruby<5e4)return e.notice("Bạn cần 5 ruby hoặc 50.000 beri để chat thế giới");e.send(-7,[1,2,t])};class T extends X{constructor(){super()}closeInput=()=>{this.deleteAllChild(this.input,!1)};createInputBackground=()=>{this.closeInput();let e=new PIXI.Graphics;e.beginFill(0,1e-8),e.drawRect(0,0,this.gameWidth,this.gameHeight),e.endFill(),this.input.addChild(e)};inputChatZone=()=>!(this.input.children.length>=1)&&(this.createInputBackground(),(e=>{let t={width:.7*e.gameWidth,height:.2*e.gameHeight};t.width=t.width>500?500:t.width,t.height=t.height>50?50:t.height;let i=new PIXI.TextInput({input:{fontSize:"17px",padding:"10px",color:"#7a1125",width:t.width,height:t.height},box:{default:{fill:15647621,rounded:0,stroke:{color:16774891,width:1}},focused:{fill:11006636,rounded:0,stroke:{color:16774891,width:1}},disabled:{fill:14408667,rounded:0}}});i.placeholder="Chat...",e.input.addChild(i),i.x=(e.gameWidth-t.width)/2,i.y=.8*e.gameHeight-t.height-.3*t.height,setTimeout((()=>{i.focus()}),200),i.on("keyup",(t=>{13===t&&(i.blur(),((e,t)=>{e.closeInput(),!(t.length<=0)&&!(t.length>=150)&&e.send(-7,[1,1,t])})(e,i.text),i.text="")}))})(this));inputChatWorld=()=>!(this.input.children.length>=1)&&(this.createInputBackground(),(e=>{let t=.8*e.gameWidth,i=.5*e.gameHeight;t=t>500?500:t,i=i>300?300:i;let n=new PIXI.Graphics;n.beginFill(8744014,1),n.lineStyle(2,6966058,1),n.drawRect(0,0,t,i),n.endFill(),n.x=(e.gameWidth-t)/2,n.y=.7*(e.gameHeight-i),e.input.addChild(n);let h=e.div(n,8744014,[.99,.3]);h.alpha=1;let a=e.div(h,15906382,[.8,.5]);a.x=(h.width-a.width)/2,a.y=(h.height-a.height)/2,a.alpha=1;let l=new PIXI.Text(e._("Chat thế giới"),{fontFamily:"Arial",fontSize:16,fill:16777215,align:"center"});l.x=(a.width-l.width)/2,l.y=(a.height-l.height)/2,a.addChild(l);let o=e.animation("x2Main_Image_point_closetab",36,72,2);o.animationSpeed=1,o.loop=!1,o.width=a.width>36?36:a.width,o.height=a.height>36?36:a.height,a.addChild(o),o.x=a.width-o.width/2,o.y=a.height/2-o.height/2,o.interactive=!0,o.cursor="pointer";let d=0;o.on("pointerdown",(function(){d=Date.now(),o.gotoAndStop(1)})),o.on("pointerup",(function(){o.gotoAndStop(0),Date.now()-d<200&&k(e)}));let r=e.div(n,8744014,[.99,.7]);r.alpha=1,r.y=h.height;let s=new PIXI.Container;r.addChild(s);let c=new PIXI.Text(e._("Để chát thế giới sẽ cần 5 ruby hoặc 50.000 beri:"),{fontFamily:"Arial",fontSize:16,fill:16777215,align:"center"});s.addChild(c);let g=new PIXI.TextInput({input:{fontSize:"17px",padding:"10px",color:"#7a1125",width:.8*r.width,height:e.max(.5*(r.height-c.height),50)},box:{default:{fill:15647621,rounded:0,stroke:{color:16774891,width:1}},focused:{fill:11006636,rounded:0,stroke:{color:16774891,width:1}},disabled:{fill:14408667,rounded:0}}});g.placeholder="Nội dung...",g.y=c.height+10,s.addChild(g);let p=()=>{g.blur(),k(e,g.text),g.text=""};setTimeout((()=>{g.focus()}),200),g.on("keyup",(e=>{13===e&&p()})),s.x=(r.width-s.width)/2,s.y=(r.height-s.height)/2;let m=e.div(n,8810843,[.5,.3],[100,50]);m.alpha=1,m.y=n.height,m.x=(n.width-m.width)/2;let w=new PIXI.Text(e._("Gửi"),{fontFamily:"Arial",fontSize:16,fill:16777215,align:"center"});w.x=(m.width-w.width)/2,w.y=(m.height-w.height)/2,m.addChild(w),m.interactive=!0,m.cursor="pointer",m.on("pointerdown",(function(){p()}))})(this));div=(e,t=null,i=[1,1],n=[null,null])=>{let h=i[0],a=i[1],l=n[0],o=n[1],d=e.width*h,r=e.height*a;l&&(d=d>l?l:d),o&&(r=r>o?o:r);let s=this.randomColor();t&&(s=t);let c=new PIXI.Graphics;return c.beginFill(s,1),c.drawRect(0,0,d,r),c.endFill(),e.addChild(c),c};max=(e,t)=>e>t?t:e;randomColor=()=>{let e=Math.floor(16777215*Math.random()).toString(16);return e="0x"+("000000"+e).slice(-6),e=parseInt(e),e}}class F extends T{constructor(){super(),this.timeMove=0}updateMoveToSocket=(e,t)=>(e=Math.round(e),t=Math.round(t),this.send(-3,[e,t]));getBlock=(e,t,i)=>{let n=this.map.children.filter((e=>"camdi"==e.type)),h=[];for(let a=0;a<n.length;a++){let l=n[a];e.getBounds(),l.getBounds(),this.collideMove(e,l,t,i)&&h.push(l)}let a=[];if(h.length>0){let i=e.getBounds();for(let e=0;e<h.length;e++){let n=h[e],l=n.getBounds();"down"==t&&i.y+i.height<l.y+l.height/2&&a.push(n),"up"==t&&i.y+i.height>l.y+l.height/2&&a.push(n),"right"==t&&i.x+i.width<l.x+l.width/2&&(i.y+i.height<l.y||a.push(n)),"left"==t&&i.x-i.width<l.x+l.width&&(i.y+i.height<l.y||i.x+i.width/2<l.x+l.width/2||a.push(n))}}return a.length>=1||null};moveSprite=e=>{if(this.my.id<=0)return;let t,i,n,h,a=this.keypress;if(a[38]||a[40]||a[37]||a[39]){if(!1===this.isDi())return!1;t=this.getSprite(this.my.id),i=this.getSpriteItem(this.my.id),n=this.getMy(this.my.id),h=n.info.coban.speed}a[38]&&null==this.getBlock(t,"up",h*e)&&(t.y-=h*e,i.y-=h*e),a[40]&&null==this.getBlock(t,"down",h*e)&&(t.y+=h*e,i.y+=h*e),a[37]&&null==this.getBlock(t,"left",h*e)&&(t.x-=h*e,i.x-=h*e,n.action.move="left"),a[39]&&null==this.getBlock(t,"right",h*e)&&(t.x+=h*e,i.x+=h*e,n.action.move="right"),(a[38]||a[40]||a[37]||a[39])&&(this.action(this.my.id,"move"),this.timeMove<Date.now()&&(this.timeMove=Date.now()+500,this.updateMoveToSocket(t.x,t.y)))}}class M extends F{constructor(){super(),this.holdCrcollXY(),this.hold=!1}holdCrcollXY=()=>{let e=0,t=0,i=this.game;i.interactive=!0,i.on("pointerdown",(i=>{if(this.my.id>=1){this.hold=!0,e=i.data.global.x,t=i.data.global.y;let n=this.getSprite(this.my.id);this.camera.x=n.x,this.camera.y=n.y}})),i.on("pointermove",(i=>{if(this.hold){let n=i.data.global.x,h=i.data.global.y;this.camera.x+=e-n,this.camera.y+=t-h,e=n,t=h}})),i.on("pointerup",(e=>{this.hold=!1})),i.on("pointerout",(e=>{this.hold=!1})),i.on("pointerleave",(e=>{this.hold=!1}))}}class W extends M{constructor(){super()}keomap=e=>{let t=this.gameMap.setting,i=(t.minX,t.maxX,t.minY,t.maxY,this.my);if(i.id>=1){let e;e=this.hold?this.camera:this.getSprite(i.id);let t=this.container,n=this.gameWidth/2,h=this.gameHeight/2,a=e.x*t.scale.x,l=e.y*t.scale.y,o=this.gameMap,d=0;d=e.x+n>=o.setting.maxX?-(o.setting.maxX-2*n):e.x-n<=o.setting.minX?0:this.gameWidth/2-a,t.oldX=t.oldX||t.x,t.Run=t.Run||0;let r=()=>{t.Tween=TweenMax.to(t,1.5,{x:d,ease:Power4.easeOut,onComplete:()=>{t.Run=0}})};t.oldX!=d&&(0==t.Run?(r(),t.oldX=d,t.Run=1):(t.Tween.kill(),t.oldX=d,t.Run=1,r()));let s=0;t.oldY=t.oldY||t.y,t.RunY=t.RunY||0;let c=()=>{t.TweenY=TweenMax.to(t,1,{y:s,ease:Power4.easeOut,onComplete:()=>{t.RunY=0}})};e.y-this.gameHeight/2<o.setting.minY?(this.setKeoSpeed=.5,s=this.gameHeight*this.setKeoSpeed-l,s=0+this.may.height+this.nui1.height+this.nui2.height+this.bien.height):e.y+this.gameHeight/2>o.setting.maxY?(this.setKeoSpeed=.5,s=-(o.setting.maxY-2*h)):s=this.gameHeight*this.setKeoSpeed-l,t.oldY!=s&&(0==t.RunY?(c(),t.oldY=s,t.RunY=1):(t.TweenY.kill(),t.oldY=s,t.RunY=1,c())),1===this.vaomap&&(this.vaomap=0,t.x=d,t.y=s,t.oldX=d,t.oldY=s),this.background.y=t.y;let g=.3,p=this.nui1;e.x,p.scale.x,e.x+n>=o.setting.maxX?p.x=-(o.setting.maxX-2*n)*g:e.x-n<=o.setting.minX?p.x=0:p.x=(this.gameWidth/2-a)*g;let m=.2,w=this.nui2;e.x,w.scale.x,e.x+n>=o.setting.maxX?w.x=-(o.setting.maxX-2*n)*m:e.x-n<=o.setting.minX?w.x=0:w.x=(this.gameWidth/2-a)*m;let u=.15,y=this.bien;e.x,y.scale.x,e.x+n>=o.setting.maxX?y.x=-(o.setting.maxX-2*n)*u:e.x-n<=o.setting.minX?y.x=0:y.x=(this.gameWidth/2-a)*u;let f=.1,x=this.may;e.x,x.scale.x,e.x+n>=o.setting.maxX?x.x=-(o.setting.maxX-2*n)*f:e.x-n<=o.setting.minX?x.x=0:x.x=(this.gameWidth/2-a)*f}}}const E=(e,t,i,n,h=.1,a=!1)=>((e,t,i,n,h=.1,a=!1)=>{let l=new PIXI.Sprite((e=>("number"==typeof e&&(e=e.toString()),PIXI.Texture.from("./assets/map/bien/"+e+".png")))(e)),o=[];for(let e=0;e<n;e++){let n=new PIXI.Texture(l.texture,new PIXI.Rectangle(0,i*e,t,i));o.push(n)}let d=new PIXI.AnimatedSprite(o);return d.animationSpeed=h,d.loop=a,d})(e,t,i/n,n,h,a);let R=0;class G extends W{constructor(){super(),this.timeDelta=0;let e=new PIXI.Ticker;e.minFPS=120,e.update(1e3/120),e.add((e=>{this.update(e)})),e.start()}update=e=>{this.timeDelta=e,this.updateAction(e),this.updatePos(e),this.moveSprite(e),this.keomap(e),this.updateChatMap(e),this.updateClick(e),this.updateMove(e),this.updateRenderSkill(e),this.updateSkill(e),TWEEN.update(),1===this.config.map&&((e,t=0)=>{if(R+=t,R<20)return!1;R=0;let i=e.map.children.filter((e=>"animation"===e.type));for(let t=0;t<i.length;t++){let n=i[t];if(n.run=n.run?n.run:0,0===n.run&&e.rand(1,100)<=10){n.run=1;let t=E("x2Main_Image_bg_redline1",48,336,7,.2,!1);t.play(),t.x=n.x,t.y=n.y,e.rand(1,100)<=10&&(t.scale.x=-1),t.width=n.width,t.height=n.height,t.onComplete=()=>{t.destroy(),n.run=0},e.map.addChild(t)}}})(this,e),this.chipiView(e)};updatePos=e=>{let t=this.getSprite(this.my.id),i=this.app.ticker.FPS;this.textVitri.text=Math.round(t.x)+" - "+Math.round(t.y)+" ("+Math.round(t.y+t.height)+") - "+Math.round(i)+" FPS - "+Math.fround(e).toFixed(2)+" ms "+this.number_format(this.countAllChild(this.main))+" - "+this.memoryUsed()+"mb "}}class B extends G{constructor(){super()}ioInsertChat=e=>{let t=this.cache_chat;for(let i=0;i<t.length;i++)t[i].uid==e._1&&(t[i].type="delete");t.push({id:this.randomAZ(10),uid:e._1,text:e._2,type:"chat"})};updateChatMap=e=>{0!==this.cache_chat.length&&this.cache_chat.forEach((e=>{if(null==this.Chat.getChildByName(e.id)){const t=new PIXI.Graphics;t.name=e.id,t.id=e.id,t.uid=e.uid;const i=new PIXI.Text(e.text,{align:"center",breakWords:!0,fontSize:14,whiteSpace:"normal",wordWrap:!0,wordWrapWidth:150,fontWeight:"bold"});i.anchor.set(.5),i.wordWrapWidth=180,i.name=e.id,i.id=e.id,i.anchor.set(.5),i.time=0,i.dem=0,t.addChild(i),i.position.set(t.width/2,t.height/2),i.resolution=2,t.lineStyle(1,0,3),t.beginFill(16694636),t.drawRoundedRect(-10,-10,i.width+20<150?150:i.width+20,i.height+20<50?50:i.height+20,10),t.endFill(),t.pivot.set(t.width/2,t.height/2),t.visible=!1;const n=new PIXI.Graphics;n.beginFill(16694636),n.lineStyle(1,0,3),n.moveTo(0,0),n.lineTo(10,10),n.lineTo(20,0),n.endFill(),n.pivot.set(n.width/2,n.height/2),n.position.set(t.width/2-n.width/2,t.height-n.height+4),t.addChild(n),this.Chat.addChild(t)}else{let t=this.Chat.getChildByName(e.id),i=t.getChildByName(e.id);if("delete"==e.type)return this.Chat.removeChild(t),this.cache_chat=this.cache_chat.filter((function(t){return t.id!==e.id})),!1;let n=this.getSprite(e.uid);if(!n)return e.type="delete";null!=n&&t.position.set(n.x+Math.abs(n.maxWdith/2),n.y-(i.height+20)/2-50),i.dem%1==0&&i.time>=800&&(this.Chat.removeChild(t),this.cache_chat=this.cache_chat.filter((function(t){return t.id!==e.id}))),i.dem++,i.time++,t.visible=!0}}))}}class A extends B{constructor(){super(),this.dxCheck={player:300,npc:100,mob:400},this.logPlayerClick=[]}changeClick=()=>{if(this.my.id<=0)return!1;let e=this.getSprite(this.my.id),t=e.x,i=e.y,n=0,h=this.player.children.filter((e=>e.name!=this.my.id));for(let e=0;e<h.length;e++){let a=h[e],l=a.x,o=a.y,d=this.dx(t,i,l,o),r=this.getMy(a.id);if(r){if("mob"==r.type&&r.info&&r.info.chiso&&r.info.chiso.hp<=0)continue;if(d<=this.dxCheck[r.type]&&!this.logPlayerClick.find((e=>e==r.id))){this.click=a.id,n=1,this.logPlayerClick.push(r.id);break}}}0==n&&(this.logPlayerClick=[],null!=this.click&&this.logPlayerClick.push(this.click))};noClick=e=>{let t=this.getSprite(this.my.id),i=t.x,n=t.y,h=this.player.children.filter((e=>e.name!=this.my.id));h.forEach((e=>{let t=e.x,h=e.y,a=this.dx(i,n,t,h),l=this.getMy(e.id);l&&("mob"==l.type&&l.info&&l.info.chiso&&l.info.chiso.hp<=0||a<=this.dxCheck[l.type]&&(this.click=e.id))}))};isClick=e=>{let t=this.button.getChildByName("player_mmo");if(!t)return!1;let i=this.getSprite(this.my.id),n=i.x,h=i.y,a=this.getSprite(this.click);if(!a)return this.click=null,t.visible=!1,!1;let l=a.x,o=a.y,d=this.dx(n,h,l,o),r=this.getMy(a.id);if(!r)return t.visible=!1,this.click=null;if("mob"===r.type&&r.info&&r.info.chiso&&r.info.chiso.hp<=0)return this.click=null,t.visible=!1,!1;if(d>this.dxCheck[r.type])return this.click=null,t.visible=!1,!1;t.visible=!0;let s=t.getChildByName("name_player"),c=t.getChildByName("hp_player");if(s&&(s.text=r.name,s.x=t.width/2-s.width/2),c){let e=r;e.info.chiso=e.info.chiso||{},e.info.chiso.hp=e.info.chiso.hp||27,c.text=e.info.chiso.hp,c.x=t.width/2-c.width/2}};updateClick=e=>{if(this.my.id<=0)return!1;null!=this.click?this.isClick(e):this.noClick(e)}}class N extends A{constructor(){super()}int_update_action_item=(e,t,i)=>{"npc"===t.type&&this.npcIsChat(e,t),e.createEvent=e.createEvent||!1,e.createEvent||(e.createEvent=!0,e.interactive=!0,e.cursor="pointer"),e.dadi=e.dadi||0,e.dadiy=e.dadiy||0,e.sea=e.sea||!1,t.action&&"move"===t.action.action&&"player"===t.type&&0===this.config.map&&(Math.abs(e.x-e.dadi)>=50||Math.abs(e.y-e.dadiy)>=50)&&(e.dadi=e.x,e.dadiy=e.y,this.setSkill({from:e.id,type:"move"})),t.action&&"player"===t.type&&1===this.config.map&&(this.action(t.id,"dungyen"),this.setSkill({from:e.id,type:"sea",id:"sea_"+e.id}),(Math.abs(e.x-e.dadi)>=50||Math.abs(e.y-e.dadiy)>=50)&&(e.dadi=e.x,e.dadiy=e.y,e.sea=!0));let n=this.playerItem.getChildByName(e.name);n||(n=new PIXI.Container,n.name=e.name,this.playerItem.addChild(n)),n.x=e.x,n.y=e.y,n.visible=e.visible;let h=n.getChildByName("showName");if(h)h.x=Math.abs(e.maxWdith/2)-h.width/2,h.y=-50,e.loadname=0,"mob"===t.type&&(h.visible=!1);else{let e=16777215;"npc"===t.type&&(e=16514363),h=new PIXI.Text(t.name,{fontFamily:"Arial",fontSize:15,fill:e,align:"center"}),h.name="showName",n.addChild(h),h.resolution=2,h.style.stroke="#000000",h.style.strokeThickness=4}if("npc"!==t.type&&t.id!==this.my.id){let i=n.getChildByName("bar_hp");if(i){let n=t.info;if(n){let t=n.chiso;if(t){let n=t.hp,a=t.hpmax;n=n>a?a:n,n=n<0?0:n;let l=n/a;i.getChildByName("bar_full").width=i.width*l,i.y=h.y+h.height+5,i.x=Math.abs(e.maxWdith/2)-i.width/2}}}else{let e=50,t=10;i=new PIXI.Graphics,i.name="bar_hp",i.beginFill(0),i.drawRect(0,0,e,t),i.endFill(),i.x=0,i.y=h.y+h.height+5,n.addChild(i);let a=new PIXI.Graphics;a.name="bar_full",a.beginFill(13382400),a.drawRect(0,0,e,t),a.endFill(),a.x=0,a.y=0,i.addChild(a)}this.click==t.id?i.visible=!0:i.visible=!1}let a=n.getChildByName("preclick");if(a)a.x=h.x+h.width/2-a.width/2,a.y=h.y-a.height,this.click===t.id?a.visible=!0:a.visible=!1;else{let e=new PIXI.Sprite(this.coverImg("x2Main_Image_interface_iconfocus")),t=[],i=7,h=28,a=196/i;for(let n=0;n<i;n++){let i=new PIXI.Texture(e.texture,new PIXI.Rectangle(0,n*a,h,a));t.push(i)}let l=new PIXI.AnimatedSprite(t);l.name="preclick",l.animationSpeed=.3,l.play(),n.addChild(l)}}}class D extends N{constructor(){super()}getidSprite=e=>{let t=this.images.filter((t=>t.id==e));return!(t.length<=0)&&t};isNpcImg=(e,t)=>{let i=e.id,n=this.getSprite(i),h=e.script;if(!n&&h.id){let t=h.id;e.skin={dau:"iLvVMIbTpy",ao:"kFFosytneB",quan:"QSHGPlNDTK",toc:"axDwxOtydX",non:"axDwxOtydX",lung:"axDwxOtydX",tay:"axDwxOtydX"},this.getidSprite(t).forEach((t=>{e.skin[t.type]&&(e.skin[t.type]=t.name)}));let i=e.pos[0],n=e.pos[1];e.pos={x:i,y:n},this.create_sprite_my(e)}}}class H extends D{constructor(){super()}createMobFromAsset=(e,t)=>{let i=e.id,n=this.getSprite(i),h=e.data.script;if(!n&&h.img){let t=h.img;e.skin={dau:"iLvVMIbTpy",ao:"kFFosytneB",quan:"QSHGPlNDTK",toc:"axDwxOtydX",non:"axDwxOtydX",lung:"axDwxOtydX",tay:"axDwxOtydX"},this.getidSprite(t).forEach((t=>{e.skin[t.type]&&(e.skin[t.type]=t.name)})),this.create_sprite_my(e)}}}class O extends H{constructor(){super()}createMobSheet=(e,t,i)=>{let n=t.data.script,h=this.getSprite(t.id);if(h)if(0==h.create){let e=n.img,i=e.src,a=new PIXI.Sprite(this.coverImg(i)),l=a.width,o=a.height;if(1!=l){h.create=!0;for(let i in n.action){let d=i,r=n.action[i],s=r.length,c=[],g=e.w,p=e.h,m=o/e.num;for(let e=0;e<s;e++){let t=0,i=m*r[e],n=new PIXI.Texture(a.texture,new PIXI.Rectangle(t,i,l,m));c.push(n)}let w=new PIXI.AnimatedSprite(c);w.name=d,w.width=g,w.height=p,"dungyen"!=d&&(w.visible=!1),w.animationSpeed=.1,"dungyen"==d||"move"==d?(w.loop=!0,w.play()):w.loop=!1,w.onComplete=()=>{w.visible=!1,this.action(t.id,"dungyen")},h.oldAction="dungyen",h.addChild(w)}}}else{let n=h.oldAction||"dungyen";if(h.maxWdith=h.maxWdith||h.width,e!=n){"left"==t.action.move?(h.scale.x=1,h.pivot.x=0,h.huong="left",h.skew.x="move"==n?.05:0):"right"==t.action.move&&(h.scale.x=-1,"right"!=h.huong&&(h.pivot.x=-h.width),h.huong="right",h.skew.x="move"==n?-.05:0),"right"==h.huong&&h.maxWdith>=1&&(h.maxWdith*=-1);let i=h.getChildByName(h.oldAction),a=h.getChildByName(e);i&&(i.visible=!1,i.stop()),a&&(a.visible=!0,a.play()),h.oldAction=e}this.int_update_action_item(h,t,i)}else{let e=new PIXI.Container;e.id=t.id,e.name=t.id,e.x=t.x,e.y=t.y,e.create=!1,this.player.addChild(e)}}}class z extends O{constructor(){super()}npcIsChat(e,t){if(e.npcChat=e.npcChat||0,e.npcChat<Date.now()&&-1==this.Chat.children.findIndex((t=>t.uid==e.id))&&t.chat.length>=1){let i,n=t.chat;if(e.lamtho>=0){if(i=n[e.lamthoID],i=i[e.lamtho],e.lamtho+=1,e.npcChat=Date.now()+1e3,null==i)return e.lamtho=-1,e.lamthoID=-1,e.npcChat=Date.now()+1*t.delaychat,!1}else{let h=this.rand(0,n.length-1);i=n[h],"object"==typeof i&&(i=i[0],e.lamtho=1,e.lamthoID=h),e.npcChat=Date.now()+1*t.delaychat}this.ioInsertChat({_1:t.id,_2:i})}}isNpcSheet=(e,t)=>{let i=e.id,n=this.getSprite(i);if(n){if(0==n.create){let t=new PIXI.Sprite(this.coverImg(e.script.src)),i=t.width,h=t.height;if(1!=i){n.create=!0;let a=e.pos[0],l=e.pos[1],o=e.script.set[0],d=e.script.set[1],r=e.script.set[2],s=i,c=h/o,g=[];for(let e=0;e<o;e++){let i=new PIXI.Texture(t.texture,new PIXI.Rectangle(0,e*c,s,c));g.push(i)}let p=new PIXI.AnimatedSprite(g);p.animationSpeed=.1,p.play(),p.width=d,p.height=r,n.x=a,n.y=l-r,n.maxWdith=d,n.addChild(p)}}this.int_update_action_item(n,e,t)}else{let t=new PIXI.Container;t.id=i,t.type="npc",t.name=e.id,t.create=!1,this.player.addChild(t)}}}class L extends z{constructor(){super()}updateAction=e=>{this.player.children.sort(((e,t)=>e.y-t.y)),this.cache_action.forEach((t=>{let i=t.action,n=t.action,h=t.id,a=this.getMy(h);if(a&&"mob"===a.type&&a.data&&a.data.script&&a.data.script.type&&"sheet"===a.data.script.type)this.createMobSheet(n,a,e);else if(a&&"npc"===a.type&&a.script&&a.script.type&&"sheet"===a.script.type)this.isNpcSheet(a,e);else if(a&&("player"===a.type||"npc"===a.type&&a.script&&a.script.type&&"img"===a.script.type||"mob"===a.type&&a.data&&a.data.script&&a.data.script.type&&"img"===a.data.script.type)){let t=this.getSprite(h);if(t){this.int_update_action_item(t,a,e),t.f5=t.f5||0,t.old=t.old||"dungyen",t.old!==n&&(t.f5=1,t.old=n);let h=t.getChildByName("dau"),l=t.getChildByName("ao"),o=t.getChildByName("quan"),d=t.getChildByName("toc"),r=t.getChildByName("non"),s=t.getChildByName("lung"),c=t.getChildByName("tay"),g=a.skin;if(void 0===g)return;let p=this.getImg(g.quan),m=this.getImg(g.ao),w=this.getImg(g.toc),u=this.getImg(g.non),y=this.getImg(g.lung),f=this.getImg(g.tay),x=this.getImg(g.dau);t.move=t.move||1,"move"===i&&(n+=t.move,l.first=4,1===this.config.map&&(n="dungyen"));let I=5.5;t.elapsedTime=t.elapsedTime||0,t.elapsedTime+=e,t.elapsedTime>=I&&(t.elapsedTime=0,t.move+=1,t.move>=5&&(t.move=1)),1===t.f5&&(l.first=2,t.f5=0),h.xy=h.xy||0,o.time=o.time||0,o.num=o.num||0,o.num>=p[n].src.length&&(o.num=0),o.texture=this.coverImg(p[n].src[o.num]),l.num=l.num||0,l.num>=m[n].src.length&&(l.num=0),l.texture=this.coverImg(m[n].src[l.num]),l.first=l.first||0,c.num=c.num||0,c.num>=f[n].src.length&&(c.num=0),c.texture=this.coverImg(f[n].src[c.num]),d.num=d.num||0,d.num>=w[n].src.length&&(d.num=0),d.texture=this.coverImg(w[n].src[d.num]),r.num=r.num||0,r.num>=u[n].src.length&&(r.num=0),r.texture=this.coverImg(u[n].src[r.num]),s.num=s.num||0,s.num>=y[n].src.length&&(s.num=0),s.texture=this.coverImg(y[n].src[s.num]),h.num=h.num||0,h.num>=x[n].src.length&&(h.num=0),h.texture=this.coverImg(x[n].src[h.num]),1!=l.first&&(h.x=x[n].x,h.y=x[n].y,l.x=m[n].x,l.y=m[n].y,o.x=p[n].x,o.y=p[n].y,c.x=f[n].x,c.y=f[n].y,d.x=w[n].x,d.y=w[n].y,r.x=u[n].x,r.y=u[n].y,s.x=y[n].x,s.y=y[n].y,l.first=1),o.estime=o.estime||0;let _=7.5;o.estime+=e,o.estime>=_&&(o.num++,l.num++,c.num++,d.num++,r.num++,s.num++,h.num++,0==h.xy?(h.y+=1,l.y+=1,s.y+=1,c.y+=1,d.y+=1,r.y+=1,h.xy=1):(h.y-=1,l.y-=1,l.first=0,h.xy=0,s.y-=1,c.y-=1,d.y-=1,r.y-=1),o.estime=0),a.action.move=a.action.move||"left","left"===a.action.move?(t.scale.x=1,t.pivot.x=0,t.huong="left",t.skew.x="move"===i?.05:0):"right"===a.action.move&&(t.scale.x=-1,"right"!==t.huong&&(t.pivot.x=-t.width/2),t.huong="right",t.skew.x="move"===i?-.05:0),"dungyen"===i&&(t.maxWdith=t.width,t.maxHeight=t.height,"right"===t.huong&&t.maxWdith>=1&&(t.maxWdith*=-1))}else"npc"===a.type&&a.script&&a.script.type&&"img"===a.script.type&&this.isNpcImg(a,e),"mob"===a.type&&a.data&&a.data.script&&a.data.script.type&&"img"===a.data.script.type&&this.createMobFromAsset(a,e)}}))}}class K extends L{constructor(){super()}vong_skill=(e,t,i)=>{const n=this.sprite(t).x+t.width/2,h=t.y+t.height/2;for(let t=0;t<19;t++){let a=new PIXI.Graphics;a.beginFill(0);const l=t/19*Math.PI*2;a.drawCircle(n+90*Math.cos(l),h+90*Math.sin(l),30),a.endFill(),e.addChild(a),a.visible=!1;let o,d=a.getBounds();i<=14?o=this.animation("24027",96,384,4,.5):i<=20&&(o=this.animation("24225",96,384,4,.6)),o.loop=!1,o.play(),o.width=d.width,o.height=d.height,o.xx=n+90*Math.cos(l),o.yy=h+90*Math.sin(l),o.x=n,o.y=h;let r=()=>{};this.move(o,{x:o.xx,y:o.yy},400,TWEEN.Easing.Back.InOut,0,r),e.addChild(o),o.run=0,o.onComplete=()=>{o.run++,o.visible=!1,o.run<10&&(o.gotoAndPlay(0),o.visible=!0)}}};dam_2_vo_si=(e,t)=>{let i=this.getSkill(e.id),n=this.getSprite(e.from),h=this.getSprite(e.to);if(!n||!h)return e.type="delete";if(i.run=i.run||0,0==i.run){let t=e.level;t=t||1,i.run=1,this.action(n.id,"a1"),setTimeout((()=>{let a,l=h.x,o=0;o=h.x>n.x?n.x-200:n.x+200,n.x=o,n.y=h.y,a=t<=14?this.animation("24008",160,564,3,.3):this.animation("24316",176,752,4,.3),a.loop=!0,a.play(),n.width<=0&&(a.scale.x=-1),a.width=80,a.height=80,a.y=n.y,a.x=n.x,i.addChild(a),this.action(n.id,"a4"),this.move(a,{x:l},500,TWEEN.Easing.Back.InOut,0,(()=>{a.visible=!1})),this.move(n,{x:l},400,TWEEN.Easing.Back.InOut,0,(()=>{let h;this.action(n.id,"a5"),h=t<=1?this.animation("24068",112,528,3,.3):t<=9?this.animation("24089",112,528,3,.3):t<=14?this.animation("24281",116,600,3,.3):this.animation("24274",276,888,3,.3),h.loop=!1,h.play(),h.scale.x=n.scale.x,h.width=80,h.height=80,h.y=n.y,n.width<=0?h.x=n.x+Math.abs(h.width)/2+Math.abs(n.width)+n.pivot.x:h.x=n.x-Math.abs(h.width)/2-Math.abs(n.width),h.name="animation1",h.updateAnchor=!0,i.addChild(h),h.onComplete=()=>{this.success(e),h.visible=!1,this.action(n.id,"dungyen"),setTimeout((()=>{e.type="delete",h.destroy(),a.destroy()}),200)}}))}),100)}};dam_1_vo_si=(e,t)=>{let i=this.getSkill(e.id),n=this.getSprite(e.from),h=this.getSprite(e.to);if(!n||!h)return e.type="delete";if(i.run=i.run||0,0==i.run){let t,a=e.level;a=a||1,this.action(n.id,"dungyen"),i.run=1,a<=1?t=this.animation("24068",112,528,3,.3):a<=20&&(t=this.animation("24089",112,528,3,.3)),t.loop=!1,t.play(),t.scale.x=n.scale.x,t.width=80,t.height=80,t.y=n.y,n.width<=0?t.x=n.x+Math.abs(t.width)/2+Math.abs(n.width)+n.pivot.x:t.x=n.x-Math.abs(t.width)/2-Math.abs(n.width),t.name="animation1",t.updateAnchor=!0,i.addChild(t),this.action(n.id,"a1"),t.onComplete=()=>{t.visible=!1};let l,o=()=>{t.visible=!0,t.gotoAndPlay(0)};t.visible=!1,a<=1?l=this.animation("24121",128,768,6,.5):a<=20&&(l=this.animation("24027",96,384,4,.5)),l.loop=!1,l.play(),l.width=30,l.height=30,l.y=n.y+l.height/2,n.width<=0?l.x=n.x+n.width/2+l.width/2*n.scale.x+5:l.x=n.x+n.width/2+l.width/2*n.scale.x-10,l.name="animation2",l.onComplete=()=>{l.visible=!1,t.visible=!0,a>=9&&this.vong_skill(i,h,a),this.action(n.id,"a11"),setTimeout((()=>{this.action(n.id,"a8"),o(),setTimeout((()=>{this.success(e),this.action(n.id,"a10"),setTimeout((()=>{this.action(n.id,"dungyen"),e.type="delete",t.destroy(),l.destroy()}),100)}),100)}),100)},i.addChild(l)}};dam_3_vo_si=(e,t)=>{let i=this.getSkill(e.id),n=this.getSprite(e.from),h=this.getSprite(e.to),a=this.getMy(n.id);if(!n||!h||!a)return e.type="delete";let l=e.level;if(l=l||1,i.run=i.run||0,0==i.run){i.run=1,this.action(n.id,"a1");let t=e=>{let t=this.animation("24027",96,384,4,.5);t.loop=!0,t.play(),t.width=150,t.height=150,t.x=0,t.y=0,t.name="animation",e.addChild(t)};setTimeout((()=>{let h;l<=14?h=this.animation("24001",320,800,5,.3):l>=15&&(h=this.animation("24317",360,1e3,5,.3)),h.loop=!1,h.play(),h.y=n.y,this.action(n.id,"a5"),n.width<=0&&(h.scale.x=-1),h.width=100,h.height=80,h.x=n.x+n.pivot.x-.4*n.width-h.width*n.scale.x/2,l>=5&&l<=9&&t(h),h.name="animation1",h.solan=0,h.delete=0,h.onComplete=()=>{h.solan+=0,h.visible=!1,h.solan<=1&&(h.visible=!0,h.gotoAndPlay(0)),0==h.delete&&(h.delete=1,this.success(e),setTimeout((()=>{this.action(n.id,"dungyen"),e.type="delete",h.destroy()}),100))},i.addChild(h);let o=e=>{let t;return l<=14?t=this.animation("24001",320,800,5,.3):l>=15&&(t=this.animation("24317",360,1e3,5,.3)),t.loop=!0,t.play(),t.y=e.y,e.width<=0&&(t.scale.x=-1),t.width=100,t.height=80,t.x=e.x+e.pivot.x-.4*e.width-t.width*e.scale.x/2,t.name="animation1",t};if(l>=10){let e=this.created_sprite_skin_hi(a,"a5");e.y=n.y-n.height,e.alpha=.5,n.width<=0?(e.scale.x=-1,e.pivot.x=-e.width/2,e.x=n.x+n.width/2):(e.pivot.x=0,e.x=n.x+n.width/2+n.pivot.x);let t=o(e);i.addChild(t),i.addChild(e);let h=this.created_sprite_skin_hi(a,"a5");h.y=n.y+n.height,h.alpha=.5,n.width<=0?(h.scale.x=-1,h.pivot.x=-h.width/2,h.x=n.x+n.width):(h.pivot.x=0,h.x=n.x+n.width);let l=o(h);i.addChild(l),i.addChild(h)}}),200)}}}class j extends K{constructor(){super()}vang_mau_xa_thu=e=>{e.id=e.id||this.randomAZ(10);let t=this.getSprite(e.from);if(!t)return e.type="delete";let i=this.getSkill(e.id);if(i.run=i.run||0,0===i.run){i.run=1;let n=this.animation(24006,152,608,4);i.addChild(n),n.animationSpeed=.5,n.loop=!1,n.play(),t.width<=0&&(n.scale.x=-1),n.width=80,n.height=80,n.x=t.x+t.pivot.x-n.width*n.scale.x/2,n.y=t.y+t.height/2-n.height/2,n.onComplete=()=>{n.visible=!1,n.destroy(),e.type="delete"}}};vang_mau_xa_thu_1=e=>{e.id=e.id||this.randomAZ(10);let t=this.getSprite(e.from);if(!t)return e.type="delete";let i=this.getSkill(e.id);if(i.run=i.run||0,0===i.run){i.run=1;let n=this.animation(24019,200,1080,5);i.addChild(n),n.animationSpeed=.5,n.loop=!1,n.play(),t.width<=0&&(n.scale.x=-1),n.width=80,n.height=80,n.x=t.x+t.pivot.x-n.width*n.scale.x/2,n.y=t.y+t.height/2-n.height/2,n.onComplete=()=>{n.visible=!1,n.destroy(),e.type="delete"}}};xa_thu_attack_1=(e,t)=>{let i=this.getSkill(e.id),n=this.getSprite(e.from),h=this.getSprite(e.to);if(!n||!h)return e.type="delete";i.run=i.run||0;let a=e.level||1;if(0===i.run){let t;this.action(n.id,"a10"),i.run=1,t=a<=4?this.animation(24068,112,528,3):this.animation(24089,112,528,3),i.addChild(t),t.animationSpeed=.5,t.loop=!1,n.width<=0&&(t.scale.x=-1),t.play(),t.width=80,t.height=80,t.x=n.x+n.pivot.x-t.width*t.scale.x*1.4,t.y=n.y,t.ban=1,t.onComplete=()=>{t.visible=!1,1===t.ban?(this.action(n.id,"a11"),t.x=h.x+h.pivot.x-t.width*t.scale.x*.6,t.y=h.y,t.visible=!0,t.gotoAndStop(0),t.play(),setTimeout((()=>{this.action(n.id,"dungyen"),this.danh=!1}),150)):(this.vang_mau_xa_thu({from:h.id}),e.type="delete"),t.ban=0}}};xa_thu_attack_2=(e,t)=>{let i=this.getSkill(e.id),n=this.getSprite(e.from),h=this.getSprite(e.to);if(!n||!h)return e.type="delete";let a=e.level||1;i.run=i.run||0,0===i.run&&(i.run=1,this.action(n.id,"a1"),setTimeout((()=>{this.action(n.id,"a10");let t=()=>{setTimeout((()=>{this.action(n.id,"dungyen"),this.danh=!1}),150)};if(a<=4){let a=this.animation(24020,40,200,5);i.addChild(a),a.animationSpeed=.5,a.loop=!1,a.play(),n.width<=0&&(a.scale.x=-1),a.width=30,a.height=30,a.x=n.x+n.pivot.x-a.width*a.scale.x*3,a.y=n.y+n.height/2-a.height/2,a.onComplete=()=>{a.visible=!1,this.action(n.id,"a11");let l=this.animation(24020,40,200,5);i.addChild(l),l.animationSpeed=.5,l.loop=!0,l.play(),n.width<=0&&(l.scale.x=-1),l.width=30,l.height=30,l.x=n.x+n.pivot.x-l.width*l.scale.x*3,l.y=n.y+h.height/2-l.height/2,this.moveSpeed(1,l,h,null,null,(()=>{l.visible=!1,e.type="delete",this.success(e),this.vang_mau_xa_thu_1({from:h.id})})),t()}}else if(a>=5){let l;l=a<=14?this.animation(24185,220,200,2):this.animation(24333,220,200,2),i.addChild(l),l.animationSpeed=.5,l.loop=!1,l.play(),n.width<=0&&(l.scale.x=-1),l.width=130,l.height=50,l.x=n.x+n.pivot.x-l.width*l.scale.x*2,l.y=n.y,l.lop=1,l.onComplete=()=>{if(1===l.lop)l.visible=!0,l.gotoAndStop(0),l.play(),l.lop=2;else{let o;l.visible=!1,this.action(n.id,"a11"),a<=9?(o=this.animation(24288,120,480,4),i.addChild(o),o.animationSpeed=.5,o.loop=!0,o.play(),n.width<=0&&(o.scale.x=-1),o.width=30,o.height=30,o.x=n.x+n.pivot.x-o.width*o.scale.x*3,o.y=n.y+h.height/2-o.height/2):(o=a<=14?this.animation(24285,444,1080,3):this.animation(24332,444,1080,3),i.addChild(o),o.animationSpeed=.3,o.loop=!0,o.play(),n.width<=0&&(o.scale.x=-1),o.width=150,o.height=130,o.x=n.x+n.pivot.x-o.width*o.scale.x*3,o.y=n.y+h.height/2-o.height/2);let d=()=>{o.visible=!1,e.type="delete",this.success(e),this.vang_mau_xa_thu_1({from:h.id})};this.moveSpeed(.6,o,h,null,null,d),t()}l.lop=0}}}),100))};xa_thu_attack_3=(e,t)=>{let i=this.getSkill(e.id),n=this.getSprite(e.from),h=this.getSprite(e.to);if(!n||!h)return e.type="delete";e.level,i.run=i.run||0,0===i.run&&(i.run=1,this.action(n.id,"a1"),setTimeout((()=>{this.action(n.id,"a10");let t=this.animation(24188,36,192,3);i.addChild(t),t.animationSpeed=.5,t.loop=!0,t.play(),n.width<=0&&(t.scale.x=-1),t.width=30,t.height=30,t.x=n.x+n.pivot.x-t.width*t.scale.x*3,t.y=n.y+h.height/2-t.height/2,this.moveSpeed(1,t,h,null,null,(()=>{this.success(e),t.visible=!1,t.destroy(),this.vang_mau_xa_thu({from:h.id});for(let t=0;t<3;t++){let a=this.animation(24111,160,720,6);a.animationSpeed=.5,a.loop=!1,a.play(),n.width<=0&&(a.scale.x=-1),a.width=60,a.height=60,a.onComplete=()=>{a.gotoAndStop(4),a.play()},a.x=h.x+n.pivot.x-a.width*a.scale.x*3,a.y=h.y+h.height/2-a.height/2,setTimeout((()=>{i.addChild(a),this.moveSpeed(1,a,{x:h.x+this.rand(-200,200),y:h.y-h.height},null,null,(()=>{a.visible=!1;let h=this.animation(24113,100,500,5);h.animationSpeed=.3,h.loop=!1,h.play(),n.width<=0&&(h.scale.x=-1),h.width=100,h.height=100,h.x=a.x,h.y=a.y+a.height/2-h.height/2,a.destroy(),i.addChild(h),h.onComplete=()=>{h.visible=!1,h.destroy(),2===t&&(e.type="delete")}}))}),300*t)}})),setTimeout((()=>{this.action(n.id,"a11"),setTimeout((()=>{this.action(n.id,"dungyen"),this.danh=!1}),150)}),100)}),150))}}class U extends j{constructor(){super()}hieu_ung_kiem_khach=e=>{e.id=e.id||this.randomAZ(10);let t=this.getSkill(e.id),i=this.getSprite(e.from);if(!i)return e.type="delete";if(t.run=t.run||0,0===t.run){let n=this.animation(24015,220,660,3);n.loop=!1,n.animationSpeed=1,n.visible=!0,n.play(),i.width<=0&&(n.scale.x=-1),n.width=100,n.height=100,n.x=i.x+i.pivot.x-n.width/2*n.scale.x,n.y=i.y+i.height/2-n.height/2,n.onComplete=()=>{e.type="delete",n.visible=!1},t.addChild(n)}};kiem_khach_attack_3=(e,t)=>{const i=this.getSkill(e.id);let n=this.getSprite(e.from),h=this.getSprite(e.to);if(!n||!h)return e.type="delete";e.level,i.run=i.run||0,0===i.run&&(i.run=1,this.action(e.from,"a1"),setTimeout((()=>{this.action(e.from,"a5");let t=this.animation(24167,312,352,4);i.addChild(t),t.animationSpeed=.3,t.loop=!0,t.play(),n.width<=0&&(t.scale.x=-1),t.width=100,t.height=50,t.x=n.x+n.pivot.x-t.width*t.scale.x+n.width,t.y=n.y+n.height-t.height;let a=this.animation(24165,108,600,3);i.addChild(a),a.animationSpeed=.3,a.loop=!0,a.play(),n.width<=0&&(a.scale.x=-1),a.width=70,a.height=70,a.x=n.x+n.pivot.x-a.width*a.scale.x,a.y=n.y+n.height/2-a.height/2;for(let l=0;l<3;l++){let o=this.animation(24028,184,800,4);o.animationSpeed=.5,o.loop=!0,o.play(),o.width=80,o.height=80,o.x=n.x,o.y=n.y+n.height/2-o.height/2,setTimeout((()=>{i.addChild(o),this.moveSpeed(.8,o,h,null,null,(()=>{o.destroy(),this.hieu_ung_kiem_khach({from:e.to}),2===l&&(a.destroy(),t.destroy(),this.action(e.from,"dungyen"),e.type="delete",this.success(e))}))}),100*l)}}),200))};kiem_khach_attack_2=(e,t)=>{const i=this.getSkill(e.id);let n=this.getSprite(e.from),h=this.getSprite(e.to);if(!n||!h)return e.type="delete";let a=e.level||1;if(i.run=i.run||0,0===i.run){i.run=1;let t=this.animation(24413,273,657,3);t.animationSpeed=.5,t.loop=!0,t.play(),n.width<=0&&(t.scale.x=-1),t.width=150,t.height=150,t.x=n.x+n.pivot.x-t.width*t.scale.x/2,t.y=n.y,i.addChild(t);let l=()=>{t.visible=!1,n.visible=!0};t.visible=!0,n.visible=!1,setTimeout((()=>{l(),n.x<h.x?n.x=h.x-50:n.x=h.x+50,n.y=h.y-30;for(let e=0;e<2;e++){let t;t=a<=9?this.animation(24076,128,840,4):a<=14?this.animation(24319,128,840,4):this.animation(24422,96,630,4),t.q=h.x,t.w=h.y,i.addChild(t),t.animationSpeed=.5,t.loop=!0,t.play(),h.width<=0&&(t.scale.x=-1),t.width=50,t.height=100,t.x=h.x+h.pivot.x-t.width*t.scale.x/2,t.y=h.y+t.height*e-20-h.height/2,t.onLoop=()=>{h.x=t.q,h.y=t.w},this.action(n.id,"a2"),setTimeout((()=>{t.visible=!1,t.destroy()}),300)}let o;o=a<=9?this.animation(24070,208,960,4):a<=14?this.animation(24279,280,1120,4):this.animation(24420,210,840,4),o.animationSpeed=.3,o.loop=!1,o.scale.x=1,o.width=100,o.height=100,o.play(),o.x=h.x+h.pivot.x-o.width*o.scale.x/2,o.y=h.y+h.height/2-o.height/2,i.addChild(o),o.suc=0,this.hieu_ung_kiem_khach({from:h.id}),o.onComplete=()=>{0===o.suc?(o.scale.x=-1,o.width=100,o.height=100,o.gotoAndPlay(0),o.x=h.x+h.pivot.x-o.width*o.scale.x/2,o.y=h.y+h.height/2-o.height/2,o.suc=1,this.action(n.id,"a5"),this.hieu_ung_kiem_khach({from:h.id})):(this.action(n.id,"dungyen"),o.visible=!1,o.destroy(),t.destroy(),e.type="delete",n.y+=30,this.hieu_ung_kiem_khach({from:h.id}),this.success(e))}}),100)}};kiem_khach_attack_1=(e,t)=>{const i=this.getSkill(e.id);let n=this.getSprite(e.from),h=this.getSprite(e.to);if(!n||!h)return e.type="delete";if(i.run=i.run||0,0===i.run){i.run=1;let t=e.level||1,a=0;t<=4?a=1:t<=9?a=0:t<=14&&(a=2),this.action(n.id,"a2");let l=this.animationw(24301,960,384,3,3,a,[1,2,1,2,1]);l.animationSpeed=.2,l.loop=!1,l.play(),n.width<=0&&(l.scale.x=-1),i.addChild(l),l.width=130,l.height=70,l.x=n.x+n.pivot.x-l.width*l.scale.x*2,l.y=n.y,l.onFrameChange=()=>{l.currentFrame},l.onComplete=()=>{this.hieu_ung_kiem_khach({from:h.id}),l.visible=!1},l.solan=0,setTimeout((()=>{this.action(n.id,"a3"),l.visible=!0,setTimeout((()=>{this.action(n.id,"a2"),l.visible=!0,setTimeout((()=>{l.destroy(),e.type="delete",this.success(e),this.action(n.id,"dungyen")}),100)}),100)}),200)}}}class V extends U{constructor(){super()}hieu_ung_hoa_tieu2=(e,t)=>{e.id=e.id||this.randomAZ(10);let i=this.getSkill(e.id),n=this.getSprite(e.from);if(!n)return e.type="delete";if(i.run=i.run||0,0===i.run){let t=this.animation(24098,312,1120,4);t.loop=!1,t.animationSpeed=1,t.visible=!0,t.play(),n.width<=0&&(t.scale.x=-1),t.width=100,t.height=100,t.x=n.x+n.pivot.x-t.width/2*t.scale.x,t.y=n.y+n.height/2-t.height/2,t.onComplete=()=>{e.type="delete",t.visible=!1,t.destroy()},i.addChild(t)}};hieu_ung_hoa_tieu=(e,t)=>{e.id=e.id||this.randomAZ(10);let i=this.getSkill(e.id),n=this.getSprite(e.from);if(!n)return e.type="delete";if(i.run=i.run||0,0===i.run){let t=this.animation(24143,152,608,4);t.loop=!1,t.animationSpeed=1,t.visible=!0,t.play(),n.width<=0&&(t.scale.x=-1),t.width=100,t.height=100,t.x=n.x+n.pivot.x-t.width/2*t.scale.x,t.y=n.y+n.height/2-t.height/2,t.onComplete=()=>{e.type="delete",t.visible=!1,t.destroy()},i.addChild(t)}};hoa_tieu_attack_3=(e,t)=>{const i=this.getSkill(e.id);let n=this.getSprite(e.from),h=this.getSprite(e.to);if(!n||!h)return e.type="delete";if(i.run=i.run||0,0===i.run){i.run=1;let t=()=>{let t=this.animation(24081,96,384,4);t.loop=!0,t.animationSpeed=.5,t.visible=!0,t.play(),i.addChild(t),n.width<=0&&(t.scale.x=-1),t.width=40,t.height=40,t.x=n.x+n.pivot.x-t.width*t.scale.x*3,t.y=n.y-t.height/2,this.moveSpeed(.8,t,{x:h.x,y:h.y-h.height-t.height},null,null,(()=>{this.action(n.id,"dungyen"),t.visible=!1;let a=this.animation(24095,128,432,4);a.loop=!0,a.animationSpeed=.4,a.visible=!0,a.play(),a.width=70,a.height=70,a.x=t.x,a.y=t.y,i.addChild(a),setTimeout((()=>{a.visible=!1;for(let l=0;l<3;l++){let o=l;n.width<=0&&(o=-1*l);let d=this.animationX(24407,312,597,2);d.animationSpeed=.3,d.loop=!0,d.width=70,d.height=200,d.x=a.x-o*d.width,d.y=h.y-d.height+h.height,d.solan=0,d.onLoop=()=>{d.solan++,d.solan>=2&&(d.loop=!1)},d.onComplete=()=>{d.visible=!1,d.destroy(),this.hieu_ung_hoa_tieu2({from:e.to},null),2===l&&(e.type="delete",this.success(e),a.destroy(),t.destroy())},setTimeout((()=>{i.addChild(d),d.play()}),100*l)}}),200)}))};this.action(n.id,"a12"),setTimeout((()=>{this.action(n.id,"a9"),setTimeout((()=>{this.action(n.id,"a11"),setTimeout((()=>{this.action(n.id,"a8"),t()}),100)}),100)}),100)}};hoa_tieu_attack_2=(e,t)=>{const i=this.getSkill(e.id);let n=this.getSprite(e.from),h=this.getSprite(e.to);if(!n||!h)return e.type="delete";i.run=i.run||0,0===i.run&&(i.run=1,this.action(n.id,"a9"),setTimeout((()=>{let t;this.action(n.id,"a8");let a=e.level||1,l=1;a=15,l=l<=14?2:l<=19?3:4,t=this.animationw("24298",480,576,6,5,l),t.loop=!0,t.animationSpeed=.5,t.visible=!0,t.play(),n.width<=0&&(t.scale.x=-1),t.width=40,t.height=40,t.x=n.x+n.pivot.x-t.width*n.scale.x*1.1,t.y=n.y-25,i.addChild(t),setTimeout((()=>{this.action(n.id,"dungyen");let i=()=>{this.success(e),t.visible=!1,t.destroy(),e.type="delete"},a=()=>{this.hieu_ung_hoa_tieu({from:h.id},null),this.moveSpeed(1,t,{x:h.x+h.pivot.x+t.width*n.scale.x,y:h.y+h.height/2-t.height/2},null,null,i)},l=()=>{this.hieu_ung_hoa_tieu({from:h.id},null),this.moveSpeed(1,t,{x:h.x+h.pivot.x-t.width*n.scale.x,y:h.y+h.height/2-t.height/2},null,null,a)},o=()=>{this.hieu_ung_hoa_tieu({from:h.id},null),this.moveSpeed(1,t,{x:h.x-h.pivot.x,y:h.y+h.height},null,null,l)},d=()=>{this.hieu_ung_hoa_tieu({from:h.id},null),this.moveSpeed(1,t,{x:h.x+h.pivot.x,y:h.y-40},null,null,o)};this.moveSpeed(1,t,{x:h.x+h.pivot.x,y:h.y-40},null,null,(()=>{this.hieu_ung_hoa_tieu({from:h.id},null),this.moveSpeed(1,t,{x:h.x+h.pivot.x-t.width*n.scale.x*1.1,y:h.y+h.height},null,null,d)}))}),100)}),200))};hoa_tieu_attack_1=(e,t)=>{const i=this.getSkill(e.id);let n=this.getSprite(e.from),h=this.getSprite(e.to);if(!n||!h)return e.type="delete";if(i.run=i.run||0,0===i.run){let t;this.action(e.from,"a8"),i.run=1;let a=e.level||1,l=1;a=15,l=a<=1?0:a<=9?1:l<=14?2:l<=19?3:4,t=this.animationw("24298",480,576,6,5,l),t.loop=!0,t.animationSpeed=.5,t.visible=!0,t.play(),n.width<=0&&(t.scale.x=-1),t.width=40,t.height=40,t.x=n.x+n.pivot.x-t.width*n.scale.x*1.1,t.y=n.y-25,i.addChild(t),setTimeout((()=>{this.hieu_ung_hoa_tieu({from:h.id},null),this.success(e),t.visible=!1,e.type="delete",t.destroy(),this.action(e.from,"dungyen")}),500)}}}class Y extends V{constructor(){super()}daubep_attack_1=(e,t)=>{let i=this.getSkill(e.id),n=this.getSprite(e.from),h=this.getSprite(e.to);if(!n||!h)return e.type="delete";if(i.run=i.run||0,0===i.run){let t;i.run=1;let h=e.level||1;t=h<=4?this.animation("24068",112,512,3,.5):h<=9?this.animation("24089",112,528,3,.5):h<=14?this.animation("24100",60,400,5,.5):this.animation("24074",240,592,2,.5),t.loop=!0,t.animationSpeed=.3,n.width<=0&&(t.scale.x=-1),t.visible=!1;let a=i=>{if(i)return this.success(e),this.action(e.from,"dungyen"),e.type="delete",t.destroy(),!1;t.gotoAndPlay(0),t.visible=!0};t.onComplete=()=>{t.visible=!1},t.width=60,t.height=80,t.x=n.x+n.pivot.x-n.width-t.width*n.scale.x/2,t.y=n.y,this.action(e.from,"a6"),setTimeout((()=>{this.action(e.from,"a7"),a(),setTimeout((()=>{this.action(e.from,"a6"),a(),setTimeout((()=>{this.action(e.from,"a14"),a(1)}),200)}),200)}),100),i.addChild(t)}};daubep_attack_2=(e,t)=>{let i=this.getSkill(e.id),n=this.getSprite(e.from),h=this.getSprite(e.to);if(!n||!h)return e.type="delete";if(i.run=i.run||0,0===i.run){let t;i.run=1;let a=e.level||1;t=a<=4?this.animation("24068",112,512,3,.5):a<=9?this.animation("24089",112,528,3,.5):a<=14?this.animation("24100",60,400,5,.5):this.animation("24074",240,592,2,.5),t.loop=!0,t.animationSpeed=.3,n.width<=0&&(t.scale.x=-1),t.visible=!1;let l,o=i=>{i?(this.action(e.from,"dungyen"),t.visible=!1):(t.gotoAndPlay(0),t.visible=!0)};t.onComplete=()=>{t.visible=!1},t.width=60,t.height=80,t.x=n.x+n.pivot.x-n.width-t.width*n.scale.x/2,t.y=n.y,this.action(e.from,"a6"),l=a<=4?this.animation("24102",140,228,3,.5):this.animation("24103",140,228,3,.5),l.loop=!1,l.animationSpeed=.3,l.visible=!1,l.run=0,l.play(),l.name="animation2",l.scale.x=n.scale.x,l.width=50,l.height=50,l.x=t.x,l.y=t.y,i.addChild(l);let d=()=>{l.visible=!0,this.moveSpeed(1,l,h,TWEEN.Easing.Linear.Quintic,(()=>{}),(()=>{this.success(e),l.visible=!1,e.type="delete",t.destroy(),l.destroy()}))};setTimeout((()=>{this.action(e.from,"a7"),o(),setTimeout((()=>{this.action(e.from,"a6"),d(),setTimeout((()=>{this.action(e.from,"a14"),o(1)}),200)}),200)}),100),i.addChild(t)}};daubep_attack_3=(e,t)=>{let i=this.getSkill(e.id),n=this.getSprite(e.from),h=this.getSprite(e.to);if(!n||!h)return e.type="delete";if(i.run=i.run||0,0===i.run){let t;i.run=1;let h,a=e.level||1;h=a>=5&&a<=9?this.animation("24077",256,1200,4,.5):this.animation("24412",192,900,4,.5),h.loop=!0,h.animationSpeed=.3,h.width=120,h.height=110,h.visible=!1,h.x=n.x+n.pivot.x-h.width/2,h.y=n.y+n.height/2-h.height/2,i.addChild(h),h.play(),t=this.animation("24031",280,1680,6,.5),t.loop=!1,t.animationSpeed=.2,n.width<=0&&(t.scale.x=-1),t.width=100,t.height=100,t.x=n.x+n.pivot.x-n.width-t.width*n.scale.x/2,t.y=n.y,t.visible=!1,t.value=0,this.action(e.from,"a1"),setTimeout((()=>{t.visible=!0,a>=5&&(h.visible=!0),t.play()}),100),t.onFrameChange=()=>{let e=t.currentFrame;1===e?this.action(n.id,"a6"):2===e?this.action(n.id,"a7"):3===e?this.action(n.id,"a6"):4===e?this.action(n.id,"a14"):5===e&&this.action(n.id,"a15")},t.onComplete=()=>{e.type="delete",this.success(e),t.visible=!1,t.destroy(),h.destroy(),this.action(n.id,"dungyen")},i.addChild(t)}}}class q extends Y{constructor(){super()}mob_att_1=(e,t)=>{let i=this.getSkill(e.id),n=this.getSprite(e.from);if(!n)return;let h=this.getSprite(e.to);if(h&&(i.run=i.run||0,0==i.run)){let t=this.animation(24e3,56,224,4);i.addChild(t),t.play(),t.loop=!0,t.animationSpeed=.3,t.x=n.x,t.y=n.y,t.width=40,t.height=40;let a=()=>{t.visible=!1,e.type="delete"};this.move(t,{x:h.x,y:h.y},500,TWEEN.Easing.Circular.Out,0,a,h),i.run=1}}}class Z extends q{constructor(){super()}congexp=(e,t)=>{let i=this.getSkill(e.id),n=this.getSprite(e.from);if(n&&(i.run=i.run||0,0===i.run)){i.run=1;let t=e.value,h=3381504,a=new PIXI.Text("+"+t+" xp",{fontFamily:"CherryBombOne-Regular",fontSize:16,fill:h,align:"center"}),l=n.x+n.pivot.x,o=n.y+this.rand(0,n.height);a.x=l,a.y=o,a.style.stroke="#000000",a.style.strokeThickness=4;let d=()=>{setTimeout((()=>{e.type="delete",a.visible=!1}),50)};this.move(a,{y:a.y-this.rand(90,150)-a.height},500,0,0,d),i.addChild(a)}};conghp=(e,t)=>{let i=this.getSkill(e.id),n=this.getSprite(e.from);if(n&&(i.run=i.run||0,0===i.run)){i.run=1;let t=e.value,h=13369344,a=e.who;2===a&&(h=26367);let l="HP";2===a&&(l="MP");let o=new PIXI.Text("+"+t+" "+l,{fontFamily:"CherryBombOne-Regular",fontSize:20,fill:h,align:"center"}),d=n.x+n.pivot.x,r=n.y+this.rand(0,n.height);o.x=d,o.y=r,o.style.stroke="#000000",o.style.strokeThickness=4;let s=()=>{setTimeout((()=>{e.type="delete",o.visible=!1}),50)};this.move(o,{y:o.y-this.rand(90,150)-o.height},500,0,0,s),i.addChild(o)}};tru_hp=(e,t)=>{let i=this.getSkill(e.id),n=this.getSprite(e.from);if(n&&(i.run=i.run||0,0===i.run)){this.setSkill({from:e.from,type:"vangmau",key:this.randomAZ(10)}),i.run=1;let t=e.value,h=16777215,a=e.st;2===a&&(h=8388736),3===a&&(h=16776960);let l=new PIXI.Text(t,{fontFamily:"CherryBombOne-Regular",fontSize:20,fill:h,align:"center"}),o=n.x+n.pivot.x,d=n.y+this.rand(0,n.height);l.x=o,l.y=d,l.style.stroke="#000000",l.style.strokeThickness=4;let r=()=>{setTimeout((()=>{e.type="delete",l.visible=!1,l.destroy()}),100)};this.move(l,{y:l.y-this.rand(90,150)-l.height},500,0,0,r),i.addChild(l)}}}class J extends Z{constructor(){super()}updateBuocChay=(e,t)=>{let i=this.getSkill(e.id,1),n=this.getSprite(e.from);if(!n)return e.type="delete";if(i.run=i.run||0,0==i.run){let t=this.createAnimation("x2Main_Image_interface_eff_inmap0",24,48,3,.05);t.x=n.x,t.y=n.y+n.height-t.height/2,"right"==n.huong&&(t.scale.x=-1),i.run=1,t.play(),t.onComplete=()=>{TweenMax.to(t,.5,{alpha:0,onComplete:()=>{t.destroy(),e.type="delete"}})},i.addChild(t)}}}class Q extends J{constructor(){super()}updateSkill=e=>{this.cache_skill.forEach((t=>{"delete"===t.type&&this.deleteSkill(t.id),"congexp"===t.type&&this.congexp(t,e),"mob_att_1"===t.type&&this.mob_att_1(t,e),"conghp"===t.type&&this.conghp(t,e),"hp"===t.type&&this.tru_hp(t,e),"move"===t.type&&this.updateBuocChay(t,e),"vs1"===t.type&&this.dam_1_vo_si(t,e),"vs2"===t.type&&this.dam_2_vo_si(t,e),"vs3"===t.type&&this.dam_3_vo_si(t,e),"db1"===t.type&&this.daubep_attack_1(t,e),"db2"===t.type&&this.daubep_attack_2(t,e),"db3"===t.type&&this.daubep_attack_3(t,e),"ht1"===t.type&&this.hoa_tieu_attack_1(t,e),"ht2"===t.type&&this.hoa_tieu_attack_2(t,e),"ht3"===t.type&&this.hoa_tieu_attack_3(t,e),"kk1"===t.type&&this.kiem_khach_attack_1(t,e),"kk2"===t.type&&this.kiem_khach_attack_2(t,e),"kk3"===t.type&&this.kiem_khach_attack_3(t,e),"xt1"===t.type&&this.xa_thu_attack_1(t,e),"xt2"===t.type&&this.xa_thu_attack_2(t,e),"xt3"===t.type&&this.xa_thu_attack_3(t,e),"sea"===t.type&&((e,t,i)=>{let n=e.getMy(t.from),h=e.getSprite(t.from);if(!n||!h)return!1;let a=((e,t)=>{let i=e.thuyenNen.getChildByName("thuyen_"+t);if(!i){console.log(t),i=new PIXI.Container,i.name="thuyen_"+t,e.thuyenNen.addChild(i);let n=new PIXI.Sprite(e.coverImg("8000"));n.name="body_thuyen",n.x=0,n.y=0,n.height=80,n.width=230,i.addChild(n);let h=new PIXI.Sprite(e.coverImg("8001"));h.name="cotbuon",h.height=220,h.width=24,h.x=n.width-h.width,h.y=n.height/2-h.height/2,n.addChild(h);let a=e.animation("8002",152,296,2,.5,!0);a.name="canhbuon",a.animationSpeed=.15,a.x=h.x-a.width/2,a.y=h.y,a.height=150,a.width=130,a.play(),n.addChild(a)}return i})(e,t.from),l=((e,t)=>{let i=e.thuyen.getChildByName("thuyen_"+t);if(!i){let n=new PIXI.Container;n.name="thuyen_"+t,e.thuyen.addChild(n);let h=new PIXI.Sprite(e.coverImg("8003"));h.name="body_che",h.x=0,h.y=0,h.height=50,h.width=185,n.addChild(h),i=n,Math.ceil(h.width/100);let a=E("x2Main_Image_bg_boateff",156,48,2,.1,!0);a.name="animationSea",a.x=0,a.y=h.height-a.height/2,a.play(),a.width=h.width-0,a.height=48,n.addChild(a)}return i})(e,t.from);-1!==a.scale.x&&h.width<0&&(a.scale.x=-1,l.scale.x=-1),h.width>0&&1!==a.scale.x&&(a.scale.x=1,l.scale.x=1),a.x=h.x+h.pivot.x-h.width/2-a.width/2,a.y=h.y+.8*h.height-40,l.x=a.x+45*a.scale.x-h.width/2,l.y=a.y+30,!0===h.sea&&(h.sea=!1,((e,t)=>{let i=e.getSkill(e.randomAZ(10),1),n=E("eff1",144,166,2,.05,!1);n.x=t.x,n.y=t.y+t.height-n.height/2,n.play(),"right"===t.huong&&(n.scale.x=-1),n.onComplete=()=>{TweenMax.to(n,.5,{alpha:0,onComplete:()=>{n.destroy()}})},i.addChild(n)})(e,h))})(this,t),"vangmau"===t.type&&((e,t)=>{let i=e.getSkill(t.id),n=e.getSprite(t.from);if(i.run=i.run||1,!n)return t.type="delete";if(1===i.run){i.run=5;let h=e.createAnimationArray(["vang_1","vang_2","vang_3"],.4,!1);h.height=32,n.width<=0&&(h.scale.x=-1),h.x=n.x+n.pivot.x,h.y=n.y+h.height/2,h.play(),h.onComplete=()=>{t.type="delete"},i.addChild(h)}})(this,t)}))};getSkill=(e,t=0)=>{let i;return 0===t&&(i=this.eff.getChildByName("eff_"+e)),1===t&&(i=this.eff2.getChildByName("eff_"+e)),i||(i=new PIXI.Container,i.name="eff_"+e,0===t&&this.eff.addChild(i),1===t&&this.eff2.addChild(i),i)};setSkill=e=>{if(e.id||(e.id=this.randomAZ(10)),this.cache_skill.find((t=>t.id===e.id)))return!1;this.cache_skill.push(e)};deleteSkill=e=>{let t=this.eff.getChildByName("eff_"+e);t&&this.deleteAllChild(t);let i=this.eff2.getChildByName("eff_"+e);i&&this.deleteAllChild(i),this.cache_skill=this.cache_skill.filter((t=>t.id!=e))};test=(e,t=-1)=>{-1==t&&(this.changeClick(),t=this.click),-1!=t&&this.setSkill({from:this.my.id,to:t,type:e,key:this.randomAZ(10),value:this.rand(1e3,2e3)})};sprite=e=>{let t={x:0,y:0};return t.y=e.y,t.x=e.x,e.width<0&&(t.x=e.x+e.pivot.x),t};success=e=>{let t=this.my;if(t.id<=0)return!1;t.id==e.from&&e.keycode&&this.to(-6,[3,e.keycode])}}class $ extends Q{constructor(){super(),this.timeRefresh_effect=0}update_text_thong_bao=e=>{let t=this.button.getChildByName("chat_thong_bao");if(!t)return!1;if(!0===t.visible){let i=t.getChildByName("data");if(!i)return!1;let n=i.getChildByName("text");if(!n)return!1;n.x-=1.1*e,n.x<=-n.width&&(t.visible=!1,this.deleteAllChild(t,!1))}else if(this.cache_thong_bao.length>=1){let e=this.cache_thong_bao.shift();this.create_chat_thong_bao(e)}};update_text_chat_the_gioi=e=>{let t=this.button.getChildByName("chat_the_gioi");if(!t)return!1;if(!0===t.visible){let i=t.getChildByName("data");if(!i)return!1;let n=i.getChildByName("backgorund_text");if(!n)return!1;let h=n.getChildByName("txt");if(!h)return!1;h.x-=1.1*e,Math.round(h.x)<=-Math.round(h.width)&&(this.deleteEvent("chatthegioi"),this.deleteAllChild(t,!1),t.visible=!1)}else if(this.cache_chat_the_gioi.length>=1){let e=this.cache_chat_the_gioi.shift();this.create_chat_the_gioi(e[0],e[1],e[2])}};updateProfileEffect=e=>{let t=this.my;if(!t)return!1;if(this.update_text_chat_the_gioi(e),this.update_text_thong_bao(e),this.timeRefresh_effect+=e,this.timeRefresh_effect<=10)return!1;this.timeRefresh_effect=0;let i=this.button.getChildByName("hieuung");if(!i)return!1;this.deleteAllChild(i,!1);let n=.5*this.gameWidth,h=.5*this.gameHeight,a=.3*n,l=.3*h;l=l>45?45:l,a=a>40?40:a;let o=t.eff,d=[],r=-1;if(!o)return!1;o.forEach((e=>{let t=e[0],n=this.skill.find((e=>e.id===t));if(n&&!d.find((e=>e===n.id))){r++,d.push(n.id);let t=new PIXI.Graphics;t.beginFill(0,1e-6),t.drawRect(0,0,a,l),t.endFill(),t.x=(a+5)*r,t.y=0,i.addChild(t);let h=t.width,o=.8*t.height,s=new PIXI.Sprite(this.coverImg(n.avatar));s.width=h,s.height=o,t.addChild(s);let c=new PIXI.Text(this.coverTime(e[3]),{fontFamily:"Arial",fontSize:12,fill:16777215,align:"center",fontWeight:"bold"});c.anchor.set(.5),c.x=h/2,c.y=o+5,t.addChild(c)}}))}}class ee extends ${constructor(){super(),this.deltatime=0,this.timeOld=0}updateRenderInfoPlayer=e=>{let t=this.my;if(t.id<=0)return!1;let i=this.button;if(i){let e=i.getChildByName("khung_nhan_vat_chinh");if(e){let i=e.getChildByName("main");if(i){let e=i.getChildByName("borderHP");if(e){let i=e.getChildByName("hpinfo");if(i){let e=i.getChildByName("background_hp");if(e){let i=e.getChildByName("hpget"),n=e.getChildByName("txt"),h=t.info.chiso.hp,a=t.info.chiso.hpmax;h>a&&(h=a),h<0&&(h=0);let l=h/a*100,o=e.width*l/100;i&&(i.width=o),n&&(n.text=h+"/"+a,n.x=e.width/2-n.width/2,n.y=e.height/2-n.height/2)}}let n=e.getChildByName("mpinfo");if(n){let e=n.getChildByName("background_mp");if(e){let i=e.getChildByName("mpget"),n=e.getChildByName("txt"),h=t.info.chiso.mp,a=t.info.chiso.mpmax;h>a&&(h=a),h<0&&(h=0);let l=h/a*100,o=e.width*l/100;i&&(i.width=o),n&&(n.text=h+"/"+a,n.x=e.width/2-n.width/2,n.y=e.height/2-n.height/2)}}}let n=i.getChildByName("BorderLevel");if(n){let e=n.getChildByName("txtlevel");if(e){let i="",n=t.info.coban.level,h=t.info.coban.exp,a=this.explevel[n];a=a&&null!=a?a:0,h=h>a?a:h,i=n+" + "+Math.fround(h/a*100).toFixed(2)+"%",e.text=i}}}}}};updateRenderSkill=(e,t=!1)=>{if(this.updateProfileEffect(e),this.runGame,this.updateRenderInfoPlayer(e),this.deltatime+=e,!t&&this.deltatime<=10)return!1;this.deltatime=0;let i=this.my;if(i.id<=0)return!1;let n=this.button,h=n.getChildByName("oskill1"),a=n.getChildByName("oskill2"),l=0,o=0;if(n){h&&a&&(1==h.visible?(l=0,o=4):(l=5,o=9));for(let e=l;e<=o;e++){let t,n,l=i.oskill[e];if(e<=4?(t=h.getChildByName("txt_"+e),n=h.getChildByName("skill_"+e)):(t=a.getChildByName("txt_"+e),n=a.getChildByName("skill_"+e)),-1!=l&&t&&n){let h=i.skill.find((e=>e[0]==l));if(h){let e=this.skill.find((e=>e.id==l));if(e){n.visible=!0,n.icon=n.icon||null,null!=n.icon&&n.icon==e.avatar||(n.texture=this.coverImg(e.avatar),n.icon=e.avatar);let i=h[2],a=h[4];if(i=i||0,a=a||0,i>Date.now()){let e=i-Date.now(),a=Math.fround(e/1e3);a=a.toFixed(2),t.text=a,t.style.fontSize=14,t.x=n.x+n.width/2-t.width/2,t.y=n.y+n.height/2-t.height/2;let l=(Date.now()-h[4])/(h[2]-h[4])*100/100;l=l<=.2?.2:l,n.alpha=l,t.visible=!0}else n.alpha=1,t.visible=!1}}else{let h=()=>{n.visible=!1,n.text=!1,i.oskill[e]=-1},a=i.ruong.data.find((e=>e.id===l&&"hanhtrang"===e.active));if(a){let e=this.item.find((e=>e.id===a.item));if(e){n.visible=!0,n.icon=n.icon||null;let i=e.img,h=i.src,l=i.num;if(null==n.icon||n.icon!=h)if(n.icon=h,l<=1)n.texture=this.coverImg(h);else{let e=80,t=80,i=new PIXI.Sprite(this.coverImg(h)),a=new PIXI.Texture(i.texture,new PIXI.Rectangle(0,0*t,e,t));n.texture=a}t.text=a.soluong,t.style.fontSize=14,t.x=n.x+n.width/2-t.width/2,t.y=n.y+n.height/2-t.height/2,t.visible=!0}else h()}else h()}}else t&&(t.visible=!1),n&&(n.visible=!1)}}}}class te extends ee{constructor(){super(),this.logChipi=[]}chipi=e=>{if(!this.logChipi.find((t=>t==e))){if(this.chipiBox.children.length>=1&&this.chipiBox.getChildByName("chipi").getChildByName("chipi_msg").getChildByName("chipi_txt").text==e)return;this.logChipi.push(e)}};chipiView=(e=0)=>{if(this.my.id<=0)return!1;if(this.logChipi.length>=1&&this.chipiBox.children.length<=0){let e=this.logChipi[0];this.logChipi.shift();let t=new PIXI.Container;t.name="chipi",this.chipiBox.addChild(t);let i=this.animation("7320",100,500,5,.3,!0);i.play(),i.name="chipi_img",t.addChild(i),i.width=70,i.height=70,i.x=this.gameWidth/2;const n=10,h=new PIXI.Graphics;h.name="chipi_msg";const a=new PIXI.TextStyle({align:"center",breakWords:!0,fontSize:14,whiteSpace:"normal",wordWrap:!0,wordWrapWidth:150,fontWeight:"bold"}),l=new PIXI.Text(e,a);l.wordWrapWidth=200-2*n,l.resolution=2,l.anchor.set(.5),h.addChild(l),l.name="chipi_txt",l.position.set(h.width/2,h.height/2),h.lineStyle(1,0,3),h.beginFill(16694636),h.drawRoundedRect(-n,-n,l.width+2*n<150?150:l.width+2*n,l.height+2*n<50?50:l.height+2*n,10),h.endFill(),h.pivot.set(h.width/2,h.height/2),h.visible=!1;const o=new PIXI.Graphics;o.beginFill(16694636),o.lineStyle(1,0,3),o.moveTo(0,0),o.lineTo(10,10),o.lineTo(20,0),o.endFill(),o.pivot.set(o.width/2,o.height/2),o.position.set(h.width/2-o.width/2,h.height-o.height+4),h.addChild(o),t.addChild(h)}if(this.chipiBox.children.length>=1){let t=this.getSprite(this.my.id);if(!t)return;t.huong=t.huong||"left";let i=this.chipiBox.getChildByName("chipi"),n=i.getChildByName("chipi_img"),h=i.getChildByName("chipi_msg"),a=h.getChildByName("chipi_txt");i.time=i.time||0,i.time+=e,i.chipi=i.chipi||1,1===this.chipiBox.have&&(this.chipiBox.have=0,i.chipi=2,h.visible=!0);let l=t.getGlobalPosition();n.stop=n.stop||1,"right"===t.huong?(n.scale.x=1,n.width=70):"left"===t.huong&&(n.scale.x=-1,n.width=70);let o="right"===t.huong?l.x-Math.abs(t.width)-n.width+t.pivot.x:l.x+t.width+n.width;if(1===i.chipi){n.y=0;let e=l.y-n.height;n.x=o,new TWEEN.Tween(n).to({y:e},300,createjs.Ease.easeOutQuad).start().onComplete((()=>{h.visible=!0,i.chipi=2})),i.chipi=999}if(2===i.chipi){n.huong=n.huong||t.huong,n.huong!==t.huong&&(n.stop=5,n.huong=t.huong,new TWEEN.Tween(n).to({x:o},300,createjs.Ease.easeOutQuad).start().onComplete((()=>{n.stop=1}))),5===n.stop?h.visible=!1:(h.visible=!0,n.x=l.x,"right"===t.huong?(n.x=l.x-Math.abs(t.width)-n.width+t.pivot.x,n.scale.x=1,n.width=70):"left"===t.huong&&(n.scale.x=-1,n.width=70,n.x=l.x+t.width+n.width));let e=l.y-n.height;e-a.height<0&&(e=0+a.height+n.height),n.y=e,h.position.y=n.y-(a.height+20)/2-1,"right"===t.huong?h.x=n.x-Math.abs(n.width)/2+a.width/2+Math.abs(n.width/2):h.x=n.x+Math.abs(n.width)/2-a.width/2-Math.abs(n.width/2)+ +Math.abs(n.width/2)}i.time>=200&&(this.logChipi[0]?(this.chipiBox.removeChild(i),this.chipiBox.have=1):(h.visible=!1,2==i.chipi&&(i.chipi=3,TweenMax.to(n,.5,{y:-1,onComplete:()=>{this.chipiBox.removeChild(i)}}))))}}}class ie extends te{constructor(){super()}updateMove=e=>{!0!==this.loadGame.visible&&this.cache_player.forEach((t=>{let i=t.pos.x,n=t.pos.y;if("zone"===t.type)return((e,t)=>{let i=e.getSprite(t.id);if(i){let n=e.getSprite(e.my.id);if(n){let h=i.getChildByName("background2");if(h&&function(e,t){const i=e.getBounds(),n=t.getBounds();return i.contains(n.x+e.pivot.x,n.y)||n.contains(i.x,i.y)}(n,h)&&!e.isGoToZone){e.isGoToZone=!0;let i=t.nextMap,n=i.id,h=i.x,a=i.y;e.goto(n,null,h,a),((e,t)=>{let i=e.my;if(i.id<=0)return!1;let n=e.getSprite(i.id);if(n){let e=2;"left"===t?n.x+=Math.abs(n.width)*e:"right"===t?n.x-=Math.abs(n.width)*e:"top"===t?n.y+=Math.abs(n.height):"bottom"===t&&(n.y-=Math.abs(n.height))}})(e,t.nextMap.move)}}}else{i=new PIXI.Container,i.name=t.id,i.x=t.position.x,i.y=t.position.y,e.player.addChild(i);let n=t.position.width,h=t.position.height,a=t.position.move,l=e.gameMap.setting;l.maxX,"left"===a||"right"===a?(n=50,(!h||h<=0)&&(h=300)):"top"!==a&&"bottom"!==a||(h=50,(!n||n<=0)&&(n=300)),l.maxY===h&&(i.y=0+e.may.height+e.bien.height+e.nui1.height);let o=new PIXI.Graphics;o.beginFill(0,.5),o.drawRect(0,0,n,h),o.endFill(),i.addChild(o),o.name="background",o.widthm=n,o.heightm=h;let d=new PIXI.Graphics;d.beginFill(16777215,.5),d.drawRect(0,0,n,h),d.endFill(),i.addChild(d),d.name="background2";let r=new PIXI.Sprite(e.coverImg("x2Main_Image_interface_selected_hand"));r.width=20,r.height=25,o.addChild(r),r.name="icon","top"!==a&&"bottom"!==a||(r.x=o.width/2-r.width/2,r.y="top"===a?o.height+r.height:0-r.height),"left"!==a&&"right"!==a||(r.y=o.height/2-r.height/2,r.x="left"===a?o.width+r.width:0-r.width),"top"===a&&(r.rotation=180*Math.PI/180),"left"===a&&(r.rotation=90*Math.PI/180),"right"===a&&(r.rotation=-90*Math.PI/180,r.y+=r.height/2);let s="Chưa xác định"+t.id,c=t.nextMap.id,g=e.listMap.findIndex((e=>e.id===c));-1!==g&&(s=e.listMap[g].name);let p=new PIXI.Text(s,{fontFamily:"Arial",fontSize:24,fill:16715792,align:"center"});p.name="name",o.addChild(p),"bottom"===a&&(p.x=r.x+r.width/2-p.width/2,p.y=r.y-p.height,new TWEEN.Tween(r).to({y:r.y+5},200).easing(TWEEN.Easing.Linear.None).repeat(1/0).yoyo(!0).start()),"top"===a&&(p.x=r.x+r.width/2-p.width/2,p.y=r.y,new TWEEN.Tween(r).to({y:r.y-5},200).easing(TWEEN.Easing.Linear.None).repeat(1/0).yoyo(!0).start()),"left"===a&&(p.x=r.x+r.width,p.y=r.y+r.height/2-p.height/2,new TWEEN.Tween(r).to({x:r.x-5},200).easing(TWEEN.Easing.Linear.None).repeat(1/0).yoyo(!0).start()),"right"===a&&(p.x=r.x-p.width,p.y=r.y-p.height,new TWEEN.Tween(r).to({x:r.x+5},200).easing(TWEEN.Easing.Linear.None).repeat(1/0).yoyo(!0).start()),t.nextMap.move=a}})(this,t);let h=this.getSprite(t.id);if(!h)return;"mob"==t.type&&(t.info&&t.info.chiso&&t.info.chiso.hp<=0?h.visible=!1:0==h.visible&&(h.visible=!0));let a=h.x,l=h.y,o=t.info.coban.speed*e;i==a&&n==l||"dungyen"!=t.action.action&&"move"!=t.action.action?"move"==t.action.action&&this.action(t.id,"dungyen"):(i>a?(t.action.move="right",h.x+=o,h.x>i&&(h.x=i)):i<a?(t.action.move="left",h.x-=o,h.x<i&&(h.x=i)):n>l?(h.y+=o,h.y>n&&(h.y=n)):n<l&&(h.y-=o,h.y<n&&(h.y=n)),this.action(t.id,"move"))}))}}class ne extends ie{constructor(){super()}boxBaseMask=(e,t)=>{let i=new PIXI.Container,n=new PIXI.Graphics;return n.beginFill(0,.5),n.drawRect(0,0,.99*e.width,t.height),n.endFill(),i.name="tabname",i.mask=n,i};mask=(e,t)=>{let i=new PIXI.Container,n=new PIXI.Graphics;return n.beginFill(0,1),n.drawRect(0,0,t.width,t.height),n.endFill(),n.y=t.y,i.mask=n,e.addChild(n),i};maskPointDefault=e=>{let t=new PIXI.Graphics;t.beginFill(16777215,1e-8),t.drawRect(0,0,e.width,e.height),t.endFill(),e.mask=t,e.addChild(t)};viewPointDefault=(e,t)=>{if(t.height<e.height){let i=e.height-t.height,n=new PIXI.Graphics;n.beginFill(0,8.00001e-10),n.drawRect(0,0,e.width,i),n.endFill(),n.x=0,n.y=t.height,t.addChild(n)}let i=new pixi_viewport.Viewport({screenWidth:e.width,screenHeight:e.height,worldWidth:e.width,worldHeight:t.height});i.name="viewport",i.drag({direction:"y",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),i.bounce({top:!0,bottom:!0,friction:.5,time:3.5,ease:"easeInOutSine"}),i.addChild(t),e.addChild(i)};getAllInteractiveChildren=e=>{let t=[];return null!=e&&(e.interactive&&t.push(e),e.children&&e.children.length>0&&e.children.forEach((e=>{if(e instanceof PIXI.Container){const i=this.getAllInteractiveChildren(e);t=t.concat(i)}})),t)};findInteractiveObjects=e=>{if("object"!=typeof e)return!1;let t=e,i=[],n=e=>{if(null==e)return!1;if("object"!=typeof e)return!!e.interactive&&(e=>{e.interactive&&i.push(e)})(e);for(let t=0;t<e.length;t++)e[t].interactive&&i.push(e[t]),e[t].children.length>0&&n(e[t].children)};return t.interactive&&i.push(t),n(t.children),i};intY=(e,t)=>{let i=new pixi_viewport.Viewport({screenWidth:e.width,screenHeight:e.height,worldWidth:t.width,worldHeight:t.height});i.name="viewport",i.drag({direction:"y",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),i.bounce({top:!0,bottom:!0,friction:.5,time:3.5,ease:"easeInOutSine"}),i.setZoom(1),i.addChild(t);let n=0,h=-1;i.on("pointerdown",(e=>{n=Date.now()})),i.on("pointerup",(e=>{if(Date.now()-n<200){let i=e.data.global.x,n=e.data.global.y,a=t.toLocal(new PIXI.Point(i,n));a.x=Math.round(a.x),a.y=Math.round(a.y);let l=t.children.filter((e=>"int04"==e.keycode));for(let e=0;e<l.length;e++)l[e].removeChild(l[e].getChildByName("xanhle"));for(let e=0;e<l.length;e++)if(l[e].x<=a.x&&a.x<=l[e].x+l[e].width&&l[e].y<=a.y&&a.y<=l[e].y+l[e].height){h=e;let t=l[e].width,i=l[e].height,n=new PIXI.Graphics;n.lineStyle(0,0,1),n.beginFill(16318026,.5),n.drawRoundedRect(0,0,t,i,0),n.endFill(),n.name="xanhle",l[e].addChild(n);let a=l[e],o=this.getAllInteractiveChildren(a);o.length>0&&(n.interactive=!0,n.cursor="pointer",n.on("pointerdown",(()=>{o[0].emit("pointerdown")})),n.on("pointerup",(()=>{o[0].emit("pointerup")})))}}else clearInterval(this.pcSettimeEntactive),setTimeout((function(){clearInterval(this.pcSettimeEntactive),a()}),200)}));let a=()=>{this.pcSettimeEntactive&&clearInterval(this.pcSettimeEntactive),this.pcSettimeEntactive=setInterval((()=>{let e=this.pcKey;if(this.menu.children.length<=0)return console.log("xóa menu"),clearInterval(this.pcSettimeEntactive),!1;let n=t.children.filter((e=>"int04"==e.keycode));if("ArrowUp"===e?(h-=1,h<0&&(h=n.length-1)):"ArrowDown"===e&&(h+=1,h>=n.length&&(h=0)),"Enter"===e){let e=n[h],t=this.getAllInteractiveChildren(e);t.length>0&&(t[0].emit("pointerdown"),t[0].emit("pointerup"))}if(n[h]&&this.pcKey.length>=1){for(let e=0;e<n.length;e++)n[e].removeChild(n[e].getChildByName("xanhle"));i.moveCenterY(n[h].y);let e=n[h].width,t=n[h].height,a=new PIXI.Graphics;a.lineStyle(0,0,1),a.beginFill(16318026,.5),a.drawRoundedRect(0,0,e,t,0),a.endFill(),a.name="xanhle",n[h].addChild(a);let l=n[h],o=this.findInteractiveObjects(l);o.length>0&&(a.interactive=!0,a.cursor="pointer",a.on("pointerdown",(()=>{o[0].emit("pointerdown")})),a.on("pointerup",(()=>{o[0].emit("pointerup")})))}this.pcKey=""}),50)};return a(),i};intX=(e,t)=>{let i=new pixi_viewport.Viewport({screenWidth:e.width,screenHeight:e.height,worldWidth:t.width,worldHeight:t.height});i.name="viewport",i.drag({direction:"x",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),i.bounce({top:!0,bottom:!0,friction:.5,time:3.5,ease:"easeInOutSine"}),i.setZoom(1),i.addChild(t);let n=0,h=-1;i.on("pointerdown",(e=>{n=Date.now()})),i.on("pointerup",(e=>{if(Date.now()-n<200){let i=e.data.global.x,n=e.data.global.y,a=t.toLocal(new PIXI.Point(i,n));a.x=Math.round(a.x),a.y=Math.round(a.y);let l=t.children.filter((e=>"int04"==e.keycode));for(let e=0;e<l.length;e++)l[e].removeChild(l[e].getChildByName("xanhle"));for(let e=0;e<l.length;e++)if(l[e].x<=a.x&&a.x<=l[e].x+l[e].width&&l[e].y<=a.y&&a.y<=l[e].y+l[e].height){h=e;let t=l[e].width,i=l[e].height,n=new PIXI.Graphics;n.lineStyle(0,0,1),n.beginFill(16318026,.5),n.drawRoundedRect(0,0,t,i,0),n.endFill(),n.name="xanhle",l[e].addChild(n);let a=l[e],o=this.getAllInteractiveChildren(a);o.length>0&&(n.interactive=!0,n.cursor="pointer",n.on("pointerdown",(()=>{o[0].emit("pointerdown")})),n.on("pointerup",(()=>{o[0].emit("pointerup")})))}}else clearInterval(this.pcSettimeEntactive),setTimeout((function(){clearInterval(this.pcSettimeEntactive),a()}),200)}));let a=()=>{this.pcSettimeEntactive&&clearInterval(this.pcSettimeEntactive),this.pcSettimeEntactive=setInterval((()=>{let e=this.pcKey;if(this.boxGiaoTiep.children.length<=0)return clearInterval(this.pcSettimeEntactive),!1;let n=t.children.filter((e=>"int04"==e.keycode));if("ArrowLeft"===e?(h-=1,h<0&&(h=n.length-1)):"ArrowRight"===e&&(h+=1,h>=n.length&&(h=0)),"Enter"===e){let e=n[h],t=this.getAllInteractiveChildren(e);t.length>0&&(t[0].emit("pointerdown"),t[0].emit("pointerup"))}if(n[h]&&this.pcKey.length>=1){for(let e=0;e<n.length;e++)n[e].removeChild(n[e].getChildByName("xanhle"));i.moveCenterX(n[h].x,n[h].y);let e=n[h].width,t=n[h].height,a=new PIXI.Graphics;a.lineStyle(0,0,1),a.beginFill(16318026,.5),a.drawRoundedRect(0,0,e,t,0),a.endFill(),a.name="xanhle",n[h].addChild(a);let l=n[h],o=this.findInteractiveObjects(l);o.length>0&&(a.interactive=!0,a.cursor="pointer",a.on("pointerdown",(()=>{o[0].emit("pointerdown")})),a.on("pointerup",(()=>{o[0].emit("pointerup")})))}this.pcKey=""}),50)};return a(),i};viewPointDefaultY=(e,t)=>{let i=t;if(t.height<e.height){let i=e.height-t.height,n=new PIXI.Graphics;n.beginFill(0,8.00001e-10),n.drawRect(0,0,e.width,i),n.endFill(),n.x=0,n.y=t.height,t.addChild(n)}let n=new pixi_viewport.Viewport({screenWidth:e.width,screenHeight:e.height,worldWidth:e.width,worldHeight:t.height});n.name="viewport",n.drag({direction:"y",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),n.bounce({top:!0,bottom:!0,friction:.5,time:3.5,ease:"easeInOutSine"}),n.addChild(t),e.addChild(n);let h=0,a=-1;n.on("pointerdown",(e=>{h=Date.now()})),n.on("pointerup",(e=>{if(Date.now()-h<200){let t=e.data.global.x,n=e.data.global.y,h=i.toLocal(new PIXI.Point(t,n));h.x=Math.round(h.x),h.y=Math.round(h.y);let l=i.children.filter((e=>"int04"==e.keycode));for(let e=0;e<l.length;e++)l[e].removeChild(l[e].getChildByName("xanhle"));for(let e=0;e<l.length;e++)if(l[e].x<=h.x&&h.x<=l[e].x+l[e].width&&l[e].y<=h.y&&h.y<=l[e].y+l[e].height){a=e;let t=l[e].width,i=l[e].height,n=new PIXI.Graphics;n.lineStyle(2,16777215,1),n.beginFill(16318026,1e-16),n.drawRoundedRect(0,0,t,i,0),n.endFill(),n.name="xanhle",l[e].addChild(n);let h=l[e],o=this.getAllInteractiveChildren(h);o.length>0&&(n.interactive=!0,n.cursor="pointer",n.on("pointerdown",(()=>{o[0].emit("pointerdown")})),n.on("pointerup",(()=>{o[0].emit("pointerup")})))}}else clearInterval(this.pcSettimeEntactiveY),setTimeout((function(){clearInterval(this.pcSettimeEntactiveY),l()}),200)}));let l=()=>{console.log("open lại"),this.pcSettimeEntactiveY&&clearInterval(this.pcSettimeEntactiveY),this.pcSettimeEntactiveY=setInterval((()=>{let e=this.pcKey;if(this.box.children.length<=0||this.menu.children.length>=1)return console.log("xóa skill"),clearInterval(this.pcSettimeEntactiveY),!1;let t=i.children.filter((e=>"int04"==e.keycode));if("ArrowUp"===e?(a-=1,a<0&&(a=t.length-1)):"ArrowDown"===e&&(a+=1,a>=t.length&&(a=0)),"Enter"===e){let e=t[a],i=this.getAllInteractiveChildren(e);i.length>0&&(i[0].emit("pointerdown"),i[0].emit("pointerup"))}if(t[a]&&this.pcKey.length>=1){for(let e=0;e<t.length;e++)t[e].removeChild(t[e].getChildByName("xanhle"));n.moveCenter(t[a].x,t[a].y);let e=t[a].width,i=t[a].height,h=new PIXI.Graphics;h.lineStyle(2,16777215,1),h.beginFill(16318026,5e-12),h.drawRoundedRect(0,0,e,i,0),h.endFill(),h.name="xanhle",t[a].addChild(h);let l=t[a],o=this.findInteractiveObjects(l);o.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{o[0].emit("pointerdown")})),h.on("pointerup",(()=>{o[0].emit("pointerup")})))}this.pcKey=""}),50)};l()}}class he extends ne{constructor(){super()}openShowMenu=(e,t)=>{this.closeGiaoTiep(),this.deleteMenu();let i=new PIXI.Graphics;i.beginFill(0,1e-7),i.drawRect(0,0,this.gameWidth,this.gameHeight),i.endFill(),this.menu.addChild(i),i.interactive=!0;let n=.7*this.gameWidth,h=.6*this.gameHeight;n=n>300?300:n,h=h>400?400:h;let a=new PIXI.Graphics;a.name="menu",a.beginFill(16246719,1),a.drawRect(0,0,n,h),a.endFill(),a.x=(this.gameWidth-n)/2,a.y=(this.gameHeight-h)/2,this.menu.addChild(a),a.alpha=0,TweenMax.to(a,1,{alpha:1});let l=Math.ceil(h/20);for(let e=0;e<l;e++){let t=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_paper_6.png"));t.x=a.x,t.y=a.y+20*e,t.y+60>a.y+h&&(t.y=a.y+h-60),this.menu.addChild(t)}let o=Math.ceil(h/20);for(let e=0;e<o;e++){let t=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_paper_6.png"));t.x=a.x+n,t.y=a.y+20*e,t.scale.x=-1,t.y+60>a.y+h&&(t.y=a.y+h-60),this.menu.addChild(t)}let d=Math.ceil(n/20);for(let e=0;e<d;e++){let t=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_paper_1.png"));t.anchor.set(.5),t.x=a.x+20*e+10,t.y=a.y,this.menu.addChild(t)}let r=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_paper_2.png"));r.anchor.set(.5),r.x=a.x,r.y=a.y,this.menu.addChild(r);let s=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_paper_2.png"));s.anchor.set(.5),s.x=a.x+n,s.y=a.y,s.scale.x=-1,this.menu.addChild(s);let c=Math.ceil(n/20);for(let e=0;e<c;e++){let t=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_paper_1.png"));t.anchor.set(.5),t.x=a.x+20*e+10,t.y=a.y+h,t.scale.y=-1,this.menu.addChild(t)}let g=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_paper_2.png"));g.anchor.set(.5),g.x=a.x,g.y=a.y+h,g.scale.y=-1,this.menu.addChild(g);let p=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_paper_2.png"));p.anchor.set(.5),p.x=a.x+n,p.y=a.y+h,p.scale.x=-1,p.scale.y=-1,this.menu.addChild(p);let m=new PIXI.Container;m.name="main";let w=.8*n,u=.8*h;m.x=a.x+.1*n,m.y=a.y+.1*u,this.menu.addChild(m);let y=new PIXI.Container;y.name="containerBody",m.addChild(y);let f=new PIXI.Graphics;f.beginFill(15906382,1),f.name="borderName",f.drawRect(0,0,.8*w,30),f.endFill(),y.addChild(f),f.x=0;let x=new PIXI.Text(e,{fontFamily:"Arial",fontSize:20,fill:16646144,align:"center"});x.anchor.set(.5),x.x=f.width/2,x.y=15,f.addChild(x);let I=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_point_closetab.png")),_=[];for(let e=0;e<2;e++){let t=new PIXI.Texture(I.texture,new PIXI.Rectangle(0,36*e,36,36));_.push(t)}let b=new PIXI.AnimatedSprite(_);b.anchor.set(.5),b.name="buttonclose",b.x=0,b.y=f.height/2,b.animationSpeed=.1,b.loop=!1,b.interactive=!0,b.cursor="pointer";let v=0;b.on("pointerdown",(()=>{v=Date.now()})),b.on("pointerup",(()=>{Date.now()-v<200&&(b.play(),this.deleteMenu())})),y.addChild(b),y.y=u,b.visible=!1,new TWEEN.Tween(y).to({y:0},300).easing(TWEEN.Easing.Back.InOut).start().onComplete((()=>{f.x=0,new TWEEN.Tween(f).to({x:(w-f.width)/2},300).easing(TWEEN.Easing.Back.InOut).start().onComplete((()=>{b.visible=!0,new TWEEN.Tween(b).to({x:f.x+f.width},200).easing(TWEEN.Easing.Back.InOut).start()}))})),u-=.1*w;let C=.2*u;C=C>50?50:C;let P=new PIXI.Container;P.name="body",P.y=f.height,m.addChild(P),P.alpha=0,new TWEEN.Tween(P).to({alpha:1},500).easing(TWEEN.Easing.Back.InOut).start();let S=new PIXI.Graphics;S.beginFill(0,1e-4),S.drawRect(0,0,w,u),S.endFill(),P.addChild(S);let X=this.mask(P,S);X.name="hienthinoidung",t.forEach(((e,t)=>{let i=new PIXI.Graphics;i.keycode="int04",i.beginFill(15906382,1e-7),i.drawRect(0,0,w,C),i.endFill(),i.y=t*(C+5);let n=new PIXI.Text(e[0],{fontFamily:"Arial",fontSize:20,fill:16646144,align:"center"});n.anchor.set(.5),n.x=i.width/2,n.y=i.height/2,i.addChild(n),X.addChild(i);let h=new PIXI.Graphics;h.beginFill(14137736,1),h.drawRoundedRect(0,0,.8*w,5,10),h.endFill(),h.y=i.y+i.height,h.x=(w-h.width)/2,X.addChild(h),i.interactive=!0,i.cursor="pointer";let a=0;i.on("pointerdown",(()=>{a=Date.now()})),i.on("pointerup",(()=>{if(Date.now()-a<200){if("menu"===e[1])return this.openShowMenu(e[0],e[2]);this[e[1]](e[2]&&null!=e[2]?e[2]:null)}}))})),P.addChild(this.intY(S,X))};deleteMenu=()=>(this.menu,this.deleteAllChild(this.menu,!1),!1)}class ae extends he{constructor(){super()}closeBox=()=>{let e=this.box;e.alpha=1,new TWEEN.Tween(e).to({alpha:0},500).start().onComplete((()=>{e.alpha=1})),this.deleteAllChild(this.box,!1)};backgroundTien=()=>{let e=new PIXI.Container,t=.3*this.gameWidth,i=.2*this.gameHeight;t=t>100?100:t,i=i>100?100:i;let n=new PIXI.Graphics;n.beginFill(10653304,1),n.lineStyle(2,16380627,1),n.drawRect(0,0,t,i),n.endFill(),e.addChild(n);let h=0,a=new PIXI.Container;return[[2e3,1,"beri"],[2047,4,"ruby"]].forEach(((e,l)=>{let o=new PIXI.Graphics;o.beginFill(8086346,1.5),o.drawRect(0,0,t,1),o.endFill(),o.y=h+5*l,a.addChild(o),h+=o.height;let d=.2*t,r=.2*i,s=e[1],c=e[0],g=new PIXI.Sprite(this.coverImg(c)),p=[];for(let e=0;e<s;e++){let t=new PIXI.Rectangle(0,80*e,80,80);p.push(new PIXI.Texture(g.texture,t))}let m=new PIXI.AnimatedSprite(p);m.animationSpeed=.1,m.width=d,m.height=r,m.x=0,m.y=o.y+o.height+5,m.play(),a.addChild(m);let w=this.my.tien[e[2]],u=new PIXI.Text(this.number_format(w),{fontFamily:"Arial",fontSize:10,fill:16777215,align:"center"});n.width,m.width,u.x=m.x+m.width+5,u.y=m.y+m.height/2-u.height/2,u.name="text_"+e[2],a.addChild(u),h+=m.height})),n.addChild(a),a.x=n.width/2-a.width/2,a.y=0,i>a.height&&(n.clear(),n.beginFill(10653304,1),n.lineStyle(2,16380627,1),n.drawRect(0,0,t,a.height),n.endFill()),e.x=this.gameWidth-t-.01*this.gameWidth,e.y=.01*this.gameHeight,e};backGroundBox=(e=500)=>{this.closeBox(),this.closeGiaoTiep(),this.deleteMenu();let t=this.box,i=new PIXI.Graphics;i.beginFill(0,1e-4),i.drawRect(0,0,this.gameWidth,this.gameHeight),i.endFill(),i.interactive=!0,t.addChild(i),t.addChild(this.backgroundTien());let n=.9*this.gameWidth;n=n>500?500:n;let h=.8*this.gameHeight;h=h>400?400:h,t.w=n,t.h=h;let a=new PIXI.Graphics;a.beginFill(16311469,1),a.lineStyle(2,6967601,1),a.drawRoundedRect(0,0,n,h,0),a.endFill(),a.x=(this.gameWidth-n)/2,a.y=(this.gameHeight-h)/2,t.addChild(a);let l=40,o=Math.ceil(h/l);for(let e=0;e<o;e++){let i=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_tab0.png"));i.x=(this.gameWidth-n)/2+3,i.y=(this.gameHeight-h)/2+e*l,i.height=l,i.y+l>(this.gameHeight-h)/2+h&&(i.height=(this.gameHeight-h)/2+h-i.y),i.scale.x=-.5,t.addChild(i);let a=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_tab0.png"));a.x=(this.gameWidth-n)/2+n-3,a.y=(this.gameHeight-h)/2+e*l,a.width=20,a.height=l,a.y+l>(this.gameHeight-h)/2+h&&(a.height=(this.gameHeight-h)/2+h-a.y),t.addChild(a)}let d=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_tab1.png"));d.x=(this.gameWidth-n)/2+n,d.y=(this.gameHeight-h)/2,d.rotation=-.45,d.width=18,d.height=6,t.addChild(d);let r=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_tab1.png"));r.x=(this.gameWidth-n)/2,r.y=(this.gameHeight-h)/2-0,r.scale.x=-1,r.rotation=.4,r.width=18,r.height=6,t.addChild(r);let s=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_tab1.png"));s.x=(this.gameWidth-n)/2+n,s.y=(this.gameHeight-h)/2+h,s.rotation=.1,s.width=18,s.height=6,t.addChild(s);let c=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_tab1.png"));return c.x=(this.gameWidth-n)/2,c.y=(this.gameHeight-h)/2+h,c.scale.x=-1,c.rotation=-.1,c.width=18,c.height=6,t.addChild(c),t.alpha=0,new TWEEN.Tween(t).to({alpha:1},e).start(),t};created_ui_1=(e,t)=>{let i=this.box,n=i.w,h=i.h,a=.9*h,l=.2*n;l=l>50?50:l;let o=new PIXI.Graphics;o.beginFill(0,1e-10),o.drawRect(0,0,l,a),o.endFill(),o.interactive=!0,o.x=(this.gameWidth-n)/2,o.y=(this.gameHeight-h)/2+.1*h,i.addChild(o),o.alpha=0,new TWEEN.Tween(o).to({alpha:1},500).start();let d="";e.forEach(((e,i)=>{let n=e[0],h=e[1],a=e[2],l=e[3],r=.2*o.height;r=r>48?48:r;let s=new PIXI.Sprite(this.coverImg(n));if(s.x=0,s.y=0+i*(r+5),s.width=r,s.height=r,s.interactive=!0,s.cursor="help",o.addChild(s),h==t){d=a;let e=new PIXI.Graphics;e.beginFill(16755200,.8),e.drawCircle(0,0,r/2),e.endFill(),e.x=s.x+r/2,e.y=s.y+r/2,o.addChild(e)}let c=0;s.on("pointerdown",(()=>{c=Date.now()})),s.on("pointerup",(()=>{Date.now()-c<200&&(l&&void 0!==l?this[h](l):this[h]())}))}));let r=n-l,s=new PIXI.Graphics;s.beginFill(16311469,1),s.drawRect(0,0,r,a),s.endFill(),s.interactive=!0,s.x=(this.gameWidth-n)/2+l,s.y=(this.gameHeight-h)/2+.1*h,i.addChild(s),s.name="body";let c=new PIXI.Graphics;c.beginFill(15906382,1),c.drawRect(0,0,r,.1*h),c.endFill(),c.interactive=!0,i.addChild(c),c.x=(this.gameWidth-n)/2+n-r,c.y=0,new TWEEN.Tween(c).to({y:(this.gameHeight-h)/2},500).easing(TWEEN.Easing.Back.Out).start();let g=new PIXI.Text(d,{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center"});g.x=c.width/2-g.width/2,g.y=c.height/2-g.height/2,c.addChild(g);let p=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_point_closetab.png")),m=[];for(let e=0;e<2;e++){let t=new PIXI.Texture(p.texture,new PIXI.Rectangle(0,36*e,36,36));m.push(t)}let w=new PIXI.AnimatedSprite(m);w.anchor.set(.5),w.name="buttonclose",w.x=0,w.y=c.height/2,w.animationSpeed=.1,w.loop=!1,w.interactive=!0,w.cursor="pointer";let u=0;w.on("pointerdown",(()=>{u=Date.now()})),w.on("pointerup",(()=>{Date.now()-u<200&&(w.play(),this.closeBox())})),c.addChild(w),new TWEEN.Tween(w).to({x:c.width-w.width/2},1e3).easing(TWEEN.Easing.Back.Out).start()}}class le extends ae{constructor(){super()}use_item=e=>{let t=this.my;if(t.id<=0)return!1;let i=t.ruong.data.find((t=>t.id==e&&"hanhtrang"==t.active));if(!i)return this.notice(this._("Có lỗi xẩy ra"));this.send(-5,[1,i.id])};btn_hanhtrang=e=>{let t=new PIXI.Container,i=this.preItem,n=.3*i.width,h=.3*i.height;return n=n>70?70:n,h=h>50?50:h,[["sử dụng","use_item"],["Gán phím","use_item_button"],["Đóng",""]].forEach(((i,a)=>{let l=new PIXI.Graphics;l.interactive=!0,l.beginFill(8810843,1),l.lineStyle(2,16380627,1),l.drawRoundedRect(0,0,n,h,5),l.endFill(),l.name=i[1],l.x=a*(n+5),l.y=0,t.addChild(l);let o=new PIXI.Text(i[0],{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:l.width});l.addChild(o),o.x=(l.width-o.width)/2,o.y=(l.height-o.height)/2;let d=0;l.on("pointerdown",(()=>{d=Date.now()})),l.on("pointerup",(()=>{Date.now()-d<300&&(i[1].length>=1&&this[l.name](e),this.preItem.removeChildren())}))})),t.y=i.height,t}}class oe extends le{constructor(){super()}ganphimitem=e=>{let t=e[0],i=e[1],n=this.my.ruong.data.find((e=>e.id==t&&"hanhtrang"==e.active));if(!n)return!1;this.deleteMenu(),this.notice("Xin chờ",!1),this.my.oskill[i]=t,this.send(-6,[1,i,t])};sendToServerSkill=e=>{let t=e[0],i=e[1],n=this.skill.find((e=>e.id==t));if(!n)return!1;this.deleteMenu(),this.notice("Xin chờ",!1),this.my.oskill[i]=t,this.send(-6,[1,i,t])};use_item_button=e=>{let t=this.my.ruong.data.find((t=>t.id==e&&"hanhtrang"==t.active));if(t&&t.soluong>=1){let e=[];for(let i=0;i<10;i++)e.push(["Gán phím "+(i+1),"ganphimitem",[t.id,i]]);this.openShowMenu("Gán vào phím tắt",e)}};gan_skill=e=>{let t=this.skill.find((t=>t.id==e));if(t){let e=[];for(let i=0;i<10;i++)e.push(["Gán phím "+(i+1),"sendToServerSkill",[t.id,i]]);this.openShowMenu("Gán "+t.name,e)}};btn_skill_gan=e=>{let t=new PIXI.Container,i=this.preItem,n=.3*i.width,h=.3*i.height;return n=n>70?70:n,h=h>50?50:h,[["Gán phím","gan_skill"],["Đóng",""]].forEach(((i,a)=>{let l=new PIXI.Graphics;l.interactive=!0,l.beginFill(8810843,1),l.lineStyle(2,16380627,1),l.drawRoundedRect(0,0,n,h,5),l.endFill(),l.name=i[1],l.x=a*(n+5),l.y=0,t.addChild(l);let o=new PIXI.Text(i[0],{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:l.width});l.addChild(o),o.x=(l.width-o.width)/2,o.y=(l.height-o.height)/2;let d=0;l.on("pointerdown",(()=>{d=Date.now()})),l.on("pointerup",(()=>{Date.now()-d<300&&(i[1].length>=1&&this[l.name](e),this.preItem.removeChildren())}))})),t.y=i.height,t};showInfoSkill=(e,t,i=!1)=>{if(!e)return console.log("Không có ô");if(!t)return console.log("ko có data");let n=this.skill.find((e=>e.id==t[0])),h=this.createBackgroundPreViewItem(e),a=h.getChildByName("title"),l=new PIXI.Container,o=new PIXI.Text(n.name,{fontFamily:"Arial",fontSize:15,fill:16744228,align:"center",fontWeight:"bold"});o.x=0,o.y=0,l.addChild(o);let d=new PIXI.Text(this._("Kĩ năng "+{hotro:"Hỗ trợ",tancong:"Tấn công",bidong:"Bị động"}[n.type]),{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center",fontWeight:"bold"});d.x=o.x+o.width/2-d.width/2,d.y=o.height+5,l.addChild(d),a.addChild(l),l.x=(a.width-l.width)/2,l.y=(a.height-l.height)/2;let r=h.getChildByName("body"),s=new PIXI.Container,c=0,g=new PIXI.Graphics;g.beginFill(16777215),g.drawRect(0,0,.5*r.width,1),g.endFill(),s.addChild(g),g.x=r.width/2-g.width/2,c+=5;let p=new PIXI.Text(n.mota,{fontFamily:"Arial",fontSize:15,fill:16777215,align:"left",fontWeight:"bold",wordWrap:!0,wordWrapWidth:r.width-10});if(p.x=10,p.y=c,s.addChild(p),c+=p.height+2,"tancong"==n.type){let e=new PIXI.Text(this._("Gây: ")+Math.round(n.value+n.value/100*t[1])+"% sát thương "+(1==n.st?this._("Vật lý"):this._("Phép")),{fontFamily:"Arial",fontSize:15,fill:16777215,align:"left",fontWeight:"bold",wordWrap:!0,wordWrapWidth:r.width-10});e.x=10,e.y=c,s.addChild(e),c+=e.height+2;let i=new PIXI.Text(this._("Năng lượng: ")+Math.round(n.mp+n.mp/100*t[1]),{fontFamily:"Arial",fontSize:15,fill:16777215,align:"left",fontWeight:"bold",wordWrap:!0,wordWrapWidth:r.width-10});i.x=10,i.y=c,s.addChild(i),c+=i.height+2;let h=new PIXI.Text(this._("Thời gian chờ: ")+n.time+"mili giây",{fontFamily:"Arial",fontSize:15,fill:16777215,align:"left",fontWeight:"bold",wordWrap:!0,wordWrapWidth:r.width-10});h.x=10,h.y=c,s.addChild(h),c+=h.height+2,n.buff&&"object"==typeof n.buff&&n.buff.forEach((e=>{let i,n=e[0],h=e[1],a=e[2],l=e[3],o=e[4],d=h+h/100*t[1],g=this.getThuocTinh(n),p=[0,"bản thân","đối thủ","đồng đội"];i=1*l>=100?(d>0?this._("Tăng"):this._("Giảm"))+" "+d+g.value+" "+g.name+" trong "+a+" giây cho "+p[o]+" ":l+"% "+(d>0?this._("Tăng"):this._("Giảm"))+" "+d+g.value+" "+g.name+" trong "+a+" giây cho "+p[o]+" ";let m=new PIXI.Text(i,{fontFamily:"Arial",fontSize:15,fill:13395507,align:"left",fontWeight:"bold",wordWrap:!0,wordWrapWidth:r.width-10});m.x=10,m.y=c,s.addChild(m),c+=m.height+2}))}if("hotro"==n.type){n.buff&&"object"==typeof n.buff&&n.buff.forEach((e=>{let i,n=e[0],h=e[1],a=e[2],l=e[3],o=e[4],d=h+h/100*t[1],g=this.getThuocTinh(n),p=[0,"bản thân","đối thủ","đồng đội"];i=1*l>=100?(d>0?this._("Tăng"):this._("Giảm"))+" "+d+g.value+" "+g.name+" trong "+a+" giây cho "+p[o]+" ":l+"% "+(d>0?this._("Tăng"):this._("Giảm"))+" "+d+g.value+" "+g.name+" trong "+a+" giây cho "+p[o]+" ";let m=new PIXI.Text(i,{fontFamily:"Arial",fontSize:15,fill:13395507,align:"left",fontWeight:"bold",wordWrap:!0,wordWrapWidth:r.width-10});m.x=10,m.y=c,s.addChild(m),c+=m.height+2}));let e=new PIXI.Text(this._("Năng lượng: ")+Math.round(n.mp+n.mp/100*t[1]),{fontFamily:"Arial",fontSize:15,fill:16777215,align:"left",fontWeight:"bold",wordWrap:!0,wordWrapWidth:r.width-10});e.x=10,e.y=c,s.addChild(e),c+=e.height+2;let i=new PIXI.Text(this._("Thời gian chờ: ")+n.time+"mili giây",{fontFamily:"Arial",fontSize:15,fill:16777215,align:"left",fontWeight:"bold",wordWrap:!0,wordWrapWidth:r.width-10});i.x=10,i.y=c,s.addChild(i),c+=i.height+2}if("bidong"==n.type&&n.buff&&"object"==typeof n.buff)for(let e in n.buff){let i=n.buff[e]+n.buff[e]/100*t[1];i=Math.round(i);let h=this.getThuocTinh(e),a=(i>0?this._("Tăng"):this._("Giảm"))+" "+i+h.value+" "+h.name+" ",l=new PIXI.Text(a,{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center",fontWeight:"bold"});l.x=10,l.y=c,s.addChild(l),c+=l.height+2}if(this.viewpointItem(r,s),i&&"bidong"!=n.type){let e=this[i](n.id);h.addChild(e)}let m=e.toGlobal(new PIXI.Point(0,0));if(h.y=m.y,h.x=m.x,h.y+h.height>this.gameHeight){let e=h.y+h.height-this.gameHeight;h.y-=e}if(h.x+h.width>this.gameWidth){let e=h.x+h.width-this.gameWidth;h.x-=e}}}class de extends oe{constructor(){super()}createBackgroundPreViewItem=e=>{this.deleteAllChild(this.preItem,!1);let t=.8*this.gameWidth;t=t>300?300:t;let i=.6*this.gameHeight;i=i>300?300:i;let n=new PIXI.Graphics;n.interactive=!0,n.beginFill(5982773,1),n.lineStyle(2,16380627,1),n.drawRect(0,0,t,i),n.endFill(),this.preItem.addChild(n);let h=.6*i;h=h>50?50:h;let a=new PIXI.Graphics;a.interactive=!0,a.beginFill(16777215,1e-16),a.drawRect(0,0,t,h),a.endFill(),a.name="title",n.addChild(a);let l=new PIXI.Graphics;l.interactive=!0,l.beginFill(16777215,1e-9),l.drawRect(0,0,t,i-h-5),l.endFill(),l.name="body",l.y=h+5,n.addChild(l);let o=new PIXI.Graphics;return o.beginFill(16777215,1e-8),o.drawRect(0,0,l.width,l.height),o.endFill(),l.mask=o,l.addChild(o),this.preItem.alpha=0,TweenMax.to(this.preItem,.5,{alpha:1}),n};previewItemBag=(e,t,i=!1,n="")=>{if(!e)return console.log("Không có ô");if(!t)return console.log("ko có data");let h=this.item.find((e=>e.id==t.item));t.may=t.may||0,t.mayman=t.mayman||0,t.level=t.level||0,t.phamchat=t.phamchat||0,t.doben=t.doben||0;let a=this.createBackgroundPreViewItem(e),l=a.getChildByName("title"),o=1;o=t.phamchat||0,"item"===h.type&&(o=h.phamchat);let d=[0,0,2142890,9135499,16744228][o],r=new PIXI.Container,s=new PIXI.Text(h.name,{fontFamily:"Arial",fontSize:15,fill:d,align:"center",fontWeight:"bold"});s.x=0,s.y=0,r.addChild(s);let c=t.lo||[],g=0,p=!1;if("buy"!==n&&"sell"!==n||(p=this.cache.costShop.find((e=>e[0]==t.id))),"buy"===n&&p){let e=new PIXI.Text(this._("Giá: ")+this.number_format(p[1])+" "+(1===p[3]?"Bery":"Ruby"),{fontFamily:"Arial",fontSize:15,fill:d,align:"center",fontWeight:"bold"});e.x=s.x+s.width/2-e.width/2,e.y=s.height+5,r.addChild(e)}else if("sell"===n&&p){let e=new PIXI.Text(this._("Bán được: ")+this.number_format(p[2])+" "+(1===p[3]?"Bery":"Ruby"),{fontFamily:"Arial",fontSize:15,fill:d,align:"center",fontWeight:"bold"});e.x=s.x+s.width/2-e.width/2,e.y=s.height+5,r.addChild(e)}else if("object"==typeof c&&c&&"trangbi"===h.type){let e=new PIXI.Container;r.addChild(e),c.forEach((t=>{if(-1!==t){let i=30,n=30,h=5,a=new PIXI.Graphics;if(a.beginFill(0,8.00001e-10),a.lineStyle(2,13872197,1),a.drawRect(0,0,i,n),a.endFill(),a.x=g*(i+h),a.y=s.height+5,e.addChild(a),g++,0!=t){let e=this.item.find((e=>e.id==t));if(e){let t,i=a.width,n=a.height,h=e.img,l=h.src,o=h.num;if(o>1){let e=[],i=80,n=80,h=new PIXI.Sprite(this.coverImg(l));for(let t=0;t<o;t++){let a=new PIXI.Texture(h.texture,new PIXI.Rectangle(0,t*n,i,n));e.push(a)}t=new PIXI.AnimatedSprite(e),t.animationSpeed=.15,t.play()}else t=new PIXI.Sprite(this.coverImg(l));t.width=.8*i,t.height=.8*n,t.x=(i-t.width)/2,t.y=(n-t.height)/2,a.addChild(t)}}}})),e.x=(r.width-e.width)/2}else if("item"===h.type){let e=new PIXI.Text(this._("Số lượng: ")+t.soluong,{fontFamily:"Arial",fontSize:15,fill:d,align:"center",fontWeight:"bold"});e.x=s.x+s.width/2-e.width/2,e.y=s.height+5,r.addChild(e)}l.addChild(r),r.x=(l.width-r.width)/2,r.y=(l.height-r.height)/2;let m=a.getChildByName("body"),w=new PIXI.Container;if("item"===h.type){let e=new PIXI.Graphics;e.beginFill(16777215,1),e.drawRect(0,0,.5*m.width,1),e.endFill(),e.x=m.width/2-e.width/2,e.y=0,w.addChild(e);let t=new PIXI.Text(h.mota,{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:m.width-10});t.x=5,t.y=e.y+e.height,w.addChild(t)}else{let e=0,i=new PIXI.Graphics;i.beginFill(16777215,1),i.drawRect(0,0,.5*m.width,1),i.endFill(),i.x=m.width/2-i.width/2,i.y=0,w.addChild(i),e+=i.height;let n=new PIXI.Text(this._("Thông tin"),{fontFamily:"Arial",fontSize:15,fill:16777215,align:"left",fontWeight:"bold"});n.x=m.width/2-n.width/2,n.y=e,w.addChild(n),e+=n.height;let a=new PIXI.Text(this._("Level: ")+h.level,{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center",fontWeight:"bold"});a.x=5,a.y=e,w.addChild(a),e+=a.height;let l=new PIXI.Text(this._("Độ bền: ")+(t.doben||100),{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center",fontWeight:"bold"});l.x=5,l.y=e,w.addChild(l),e+=l.height,e+=5;let o=new PIXI.Graphics;o.beginFill(16777215,1),o.drawRect(0,0,.5*m.width,1),o.endFill(),o.x=m.width/2-o.width/2,o.y=e,w.addChild(o),e+=o.height;let d=new PIXI.Text(this._("Cường hóa +")+t.level,{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center",fontWeight:"bold"});if(d.x=m.width/2-d.width/2,d.y=e,w.addChild(d),e+=d.height,h.thuoctinh)for(let i in h.thuoctinh){let n=t.mayman,a=t.level,l=t.phamchat,o=h.thuoctinh[i],d=o+o*(n/100);d+=d*(a*l/100),d=Math.round(d);let r=this.getThuocTinh(i),s=(d>0?this._("Tăng"):this._("Giảm"))+" "+d+r.value+" "+r.name+" ",c=new PIXI.Text(s,{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center",fontWeight:"bold"});c.x=5,c.y=e,w.addChild(c),e+=c.height}if(t.dong){e+=5;let i=new PIXI.Graphics;i.beginFill(16777215,1),i.drawRect(0,0,.5*m.width,1),i.endFill(),i.x=m.width/2-i.width/2,i.y=e,w.addChild(i),e+=i.height;let n=new PIXI.Text(this._("Chỉ số đặc biệt"),{fontFamily:"Arial",fontSize:15,fill:16744272,align:"center",fontWeight:"bold"});n.x=m.width/2-n.width/2,n.y=e,w.addChild(n),e+=n.height,t.dong.forEach((i=>{let n=t.mayman,a=t.level,l=t.phamchat,o=h.level;o=o<0?1:o;let d=Math.ceil(o/10)*l,r=d+d*(n/100);r+=r*((a*l+5)/100),r=Math.round(r);let s=this.getThuocTinh(i),c=(r>0?this._("Tăng"):this._("Giảm"))+" "+r+s.value+" "+s.name+" ",g=new PIXI.Text(c,{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center",fontWeight:"bold"});g.x=5,g.y=e,w.addChild(g),e+=g.height}))}if(t.lo&&"object"==typeof t.lo){e+=10;let i=new PIXI.Graphics;i.beginFill(16777215,1),i.drawRect(0,0,.5*m.width,1),i.endFill(),i.x=m.width/2-i.width/2,i.y=e,w.addChild(i),e+=i.height;let n=new PIXI.Text(this._("Chỉ số khảm đá"),{fontFamily:"Arial",fontSize:15,fill:32896,align:"center",fontWeight:"bold"});n.x=m.width/2-n.width/2,n.y=e,w.addChild(n),e+=n.height,t.lo.forEach((t=>{let i=t;if(0!==i&&-1!==i){let t=this.item.find((e=>e.id==i));if(t&&h.thuoctinh)for(let i in t.thuoctinh){let n=t.thuoctinh[i],h=this.getThuocTinh(i),a=(n>0?this._("Tăng"):this._("Giảm"))+" "+n+h.value+" "+h.name+" ",l=new PIXI.Text(a,{fontFamily:"Arial",fontSize:14,fill:16777215,align:"center",fontWeight:"bold"});l.x=7,l.y=e,w.addChild(l),e+=l.height}}}))}}if(this.viewpointItem(m,w),i){let e=this[i](t.id);a.addChild(e)}let u=e.toGlobal(new PIXI.Point(0,0));if(a.y=u.y,a.x=u.x,a.y+a.height>this.gameHeight){let e=a.y+a.height-this.gameHeight;a.y-=e}if(a.x+a.width>this.gameWidth){let e=a.x+a.width-this.gameWidth;a.x-=e}};viewpointItem=(e,t)=>{if(t.height<e.height){let i=e.height-t.height,n=new PIXI.Graphics;n.beginFill(0,8.00001e-10),n.drawRect(0,0,e.width,i),n.endFill(),n.x=0,n.y=t.height,t.addChild(n)}let i=new pixi_viewport.Viewport({screenWidth:e.width,screenHeight:e.height,worldWidth:t.width,worldHeight:t.height});i.name="viewport",i.drag({direction:"y",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),i.bounce({top:!0,bottom:!0,friction:.5,time:3.5,ease:"easeInOutSine"}),i.setZoom(1),i.addChild(t),e.addChild(i);let n=()=>setInterval((()=>{let e=t.height,n=i.screenHeight,a=i.y;Math.round(a)>Math.round(-e+n)?i.y-=1:clearInterval(h)}),50),h=n();i.interactive=!0,i.cursor="grab",i.on("pointerdown",(e=>{clearInterval(h)})),i.on("pointerup",(e=>{h=n()}))}}class re extends de{constructor(){super()}showItem=(e,t)=>{e.name="item_"+t.id;let i=this.item.find((e=>e.id==t.item));if(!i)return this.notice("Có lỗi xẩy ra"),e;let n=e.width,h=e.height,a=1;a=t.phamchat||0,"item"==i.type&&(a=i.phamchat);let l=[0,0,2142890,9135499,16744228][a],o=new PIXI.Graphics;o.beginFill(l),o.drawRect(0,0,n,h),o.endFill(),e.addChild(o),a<=1&&(o.visible=!1);let d,r=i.img,s=r.src,c=r.num;if(c>1){let e=[],t=80,i=80,n=new PIXI.Sprite(this.coverImg(s));for(let h=0;h<c;h++){let a=new PIXI.Texture(n.texture,new PIXI.Rectangle(0,h*i,t,i));e.push(a)}d=new PIXI.AnimatedSprite(e),d.animationSpeed=.15,d.play()}else d=new PIXI.Sprite(this.coverImg(s));if(d.width=.8*n,d.height=.8*h,d.x=(n-d.width)/2,d.y=(h-d.height)/2,e.addChild(d),"item"==i.type){let i=new PIXI.Graphics;i.beginFill(0,.5);let a=.5*n,l=.3*h;i.drawRoundedRect(0,0,a,l,10),i.endFill(),i.x=(n-a)/2,i.y=h-l,e.addChild(i);let o=new PIXI.Text(t.soluong,{fontFamily:"Arial",fontSize:24,fill:16777215,align:"right",fontWeight:"bold"});o.style.stroke="#564d00",o.style.strokeThickness=4,o=this.fontSize(o,i),o.name="quantity_"+t.id,o.x=i.width/2-.2*o.width,o.y=(i.height-o.height)/2,i.addChild(o)}let g=0;t.level<=0&&(g=0),t.level>=1&&t.level<=3&&(g=1),t.level>3&&t.level<=5&&(g=2),t.level>5&&t.level<=8&&(g=3),t.level>=9&&(g=4);let p=[0,10141901,5570463,16716947,13434880],m=[0,6849419,3050327,9112144,9109504];if(g>=1){let t=new PIXI.Graphics;t.lineStyle(1,p[g],1),t.drawRect(0,0,n,h),t.endFill(),e.addChild(t);let i=new PIXI.Graphics;i.beginFill(m[g]),i.drawCircle(0,0,2),i.endFill(),i.x=0,i.y=0,t.addChild(i);let a=new PIXI.Graphics;a.beginFill(m[g]),a.drawCircle(0,0,2),a.endFill(),a.x=0,a.y=0,t.addChild(a);let l=()=>{TweenMax.to(i,1,{y:h,onComplete:o,onUpdate:()=>{},ease:Linear.easeNone})},o=()=>{i.x=0,i.y=0,TweenMax.to(i,1,{x:n,onComplete:l,ease:Linear.easeNone})},d=()=>{TweenMax.to(a,1,{x:n,onComplete:r,ease:Linear.easeNone})},r=()=>{a.x=0,a.y=0,TweenMax.to(a,1,{y:h,onComplete:d,ease:Linear.easeNone})};o(),r()}return e}}class se extends re{constructor(){super(),this.tab.my=[[9200,"hanhTrang","Hành trang"],[9201,"TrangBi","Trang bị"],[9202,"thongTin","Thông tin"],[9203,"classkinang","Kĩ năng"]]}classkinang=(e="classkinang")=>{let t=this.my,i=(this.backGroundBox(),this.created_ui_1(this.tab.my,e),this.box.getChildByName("body")),n=new PIXI.Graphics;n.beginFill(8744014,1.5),n.lineStyle(2,6966058,1),n.drawRect(0,0,.95*i.width,.95*i.height),n.endFill(),i.addChild(n),n.x=(i.width-n.width)/2,n.y=(i.height-n.height)/2,this.maskPointDefault(n);let h=new PIXI.Container,a=0,l=this.skill;l.sort(((e,t)=>e.type==t.type?0:"tancong"==e.type?-1:"tancong"==t.type?1:"hotro"==e.type?-1:"hotro"==t.type?1:"bidong"==e.type?-1:"bidong"==t.type?1:0));let o=0;l.forEach((e=>{let i=t.skill.find((t=>t[0]&&t[0]==e.id));if(i){let t=new PIXI.Graphics;t.keycode="int04";let l=.95*n.width,d=.3*n.height;d=d>60?60:d,t.beginFill(0,1e-10),t.drawRect(0,0,l,d),t.endFill(),t.x=n.width/2-t.width/2,t.y=a,h.addChild(t),a+=d+5*o,o++,t.interactive=!0,t.cursor="help";let r=0;t.on("pointerdown",(()=>{r=Date.now()})),t.on("pointerup",(()=>{Date.now()-r<300&&this.showInfoSkill(t,i,"btn_skill_gan")}));let s=new PIXI.Container;t.addChild(s);let c=.3*t.width;t.height,c=c>45?45:c;let g=new PIXI.Sprite(this.coverImg(e.avatar));g.width=c,g.height=c,g.x=0,g.y=0,s.addChild(g);let p=new PIXI.Graphics;p.beginFill(0,1e-10),p.drawRect(0,0,t.width-g.width,g.height),p.endFill(),p.x=g.width,p.y=0,s.addChild(p);let m=new PIXI.Container;p.addChild(m);let w=new PIXI.Text(e.name,{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center"});w.x=5,w.y=0,m.addChild(w);let u=new PIXI.Graphics;u.beginFill(16777215,1e-9),u.drawRect(0,0,p.width,p.height-w.height),u.endFill(),u.x=0,u.y=w.height,m.addChild(u);let y=.3*u.width;y=y>100?100:y;let f=new PIXI.Graphics;f.beginFill(0,1e-9),f.drawRect(0,0,y,u.height),f.endFill(),f.x=0,f.y=0,u.addChild(f);let x=new PIXI.Text("Cấp "+i[1],{fontFamily:"Arial",fontSize:15,fill:65280,align:"center"});x.x=5,x.y=f.height/2-x.height/2,f.addChild(x);let I=new PIXI.Graphics;I.beginFill(0,1e-8),I.drawRect(0,0,u.width-f.width,u.height),I.endFill(),I.x=f.width,I.y=0,u.addChild(I);let _=i[3],b=this.expskill[i[1]];b=b||9999;let v=_/b*100;v=v>100?100:v;let C=new PIXI.Graphics;C.beginFill(0,1),C.drawRect(0,0,I.width,I.height),C.endFill(),C.x=0,C.y=0,I.addChild(C);let P=new PIXI.Graphics;P.beginFill(65280,1),P.drawRect(0,0,C.width*v/100,C.height),P.endFill(),P.x=0,P.y=0,C.addChild(P);let S=Math.fround(v).toFixed(2),X=new PIXI.Text(S+"%",{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center"});X.x=C.width/2-X.width/2,X.y=C.height/2-X.height/2,C.addChild(X),m.y=p.height/2-m.height/2,s.x=0,s.y=(t.height-s.height)/2}})),this.viewPointDefaultY(n,h)};thongTin=(e="thongTin")=>{let t=this.my,i=(this.backGroundBox(),this.created_ui_1(this.tab.my,e),this.box.getChildByName("body")),n=new PIXI.Graphics;n.beginFill(8744014,1.5),n.lineStyle(2,6966058,1),n.drawRect(0,0,.95*i.width,.95*i.height),n.endFill(),i.addChild(n),n.x=(i.width-n.width)/2,n.y=(i.height-n.height)/2,this.maskPointDefault(n);let h=new PIXI.Container,a=0,l=["haki","_haki","hpmax","mpmax","sat_thuong_vat_ly","sat_thuong_phep","khang_vat_ly","khang_phep","_hpmax","_mpmax","_chi_mang","_sat_thuong_chi_mang","_giam_sat_thuong_chi_mang","_hoi_mau","_hoi_mp","_sat_thuong_vat_ly","_sat_thuong_phep","_khang_vat_ly","_khang_phep","hoi_chieu"];for(let e of l){let i=t.info.chiso[e]||0,l=this.getThuocTinh(e),o=l.name+" "+i+l.value+"  ";0==e.indexOf("_")&&(o=(i>=0?this._("Tăng"):this._("Giảm"))+" "+o);let d=new PIXI.Text(o,{fontFamily:"Arial",fontSize:15,fill:16777215,align:"left",fontWeight:"bold",WordWrap:!0,WordWrapWidth:n.width-10});d.x=0,d.y=a,a+=d.height+5,h.addChild(d)}h.x=15,this.viewPointDefault(n,h)};TrangBi=(e="TrangBi")=>{let t=this.my,i=(this.backGroundBox(),this.created_ui_1(this.tab.my,e),this.box.getChildByName("body")),n=new PIXI.Graphics;n.beginFill(0,1e-10),n.drawRect(0,0,.95*i.width,.95*i.height),n.endFill(),i.addChild(n),n.x=(i.width-n.width)/2,n.y=(i.height-n.height)/2;let h=.3*n.width,a=n.height;h=h>48?48:h;let l=new PIXI.Graphics;l.beginFill(16777215,5e-16),l.drawRect(0,0,h,a),l.endFill(),n.addChild(l);let o=["vukhi","nhan","daychuyen","caitrang"],d=new PIXI.Container;l.addChild(d),o.forEach(((e,i)=>{let n=h,l=(a-5*o.length)/o.length;l=l>48?48:l;let r=new PIXI.Graphics;if(r.beginFill(11440233,1.0000000001),r.lineStyle(2,6966058,1),r.drawRect(0,0,n,l),r.endFill(),r.x=0,r.y=i*l+5*i,d.addChild(r),t.trangbi[e]&&0!=t.trangbi[e]){r.interactive=!0,r.cursor="help";let i=0,n=t.ruong.data.find((i=>i.id==t.trangbi[e]&&"trangbi"==i.active));n&&(r.on("pointerdown",(()=>{i=Date.now()})),r.on("pointerup",(()=>{Date.now()-i<200&&this.previewItemBag(r,n)})),r=this.showItem(r,n))}})),d.y=(a-d.height)/2;let r=new PIXI.Graphics;r.beginFill(16777215,5e-12),r.drawRect(0,0,h,a),r.endFill(),r.x=n.width-r.width,n.addChild(r);let s=new PIXI.Container;r.addChild(s),["non","ao","quan","thucuoi"].forEach(((e,i)=>{let n=h,l=(a-5*o.length)/o.length;l=l>48?48:l;let d=new PIXI.Graphics;if(d.beginFill(11440233,1.0000000001),d.lineStyle(2,6966058,1),d.drawRect(0,0,n,l),d.endFill(),d.x=0,d.y=i*l+5*i,s.addChild(d),t.trangbi[e]&&0!=t.trangbi[e]){d.interactive=!0,d.cursor="help";let i=0,n=t.ruong.data.find((i=>i.id==t.trangbi[e]&&"trangbi"==i.active));n&&(d.on("pointerdown",(()=>{i=Date.now()})),d.on("pointerup",(()=>{Date.now()-i<200&&this.previewItemBag(d,n)})),d=this.showItem(d,n))}})),s.y=(a-s.height)/2;let c=n.width-2*h,g=.8*n.height,p=new PIXI.Graphics;p.beginFill(16777215,1e-10),p.drawRect(0,0,c,g),p.endFill(),p.x=h,p.y=(n.height-p.height)/2,n.addChild(p);let m=.9*p.width,w=1*p.height,u=new PIXI.Graphics;u.beginFill(11440233,1.5),u.lineStyle(1,6966058,1),u.drawRect(0,0,m,w),u.endFill(),u.x=(p.width-u.width)/2,u.y=(p.height-u.height)/2,p.addChild(u);let y=.6*u.width,f=1*u.height,x=new PIXI.Graphics;x.beginFill(11440233,1e-8),x.drawRect(0,0,y,f),x.endFill(),x.x=0,x.y=(u.height-x.height)/2,u.addChild(x);let I=u.width-x.width,_=.5*u.height,b=new PIXI.Graphics;b.beginFill(11440233,5e-16),b.drawRect(0,0,I,_),b.endFill(),b.x=x.width,b.y=(u.height-b.height)/2,u.addChild(b);let v=this.created_sprite_skin_hi(t,"dungyen");v.x=(b.width-v.width)/2,v.y=(b.height-v.height)/2,b.addChild(v),v.alpha=0;let C=TweenMax.to(v,.1,{x:v.x-3,repeat:-1,yoyo:!0});TweenMax.to(v,1,{alpha:1}).eventCallback("onComplete",(()=>{C.kill()}))};hanhTrang=(e="hanhTrang")=>{this.backGroundBox(),this.created_ui_1(this.tab.my,e);let t=this.box.getChildByName("body"),i=new PIXI.Container;i.name="container";let n=new PIXI.Graphics;n.beginFill(0,.5),n.drawRect(0,0,t.width,t.height),n.endFill(),i.mask=n,t.addChild(n);let h=this.my.ruong.data.filter((e=>"hanhtrang"==e.active));if(h.sort(((e,t)=>e.time-t.time)),t){let e=this.my.ruong.max,n=.2*t.width;n=n>48?48:n;let a=n,l=2,o=2,d=Math.floor(t.width/(n+l));for(let t=0;t<e;t++){let e=new PIXI.Graphics;e.beginFill(11440233,.5),e.drawRect(0,0,n,a),e.endFill(),e.x=t%d*(n+l),e.y=Math.floor(t/d)*(a+o),e.interactive=!0,e.keycode="int04",e.cursor="pointer";let r=0;h[t]&&(e.on("pointerdown",(()=>{r=Date.now()})),e.on("pointerup",(()=>{Date.now()-r<200&&this.previewItemBag(e,h[t],"btn_hanhtrang")})),e=this.showItem(e,h[t])),i.addChild(e)}if(i.height<t.height){let e=t.height,n=t.width,h=new PIXI.Graphics;h.beginFill(0,5e-9),h.drawRect(0,0,n,e),h.endFill(),i.addChild(h)}let r=new pixi_viewport.Viewport({screenWidth:t.width,screenHeight:t.height,worldWidth:i.width,worldHeight:i.height});r.name="viewport",r.drag({direction:"y",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),r.bounce({top:!0,bottom:!0,friction:.5,time:3.5,ease:"easeInOutSine"}),r.setZoom(1),r.addChild(i),t.addChild(r);let s=0,c=-1,g=-1,p=-1;r.on("pointerdown",(e=>{s=Date.now()})),r.on("pointerup",(e=>{if(Date.now()-s<200){let t=e.data.global.x,n=e.data.global.y,h=i.toLocal(new PIXI.Point(t,n));h.x=Math.round(h.x),h.y=Math.round(h.y);let a=i.children.filter((e=>"int04"==e.keycode));for(let e=0;e<a.length;e++)a[e].removeChild(a[e].getChildByName("xanhle"));for(let e=0;e<a.length;e++)if(a[e].x<=h.x&&h.x<=a[e].x+a[e].width&&a[e].y<=h.y&&h.y<=a[e].y+a[e].height){let t=a[e].width,i=a[e].height,n=new PIXI.Graphics;n.lineStyle(1,16777215,1),n.beginFill(16318026,1e-6),n.drawRoundedRect(0,0,t,i,0),n.endFill(),n.name="xanhle",a[e].addChild(n);let h=a[e],l=this.findInteractiveObjects(h);l.length>0&&(l[0].emit("pointerdown"),l[0].emit("pointerup")),g=e%d,p=Math.floor(e/d),c=e}}else clearInterval(this.pcSettimeEntactive),setTimeout((function(){clearInterval(this.pcSettimeEntactive),m()}),200)}));let m=()=>{this.pcSettimeEntactive&&clearInterval(this.pcSettimeEntactive),this.pcSettimeEntactive=setInterval((()=>{let e=this.pcKey;if(this.box.children.length<=0)return clearInterval(this.pcSettimeEntactive),!1;let t=i.children.filter((e=>"int04"==e.keycode));if("ArrowUp"==e?-1==p?p=0:p--:"ArrowDown"==e?-1==p?p=0:p++:"ArrowLeft"==e?-1==g?g=0:g--:"ArrowRight"==e&&(-1==g?g=0:g++),c=g>=0&&p>=0?p*d+g:g>=0&&-1==p?g:-1==g&&p>=0?p:-1,"Enter"==e&&c>=0){let e=t[c],i=this.findInteractiveObjects(e);i.length>0&&(i[0].emit("pointerdown"),i[0].emit("pointerup"))}if(t[c]&&this.pcKey.length>=1){for(let e=0;e<t.length;e++)t[e].removeChild(t[e].getChildByName("xanhle"));r.moveCenter(t[c].x,t[c].y);let e=t[c].width,i=t[c].height,n=new PIXI.Graphics;n.lineStyle(1,16777215,1),n.beginFill(16318026,1e-9),n.drawRoundedRect(0,0,e,i,0),n.endFill(),n.name="xanhle",t[c].addChild(n);let h=t[c],a=this.findInteractiveObjects(h);a.length>0&&(n.interactive=!0,n.cursor="pointer",n.on("pointerdown",(()=>{a[0].emit("pointerdown")})),n.on("pointerup",(()=>{a[0].emit("pointerup")})))}this.pcKey=""}),30)};m()}}}const ce=(t,i)=>{t.backGroundBox(),e(t,[[9208,"shop","Nâng cấp",i,we],[9200,"hanhtrang","Hành trang",i,ce]],"hanhtrang");let n=t.box.getChildByName("body"),h=new PIXI.Container;h.name="container";let a=new PIXI.Graphics;a.beginFill(0,.5),a.drawRect(0,0,n.width,n.height),a.endFill(),h.mask=a,n.addChild(a);let l=t.my.ruong.data.filter((e=>"hanhtrang"===e.active));if(l.sort(((e,t)=>e.time-t.time)),n){let e=t.my.ruong.max,i=.2*n.width;i=i>48?48:i;let a=i,o=2,d=2,r=Math.floor(n.width/(i+o));for(let n=0;n<e;n++){let e=new PIXI.Graphics;e.beginFill(11440233,.5),e.drawRect(0,0,i,a),e.endFill(),e.x=n%r*(i+o),e.y=Math.floor(n/r)*(a+d),e.interactive=!0,e.keycode="int04",e.cursor="pointer";let s=0;l[n]&&!t.cache.nangcap.data.find((e=>e===l[n].id))&&(e.on("pointerdown",(()=>{s=Date.now()})),e.on("pointerup",(()=>{Date.now()-s<200&&t.previewItemBag(e,l[n],"btn_nangcap")})),e=t.showItem(e,l[n])),h.addChild(e)}if(h.height<n.height){let e=n.height,t=n.width,i=new PIXI.Graphics;i.beginFill(0,5e-9),i.drawRect(0,0,t,e),i.endFill(),h.addChild(i)}let s=new pixi_viewport.Viewport({screenWidth:n.width,screenHeight:n.height,worldWidth:h.width,worldHeight:h.height});s.name="viewport",s.drag({direction:"y",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),s.bounce({top:!0,bottom:!0,friction:.5,time:3.5,ease:"easeInOutSine"}),s.setZoom(1),s.addChild(h),n.addChild(s);let c=0,g=-1,p=-1,m=-1;s.on("pointerdown",(e=>{c=Date.now()})),s.on("pointerup",(e=>{if(Date.now()-c<200){let i=e.data.global.x,n=e.data.global.y,a=h.toLocal(new PIXI.Point(i,n));a.x=Math.round(a.x),a.y=Math.round(a.y);let l=h.children.filter((e=>"int04"==e.keycode));for(let e=0;e<l.length;e++)l[e].removeChild(l[e].getChildByName("xanhle"));for(let e=0;e<l.length;e++)if(l[e].x<=a.x&&a.x<=l[e].x+l[e].width&&l[e].y<=a.y&&a.y<=l[e].y+l[e].height){let i=l[e].width,n=l[e].height,h=new PIXI.Graphics;h.lineStyle(1,16777215,1),h.beginFill(16318026,1e-6),h.drawRoundedRect(0,0,i,n,0),h.endFill(),h.name="xanhle",l[e].addChild(h);let a=l[e],o=t.findInteractiveObjects(a);o.length>0&&(o[0].emit("pointerdown"),o[0].emit("pointerup")),p=e%r,m=Math.floor(e/r),g=e}}else clearInterval(t.pcSettimeEntactive),setTimeout((function(){clearInterval(t.pcSettimeEntactive),w()}),200)}));let w=()=>{t.pcSettimeEntactive&&clearInterval(t.pcSettimeEntactive),t.pcSettimeEntactive=setInterval((()=>{let e=t.pcKey;if(t.box.children.length<=0)return clearInterval(t.pcSettimeEntactive),!1;let i=h.children.filter((e=>"int04"==e.keycode));if("ArrowUp"==e?-1==m?m=0:m--:"ArrowDown"==e?-1==m?m=0:m++:"ArrowLeft"==e?-1==p?p=0:p--:"ArrowRight"==e&&(-1==p?p=0:p++),g=p>=0&&m>=0?m*r+p:p>=0&&-1==m?p:-1==p&&m>=0?m:-1,"Enter"==e&&g>=0){let e=i[g],n=t.findInteractiveObjects(e);n.length>0&&(n[0].emit("pointerdown"),n[0].emit("pointerup"))}if(i[g]&&t.pcKey.length>=1){for(let e=0;e<i.length;e++)i[e].removeChild(i[e].getChildByName("xanhle"));s.moveCenter(i[g].x,i[g].y);let e=i[g].width,n=i[g].height,h=new PIXI.Graphics;h.lineStyle(1,16777215,1),h.beginFill(16318026,1e-9),h.drawRoundedRect(0,0,e,n,0),h.endFill(),h.name="xanhle",i[g].addChild(h);let a=i[g],l=t.findInteractiveObjects(a);l.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{l[0].emit("pointerdown")})),h.on("pointerup",(()=>{l[0].emit("pointerup")})))}t.pcKey=""}),30)};w()}},ge=e=>{let t=e.my;if(t.id<=0)return e.chipi(e._("Bạn chưa đăng nhập"));let i=e.cache.nangcap.id;if(!i)return e.chipi(e._("Bạn chưa chọn trang bị"));let n=t.ruong.data.find((e=>e.id==i&&"hanhtrang"===e.active));if(!n)return e.chipi(e._("Không tìm thấy trang bị"));let h=e.item.find((e=>e.id==n.item));if(!h)return e.chipi(e._("Không tìm thấy trang bị"));if("trangbi"!==h.type)return e.chipi(e._("Không phải trang bị"));let a=!1,l=!1,o=!1,d=!1,r=!1,s=!1,c=e.cache.nangcap.data,g=e.config.nangcap;if(!g.tile[n.level])return e.chipi(e._("Trang bị đã đạt cấp độ tối đa rồi."));let p=g.da[n.level];if(c.length<=1)return e.chipi(e._("Bạn chưa chọn đủ vật phẩm"));if(c.forEach((i=>{let h=t.ruong.data.find((e=>e.id==i&&"hanhtrang"===e.active));if(h){let a=e.item.find((e=>e.id==h.item));a?"item"===a.type&&("botnangcap"!==a.type2&&"nangcaotile"!==a.type2&&"nangcaptut"!==a.type2?o=!0:("botnangcap"===a.type2&&(s=!0),"botnangcap"===a.type2&&p>h.soluong?r=!0:"botnangcap"===a.type2&&a.value<n.phamchat?d=!0:c.forEach((n=>{let h=t.ruong.data.find((e=>e.id==n&&"hanhtrang"===e.active));if(h){let t=e.item.find((e=>e.id==h.item));t&&i!==n&&"item"===t.type&&t.type2===a.type2&&(l=!0)}})))):o=!0}else console.log(h),a=!0})),!1===s)return e.chipi(e._("Bạn chưa chọn đá nâng cấp"));if(a)return e.chipi(e._("Không tìm thấy vật phẩm"));if(l)return e.chipi(e._("Không thể chọn 2 vật phẩm cùng loại với nhau"));if(o)return e.chipi(e._("Vật phẩm này không thể nâng cấp"));if(d)return e.chipi(e._("Loại đá bạn lựa chọn không thể nâng cấp vật phẩm này."));if(r)return e.chipi(e._("Bạn không có đủ đá để nâng cấp."));if(g.beri[n.level]>t.tien.beri)return e.chipi(e._("Bạn không có đủ beri để nâng cấp"));let m=e.findText("button_nangcap_item");return m&&(m.visible=!1),e.send(-9,[1,i,c]),e.wait(e._("Xin chờ..."))},pe=(e,t,i)=>new PIXI.Text(e._(t),{fontFamily:"Arial",fontSize:14,fill:16777215,align:"center",wordWrap:!0,wordWrapWidth:.9*i.width,breakWords:!0,whiteSpace:"normal"}),me=(t,i)=>{(e=>{e.cache.nangcap.data.forEach((t=>{let i=e.my.ruong.data.find((e=>e.id===t&&"hanhtrang"===e.active));if(i){let n=e.item.find((e=>e.id==i.item));n?"item"===n.type&&i.soluong<=0&&(e.cache.nangcap.data=e.cache.nangcap.data.filter((e=>e!==t))):e.cache.nangcap.data=e.cache.nangcap.data.filter((e=>e!==t))}else e.cache.nangcap.data=e.cache.nangcap.data.filter((e=>e!==t))}));let t=e.cache.nangcap.id;if(0!==t){let i=e.my.ruong.data.find((e=>e.id===t&&"hanhtrang"===e.active));i||(e.cache.nangcap.id=0,e.cache.nangcap.data=[])}})(t),t.box.removeChildren(),t.backGroundBox(),e(t,[[9208,"shop","Nâng cấp",i,me],[9200,"hanhtrang","Hành trang",i,ce]],"shop");let n=t.box.getChildByName("body"),h=new PIXI.Container;h.name="container";let a=t.my,l=[],o=t.cache.nangcap.data;if(o&&o.length>=1&&o.forEach((e=>{let t=a.ruong.data.find((t=>t.id===e&&"hanhtrang"===t.active));t&&l.push(t)})),n){let e=l.length+10,i=.2*n.width;i=i>48?48:i;let o=i,d=2,r=2,s=Math.floor(n.width/(i+d));for(let n=0;n<e;n++){let e=new PIXI.Graphics;e.beginFill(11440233,.5),e.drawRect(0,0,i,o),e.endFill(),e.x=n%s*(i+d),e.y=Math.floor(n/s)*(o+r),e.interactive=!0,e.keycode="int04",e.cursor="pointer";let a=0;l[n]&&(e.on("pointerdown",(()=>{a=Date.now()})),e.on("pointerup",(()=>{Date.now()-a<200&&t.previewItemBag(e,l[n],"btn_nangcap")})),e=t.showItem(e,l[n]),e.name="o_nguyen_lieu_"+l[n].id),h.addChild(e)}let c=new PIXI.Graphics;c.beginFill(0,.05),c.drawRect(0,0,n.width,.6*n.height),c.endFill(),n.addChild(c);let g=new PIXI.Graphics;g.beginFill(0,5e-12),g.drawRect(0,0,.6*c.width,c.height),g.endFill(),c.addChild(g);let p=new PIXI.Graphics;p.beginFill(0,2e-8),p.drawRect(0,0,g.width,.7*c.height),p.endFill(),g.addChild(p);let m=2,w=.2*p.width;w=w>48?48:w;let u=w,y=15,f=new PIXI.Container;for(let e=0;e<m;e++){let i=new PIXI.Graphics;i.beginFill(11440233,.5),i.drawRect(0,0,w,u),i.endFill(),i.x=y+e*(w+y),i.y=0;let n=t.cache.nangcap.id;if(n){let h=!1,l=a.ruong.data.find((e=>e.id===n&&"hanhtrang"===e.active)),o=l;if(l){let n=t.item.find((e=>e.id==l.item));if(!n||n&&"trangbi"!==n.type);else if(0===e)i=t.showItem(i,l),h=!0,o=l;else if(t.config.nangcap.tile[o.level]){let e=Object.assign({},o);e.level=o.level+1,i=t.showItem(i,e),h=!0,o=e;let n=t.createAnimationArray([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],.5,!1,"./assets/eff/6/");i.addChild(n),n.name="animation_run_nangcap",n.width=2*w,n.height=2*u,n.x=.5*-w,n.y=.5*-u,n.visible=!1;let a=t.createAnimationArray([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21],.5,!1,"./assets/eff/9/");i.addChild(a),a.name="animation_success_nangcap",a.width=2*w,a.height=2*u,a.x=.5*-w,a.y=.5*-u,a.visible=!1}}if(!0===h){i.interactive=!0,i.cursor="pointer";let e=0;i.on("pointerdown",(()=>{e=Date.now()})),i.on("pointerup",(()=>{Date.now()-e<200&&t.previewItemBag(i,o,"btn_nangcap")}))}i.name="o_nangcap_"+e}f.addChild(i)}p.addChild(f),f.x=(p.width-f.width)/2,f.y=(p.height-f.height)/2;let x=new PIXI.Graphics;x.beginFill(0,.1),x.drawRect(0,0,g.width,.3*c.height),x.endFill(),x.y=g.height-x.height,g.addChild(x);let I=.3*x.width;I=I>100?100:I;let _=.5*x.height;_=_>50?50:_;let b=new PIXI.Graphics;b.beginFill(8810843,1),b.drawRect(0,0,I,_),b.lineStyle(1,16380627,3),b.endFill(),b.x=(x.width-b.width)/2,b.y=(x.height-b.height)/2,b.interactive=!0,b.keycode="int04",b.cursor="pointer",b.name="button_nangcap_item";let v=0;b.on("pointerdown",(()=>{v=Date.now()})),b.on("pointerup",(()=>{Date.now()-v<200&&ge(t)})),x.addChild(b);let C=new PIXI.Text(t._("Nâng cấp"),{fontFamily:"Arial",fontSize:14,fill:16777215,align:"center"});C.anchor.set(.5),C.x=b.width/2,C.y=b.height/2,b.addChild(C);let P=new PIXI.Graphics;P.beginFill(0,.2),P.drawRect(0,0,.4*c.width,c.height),P.endFill(),P.x=c.width-P.width,c.addChild(P);let S=new PIXI.Container;if(t.cache.nangcap.id){let e=a.ruong.data.find((e=>e.id===t.cache.nangcap.id&&"hanhtrang"===e.active));if(e){let i=e.level,n=t.config.nangcap,h=n.tile[i];if(h){let e=pe(t,"Để nâng cấp trang bị lên cấp "+(i+1)+" cần: ",P);S.addChild(e);let l=n.beri,o=n.da;l=l[i],o=o[i];let d=pe(t,"- "+l+" Beri",P);d.y=e.y+e.height+5,S.addChild(d);let r=pe(t,"- "+o+" đá",P);r.y=d.y+d.height+5,S.addChild(r);let s=0;t.cache.nangcap.data.forEach((e=>{let i=a.ruong.data.find((t=>t.id===e&&"hanhtrang"===t.active));if(i){let e=t.item.find((e=>e.id===i.item));e&&"nangcaotile"===e.type2&&(s=e.value)}}));let c=pe(t,"- "+h+"%"+(s>0?" +"+s+"%":"")+" tỉ lệ thành công",P);c.y=r.y+r.height+5,S.addChild(c)}else{let e=pe(t,"Vật phẩm đã đạt cấp độ tối đa.",P);S.addChild(e)}}}else{let e=pe(t,"Lựa chọn vật phẩm cần nâng cấp, sau đó chọn đá.",P);S.addChild(e)}S.x=(P.width-S.width)/2,S.y=(P.height-S.height)/2,t.maskPointDefault(P),t.viewPointDefault(P,S);let X=new PIXI.Graphics;X.beginFill(0,1e-7),X.drawRect(0,n.height-.4*n.height,n.width,.4*n.height),X.endFill(),n.addChild(X),X.y=.6*n.height;let k=new pixi_viewport.Viewport({screenWidth:X.width,screenHeight:X.height,worldWidth:h.width,worldHeight:h.height});k.name="viewport",k.drag({direction:"y",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),k.bounce({top:!0,bottom:!0,friction:.5,time:3.5,ease:"easeInOutSine"}),k.setZoom(1),k.addChild(h),X.addChild(k);let T=0,F=-1,M=-1,W=-1;k.on("pointerdown",(e=>{T=Date.now()})),k.on("pointerup",(e=>{if(Date.now()-T<200){let i=e.data.global.x,n=e.data.global.y,a=h.toLocal(new PIXI.Point(i,n));a.x=Math.round(a.x),a.y=Math.round(a.y);let l=h.children.filter((e=>"int04"==e.keycode));for(let e=0;e<l.length;e++)l[e].removeChild(l[e].getChildByName("xanhle"));for(let e=0;e<l.length;e++)if(l[e].x<=a.x&&a.x<=l[e].x+l[e].width&&l[e].y<=a.y&&a.y<=l[e].y+l[e].height){let i=l[e].width,n=l[e].height,h=new PIXI.Graphics;h.lineStyle(1,16777215,1),h.beginFill(16318026,1e-6),h.drawRoundedRect(0,0,i,n,0),h.endFill(),h.name="xanhle",l[e].addChild(h);let a=l[e],o=t.findInteractiveObjects(a);o.length>0&&(o[0].emit("pointerdown"),o[0].emit("pointerup")),M=e%s,W=Math.floor(e/s),F=e}}else clearInterval(t.pcSettimeEntactive),setTimeout((function(){clearInterval(t.pcSettimeEntactive),E()}),200)}));let E=()=>{t.pcSettimeEntactive&&clearInterval(t.pcSettimeEntactive),t.pcSettimeEntactive=setInterval((()=>{let e=t.pcKey;if(t.box.children.length<=0)return clearInterval(t.pcSettimeEntactive),!1;let i=h.children.filter((e=>"int04"==e.keycode));if("ArrowUp"==e?-1==W?W=0:W--:"ArrowDown"==e?-1==W?W=0:W++:"ArrowLeft"==e?-1==M?M=0:M--:"ArrowRight"==e&&(-1==M?M=0:M++),F=M>=0&&W>=0?W*s+M:M>=0&&-1==W?M:-1==M&&W>=0?W:-1,"Enter"==e&&F>=0){let e=i[F],n=t.findInteractiveObjects(e);n.length>0&&(n[0].emit("pointerdown"),n[0].emit("pointerup"))}if(i[F]&&t.pcKey.length>=1){for(let e=0;e<i.length;e++)i[e].removeChild(i[e].getChildByName("xanhle"));k.moveCenter(i[F].x,i[F].y);let e=i[F].width,n=i[F].height,h=new PIXI.Graphics;h.lineStyle(1,16777215,1),h.beginFill(16318026,1e-9),h.drawRoundedRect(0,0,e,n,0),h.endFill(),h.name="xanhle",i[F].addChild(h);let a=i[F],l=t.findInteractiveObjects(a);l.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{l[0].emit("pointerdown")})),h.on("pointerup",(()=>{l[0].emit("pointerup")})))}t.pcKey=""}),30)};E()}},we=(e,t)=>{console.log("open"),me(e,t)},ue=(e,t)=>{let i=e.my;if(i.id<=0)return e.chipi(e._("Bạn chưa đăng nhập"));let n=i.ruong.data.find((e=>e.id==t&&"hanhtrang"===e.active));if(!n)return e.chipi(e._("Không tìm thấy vật phẩm"));let h=e.item.find((e=>e.id==n.item));if(!h)return e.chipi(e._("Không tìm thấy vật phẩm"));if("trangbi"===h.type&&0!==e.cache.nangcap.id&&(e.cache.nangcap.data=e.cache.nangcap.data.filter((t=>t!==e.cache.nangcap.id)),e.cache.nangcap.id=0),ye(e,t))return"trangbi"===h.type&&(e.cache.nangcap.id=0),e.cache.nangcap.data=e.cache.nangcap.data.filter((e=>e!==t)),e.nangcap();if("item"===h.type&&"botnangcap"!==h.type2&&"nangcaotile"!==h.type2&&"nangcaptut"!==h.type2)return e.chipi(e._("Vật phẩm này không thể nâng cấp"));let a=!1;return e.cache.nangcap.data.forEach((n=>{let l=i.ruong.data.find((e=>e.id==n&&"hanhtrang"===e.active));if(l){let i=e.item.find((e=>e.id==l.item));n!==t&&"item"===h.type&&i&&"item"===i.type&&i.type2===h.type2&&(a=!0)}})),a?e.chipi(e._("Không thể chọn 2 vật phẩm cùng loại với nhau")):("trangbi"===h.type&&(e.cache.nangcap.id=t),e.cache.nangcap.data.push(t),e.nangcap())},ye=(e,t)=>!!e.cache.nangcap.data.find((e=>e===t)),fe=(t,i)=>{t.backGroundBox(),e(t,[[9208,"shop","Nâng cấp",i,_e],[9200,"hanhtrang","Hành trang",i,fe]],"hanhtrang");let n=t.box.getChildByName("body"),h=new PIXI.Container;h.name="container";let a=new PIXI.Graphics;a.beginFill(0,.5),a.drawRect(0,0,n.width,n.height),a.endFill(),h.mask=a,n.addChild(a);let l=t.my.ruong.data.filter((e=>"hanhtrang"===e.active));if(l.sort(((e,t)=>e.time-t.time)),n){let e=t.my.ruong.max,i=.2*n.width;i=i>48?48:i;let a=i,o=2,d=2,r=Math.floor(n.width/(i+o));for(let n=0;n<e;n++){let e=new PIXI.Graphics;e.beginFill(11440233,.5),e.drawRect(0,0,i,a),e.endFill(),e.x=n%r*(i+o),e.y=Math.floor(n/r)*(a+d),e.interactive=!0,e.keycode="int04",e.cursor="pointer";let s=0;l[n]&&!t.cache.ghepItem.data.find((e=>e===l[n].id))&&(e.on("pointerdown",(()=>{s=Date.now()})),e.on("pointerup",(()=>{Date.now()-s<200&&t.previewItemBag(e,l[n],"btn_ghep")})),e=t.showItem(e,l[n])),h.addChild(e)}if(h.height<n.height){let e=n.height,t=n.width,i=new PIXI.Graphics;i.beginFill(0,5e-9),i.drawRect(0,0,t,e),i.endFill(),h.addChild(i)}let s=new pixi_viewport.Viewport({screenWidth:n.width,screenHeight:n.height,worldWidth:h.width,worldHeight:h.height});s.name="viewport",s.drag({direction:"y",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),s.bounce({top:!0,bottom:!0,friction:.5,time:3.5,ease:"easeInOutSine"}),s.setZoom(1),s.addChild(h),n.addChild(s);let c=0,g=-1,p=-1,m=-1;s.on("pointerdown",(e=>{c=Date.now()})),s.on("pointerup",(e=>{if(Date.now()-c<200){let i=e.data.global.x,n=e.data.global.y,a=h.toLocal(new PIXI.Point(i,n));a.x=Math.round(a.x),a.y=Math.round(a.y);let l=h.children.filter((e=>"int04"==e.keycode));for(let e=0;e<l.length;e++)l[e].removeChild(l[e].getChildByName("xanhle"));for(let e=0;e<l.length;e++)if(l[e].x<=a.x&&a.x<=l[e].x+l[e].width&&l[e].y<=a.y&&a.y<=l[e].y+l[e].height){let i=l[e].width,n=l[e].height,h=new PIXI.Graphics;h.lineStyle(1,16777215,1),h.beginFill(16318026,1e-6),h.drawRoundedRect(0,0,i,n,0),h.endFill(),h.name="xanhle",l[e].addChild(h);let a=l[e],o=t.findInteractiveObjects(a);o.length>0&&(o[0].emit("pointerdown"),o[0].emit("pointerup")),p=e%r,m=Math.floor(e/r),g=e}}else clearInterval(t.pcSettimeEntactive),setTimeout((function(){clearInterval(t.pcSettimeEntactive),w()}),200)}));let w=()=>{t.pcSettimeEntactive&&clearInterval(t.pcSettimeEntactive),t.pcSettimeEntactive=setInterval((()=>{let e=t.pcKey;if(t.box.children.length<=0)return clearInterval(t.pcSettimeEntactive),!1;let i=h.children.filter((e=>"int04"==e.keycode));if("ArrowUp"==e?-1==m?m=0:m--:"ArrowDown"==e?-1==m?m=0:m++:"ArrowLeft"==e?-1==p?p=0:p--:"ArrowRight"==e&&(-1==p?p=0:p++),g=p>=0&&m>=0?m*r+p:p>=0&&-1==m?p:-1==p&&m>=0?m:-1,"Enter"==e&&g>=0){let e=i[g],n=t.findInteractiveObjects(e);n.length>0&&(n[0].emit("pointerdown"),n[0].emit("pointerup"))}if(i[g]&&t.pcKey.length>=1){for(let e=0;e<i.length;e++)i[e].removeChild(i[e].getChildByName("xanhle"));s.moveCenter(i[g].x,i[g].y);let e=i[g].width,n=i[g].height,h=new PIXI.Graphics;h.lineStyle(1,16777215,1),h.beginFill(16318026,1e-9),h.drawRoundedRect(0,0,e,n,0),h.endFill(),h.name="xanhle",i[g].addChild(h);let a=i[g],l=t.findInteractiveObjects(a);l.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{l[0].emit("pointerdown")})),h.on("pointerup",(()=>{l[0].emit("pointerup")})))}t.pcKey=""}),30)};w()}},xe=(e,t,i)=>new PIXI.Text(e._(t),{fontFamily:"Arial",fontSize:14,fill:16777215,align:"center",wordWrap:!0,wordWrapWidth:.9*i.width,breakWords:!0,whiteSpace:"normal"}),Ie=(t,i)=>{(e=>{let t=e.cache.ghepItem.data,i=-1;for(let n=0;n<e.cache.ghep.length;n++){let h=e.cache.ghep[n],a=h[0],l=h[1],o=h[2];if(a&&l&&o){if(t.length!==o.length)continue;let h=0;o.forEach((i=>{let n=i[0];n&&t.forEach((t=>{let i=e.my.ruong.data.find((e=>e.id===t&&"hanhtrang"===e.active));i&&i.item===n&&h++}))})),h===t.length&&(i=n)}}e.cache.ghepItem.id=i})(t),t.box.removeChildren(),t.backGroundBox(),e(t,[[9208,"shop","Ghép vật phẩm",i,Ie],[9200,"hanhtrang","Hành trang",i,fe]],"shop");let n=t.box.getChildByName("body"),h=new PIXI.Container;h.name="container";let a=t.my,l=[],o=t.cache.ghepItem.data;if(o&&o.length>=1&&o.forEach((e=>{let t=a.ruong.data.find((t=>t.id===e&&"hanhtrang"===t.active));t&&l.push(t)})),n){let e=l.length+10,i=.2*n.width;i=i>48?48:i;let a=i,o=2,d=2,r=Math.floor(n.width/(i+o));for(let n=0;n<e;n++){let e=new PIXI.Graphics;e.beginFill(11440233,.5),e.drawRect(0,0,i,a),e.endFill(),e.x=n%r*(i+o),e.y=Math.floor(n/r)*(a+d),e.interactive=!0,e.keycode="int04",e.cursor="pointer";let s=0;l[n]&&(e.on("pointerdown",(()=>{s=Date.now()})),e.on("pointerup",(()=>{Date.now()-s<200&&t.previewItemBag(e,l[n],"btn_ghep")})),e=t.showItem(e,l[n]),e.name="o_nguyen_lieu_"+l[n].id),h.addChild(e)}let s=new PIXI.Graphics;s.beginFill(0,.05),s.drawRect(0,0,n.width,.6*n.height),s.endFill(),n.addChild(s);let c=new PIXI.Graphics;c.beginFill(0,5e-12),c.drawRect(0,0,.6*s.width,s.height),c.endFill(),s.addChild(c);let g=new PIXI.Graphics;g.beginFill(0,2e-8),g.drawRect(0,0,c.width,.7*s.height),g.endFill(),c.addChild(g);let p=1,m=.2*g.width;m=m>48?48:m;let w=m,u=15,y=new PIXI.Container;for(let e=0;e<p;e++){let i=new PIXI.Graphics;if(i.beginFill(11440233,.5),i.drawRect(0,0,m,w),i.endFill(),i.x=u+e*(m+u),i.y=0,-1!=t.cache.ghepItem.id){let e=t.cache.ghepItem.id,n=t.cache.ghep[e];if(n){let e=n[0];if(e){let n=e[0],h=(e[1],e[2]),a={id:"int04",time:Date.now(),soluong:1,item:n,phamchat:h||1};i=t.showItem(i,a),i.interactive=!0,i.cursor="pointer";let l=0;i.on("pointerdown",(()=>{l=Date.now()})),i.on("pointerup",(()=>{Date.now()-l<200&&t.previewItemBag(i,a)}));let o=t.createAnimationArray([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],.5,!1,"./assets/eff/6/");i.addChild(o),o.name="animation_run_ghep",o.width=2*m,o.height=2*w,o.x=.5*-m,o.y=.5*-w,o.visible=!1;let d=t.createAnimationArray([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21],.5,!1,"./assets/eff/9/");i.addChild(d),d.name="animation_success_ghep",d.width=2*m,d.height=2*w,d.x=.5*-m,d.y=.5*-w,d.visible=!1}}}y.addChild(i)}g.addChild(y),y.x=(g.width-y.width)/2,y.y=(g.height-y.height)/2;let f=new PIXI.Graphics;f.beginFill(0,.1),f.drawRect(0,0,c.width,.3*s.height),f.endFill(),f.y=c.height-f.height,c.addChild(f);let x=.3*f.width;x=x>100?100:x;let I=.5*f.height;I=I>50?50:I;let _=new PIXI.Graphics;_.beginFill(8810843,1),_.drawRect(0,0,x,I),_.lineStyle(1,16380627,3),_.endFill(),_.x=(f.width-_.width)/2,_.y=(f.height-_.height)/2,_.interactive=!0,_.keycode="int04",_.cursor="pointer",_.name="button_ghep_item";let b=0;_.on("pointerdown",(()=>{b=Date.now()})),_.on("pointerup",(()=>{Date.now()-b<200&&(e=>{let t=e.my;if(t.id<=0)return e.chipi(e._("Bạn chưa đăng nhập"));let i=e.cache.ghepItem.id;if(-1===i)return e.chipi(e._("Chưa tìm được vật phẩm cần ghép. Hãy bỏ thêm nguyên liệu"));let n=e.cache.ghep[i];if(!n)return e.chipi(e._("Không tìm thấy công thức ghép, hãy kiểm tra lại nguyên liệu"));let h=n[1];if(h){let i=t.tien,n=h[0],a=h[1];if(n&&n>i.beri)return e.chipi(e._("Bạn không đủ Bery để ghép vật phẩm này"));if(a&&a>i.ruby)return e.chipi(e._("Bạn không đủ Ruby để ghép vật phẩm này"))}let a=n[2],l=e.cache.ghepItem.data,o=!1,d=!1;if(a.length!==l.length)return e.chipi(e._("Danh sách nguyên liệu không hợp lệ."));let r=0;if(a.forEach((e=>{if(e){let i=e[0],n=e[1];l.forEach((e=>{let h=t.ruong.data.find((t=>t.id==e&&"hanhtrang"===t.active));h?h.item===i&&(r++,h.soluong<n&&(d=!0)):o=!0}))}})),r!==a.length)return e.chipi(e._("Danh sách nguyên liệu không hợp lệ."));if(o)return e.chipi(e._("Thiếu nguyên liệu để ghép vật phẩm này"));if(d)return e.chipi(e._("Thiếu số lượng nguyên liệu để ghép vật phẩm này"));e.send(-9,[2,i,l]);let s=e.findText("button_ghep_item");s&&(s.visible=!1),e.wait("Xin chờ...")})(t)})),f.addChild(_);let v=new PIXI.Text(t._("Hợp nhất"),{fontFamily:"Arial",fontSize:14,fill:16777215,align:"center"});v.anchor.set(.5),v.x=_.width/2,v.y=_.height/2,_.addChild(v),-1===t.cache.ghepItem.id&&(_.visible=!1);let C=new PIXI.Graphics;C.beginFill(0,.2),C.drawRect(0,0,.4*s.width,s.height),C.endFill(),C.x=s.width-C.width,s.addChild(C);let P=new PIXI.Container;if(-1!=t.cache.ghepItem.id){let e=t.cache.ghepItem.id,i=t.cache.ghep[e];if(i){let e=i[0];if(e){let n=e[0],h=e[1],a=(e[2],t.item.find((e=>e.id===n))),l=0;if(a){let e=xe(t,"Để ghép vật phẩm này cần:",C);e.y=l,P.addChild(e),l+=e.height+5;let n=i[1];if(n){let e=n[0],i=n[1];if(e&&e>=1){let i=xe(t,"- "+e+" Bery",C);i.y=l,P.addChild(i),l+=i.height+5}if(i&&i>=1){let e=xe(t,"- "+i+" Ruby",C);e.y=l,P.addChild(e),l+=e.height+5}}let a=i[2];if(a&&a.forEach((e=>{let i=e[0],n=e[1],h=(e[2],t.item.find((e=>e.id===i)));if(h){let e=xe(t,"- "+h.name+" x"+n,C);e.y=l,P.addChild(e),l+=e.height+5}})),h<100){let e=xe(t,"- "+h+"% tỉ lệ thành công",C);e.y=l,P.addChild(e),l+=e.height+5}}}}}else{let e=xe(t,"Lựa chọn các vật phẩm, sau đó bấm ghép để tiếp tục.",C);P.addChild(e)}P.x=(C.width-P.width)/2,P.y=(C.height-P.height)/2,t.maskPointDefault(C),t.viewPointDefault(C,P);let S=new PIXI.Graphics;S.beginFill(0,1e-7),S.drawRect(0,n.height-.4*n.height,n.width,.4*n.height),S.endFill(),n.addChild(S),S.y=.6*n.height;let X=new pixi_viewport.Viewport({screenWidth:S.width,screenHeight:S.height,worldWidth:h.width,worldHeight:h.height});X.name="viewport",X.drag({direction:"y",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),X.bounce({top:!0,bottom:!0,friction:.5,time:3.5,ease:"easeInOutSine"}),X.setZoom(1),X.addChild(h),S.addChild(X);let k=0,T=-1,F=-1,M=-1;X.on("pointerdown",(e=>{k=Date.now()})),X.on("pointerup",(e=>{if(Date.now()-k<200){let i=e.data.global.x,n=e.data.global.y,a=h.toLocal(new PIXI.Point(i,n));a.x=Math.round(a.x),a.y=Math.round(a.y);let l=h.children.filter((e=>"int04"==e.keycode));for(let e=0;e<l.length;e++)l[e].removeChild(l[e].getChildByName("xanhle"));for(let e=0;e<l.length;e++)if(l[e].x<=a.x&&a.x<=l[e].x+l[e].width&&l[e].y<=a.y&&a.y<=l[e].y+l[e].height){let i=l[e].width,n=l[e].height,h=new PIXI.Graphics;h.lineStyle(1,16777215,1),h.beginFill(16318026,1e-6),h.drawRoundedRect(0,0,i,n,0),h.endFill(),h.name="xanhle",l[e].addChild(h);let a=l[e],o=t.findInteractiveObjects(a);o.length>0&&(o[0].emit("pointerdown"),o[0].emit("pointerup")),F=e%r,M=Math.floor(e/r),T=e}}else clearInterval(t.pcSettimeEntactive),setTimeout((function(){clearInterval(t.pcSettimeEntactive),W()}),200)}));let W=()=>{t.pcSettimeEntactive&&clearInterval(t.pcSettimeEntactive),t.pcSettimeEntactive=setInterval((()=>{let e=t.pcKey;if(t.box.children.length<=0)return clearInterval(t.pcSettimeEntactive),!1;let i=h.children.filter((e=>"int04"==e.keycode));if("ArrowUp"==e?-1==M?M=0:M--:"ArrowDown"==e?-1==M?M=0:M++:"ArrowLeft"==e?-1==F?F=0:F--:"ArrowRight"==e&&(-1==F?F=0:F++),T=F>=0&&M>=0?M*r+F:F>=0&&-1==M?F:-1==F&&M>=0?M:-1,"Enter"==e&&T>=0){let e=i[T],n=t.findInteractiveObjects(e);n.length>0&&(n[0].emit("pointerdown"),n[0].emit("pointerup"))}if(i[T]&&t.pcKey.length>=1){for(let e=0;e<i.length;e++)i[e].removeChild(i[e].getChildByName("xanhle"));X.moveCenter(i[T].x,i[T].y);let e=i[T].width,n=i[T].height,h=new PIXI.Graphics;h.lineStyle(1,16777215,1),h.beginFill(16318026,1e-9),h.drawRoundedRect(0,0,e,n,0),h.endFill(),h.name="xanhle",i[T].addChild(h);let a=i[T],l=t.findInteractiveObjects(a);l.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{l[0].emit("pointerdown")})),h.on("pointerup",(()=>{l[0].emit("pointerup")})))}t.pcKey=""}),30)};W()}},_e=(e,t)=>{console.log("open"),Ie(e,t)},be=(e,t)=>{let i=e.my;if(i.id<=0)return e.chipi(e._("Bạn chưa đăng nhập"));let n=i.ruong,h=n.data.find((e=>e.id==t&&"hanhtrang"===e.active));if(!h)return e.chipi(e._("Không tìm thấy vật phẩm"));let a=e.item.find((e=>e.id==h.item));if(!a)return e.chipi(e._("Không tìm thấy vật phẩm"));if(ve(e,t))return e.cache.ghepItem.data=e.cache.ghepItem.data.filter((e=>e!==t)),e.ghep();let l=!1;return e.cache.ghepItem.data.forEach((e=>{let t=n.data.find((t=>t.id==e&&"hanhtrang"===t.active));t&&t.item===h.item&&(l=!0)})),l?e.chipi(e._("Đã có vật phẩm giống hết món này trong danh sách ghép")):(e.cache.ghepItem.data.push(t),e.ghep())},ve=(e,t)=>!!e.cache.ghepItem.data.find((e=>e===t)),Ce=(t,i)=>{t.backGroundBox(),e(t,[[9208,"shop","Nâng cấp",i,Xe],[9200,"hanhtrang","Hành trang",i,Ce]],"hanhtrang");let n=t.box.getChildByName("body"),h=new PIXI.Container;h.name="container";let a=new PIXI.Graphics;a.beginFill(0,.5),a.drawRect(0,0,n.width,n.height),a.endFill(),h.mask=a,n.addChild(a);let l=t.my.ruong.data.filter((e=>"hanhtrang"===e.active));if(l.sort(((e,t)=>e.time-t.time)),n){let e=t.my.ruong.max,i=.2*n.width;i=i>48?48:i;let a=i,o=2,d=2,r=Math.floor(n.width/(i+o));for(let n=0;n<e;n++){let e=new PIXI.Graphics;e.beginFill(11440233,.5),e.drawRect(0,0,i,a),e.endFill(),e.x=n%r*(i+o),e.y=Math.floor(n/r)*(a+d),e.interactive=!0,e.keycode="int04",e.cursor="pointer";let s=0;l[n]&&!t.cache.duclo.data.find((e=>e===l[n].id))&&(e.on("pointerdown",(()=>{s=Date.now()})),e.on("pointerup",(()=>{Date.now()-s<200&&t.previewItemBag(e,l[n],"btn_duclo")})),e=t.showItem(e,l[n])),h.addChild(e)}if(h.height<n.height){let e=n.height,t=n.width,i=new PIXI.Graphics;i.beginFill(0,5e-9),i.drawRect(0,0,t,e),i.endFill(),h.addChild(i)}let s=new pixi_viewport.Viewport({screenWidth:n.width,screenHeight:n.height,worldWidth:h.width,worldHeight:h.height});s.name="viewport",s.drag({direction:"y",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),s.bounce({top:!0,bottom:!0,friction:.5,time:3.5,ease:"easeInOutSine"}),s.setZoom(1),s.addChild(h),n.addChild(s);let c=0,g=-1,p=-1,m=-1;s.on("pointerdown",(e=>{c=Date.now()})),s.on("pointerup",(e=>{if(Date.now()-c<200){let i=e.data.global.x,n=e.data.global.y,a=h.toLocal(new PIXI.Point(i,n));a.x=Math.round(a.x),a.y=Math.round(a.y);let l=h.children.filter((e=>"int04"==e.keycode));for(let e=0;e<l.length;e++)l[e].removeChild(l[e].getChildByName("xanhle"));for(let e=0;e<l.length;e++)if(l[e].x<=a.x&&a.x<=l[e].x+l[e].width&&l[e].y<=a.y&&a.y<=l[e].y+l[e].height){let i=l[e].width,n=l[e].height,h=new PIXI.Graphics;h.lineStyle(1,16777215,1),h.beginFill(16318026,1e-6),h.drawRoundedRect(0,0,i,n,0),h.endFill(),h.name="xanhle",l[e].addChild(h);let a=l[e],o=t.findInteractiveObjects(a);o.length>0&&(o[0].emit("pointerdown"),o[0].emit("pointerup")),p=e%r,m=Math.floor(e/r),g=e}}else clearInterval(t.pcSettimeEntactive),setTimeout((function(){clearInterval(t.pcSettimeEntactive),w()}),200)}));let w=()=>{t.pcSettimeEntactive&&clearInterval(t.pcSettimeEntactive),t.pcSettimeEntactive=setInterval((()=>{let e=t.pcKey;if(t.box.children.length<=0)return clearInterval(t.pcSettimeEntactive),!1;let i=h.children.filter((e=>"int04"==e.keycode));if("ArrowUp"==e?-1==m?m=0:m--:"ArrowDown"==e?-1==m?m=0:m++:"ArrowLeft"==e?-1==p?p=0:p--:"ArrowRight"==e&&(-1==p?p=0:p++),g=p>=0&&m>=0?m*r+p:p>=0&&-1==m?p:-1==p&&m>=0?m:-1,"Enter"==e&&g>=0){let e=i[g],n=t.findInteractiveObjects(e);n.length>0&&(n[0].emit("pointerdown"),n[0].emit("pointerup"))}if(i[g]&&t.pcKey.length>=1){for(let e=0;e<i.length;e++)i[e].removeChild(i[e].getChildByName("xanhle"));s.moveCenter(i[g].x,i[g].y);let e=i[g].width,n=i[g].height,h=new PIXI.Graphics;h.lineStyle(1,16777215,1),h.beginFill(16318026,1e-9),h.drawRoundedRect(0,0,e,n,0),h.endFill(),h.name="xanhle",i[g].addChild(h);let a=i[g],l=t.findInteractiveObjects(a);l.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{l[0].emit("pointerdown")})),h.on("pointerup",(()=>{l[0].emit("pointerup")})))}t.pcKey=""}),30)};w()}},Pe=(e,t,i)=>new PIXI.Text(e._(t),{fontFamily:"Arial",fontSize:14,fill:16777215,align:"center",wordWrap:!0,wordWrapWidth:.9*i.width,breakWords:!0,whiteSpace:"normal"}),Se=(t,i)=>{(e=>{e.cache.duclo.data.forEach((t=>{let i=e.my.ruong.data.find((e=>e.id===t&&"hanhtrang"===e.active));if(i){let n=e.item.find((e=>e.id==i.item));n?"item"===n.type&&i.soluong<=0&&(e.cache.duclo.data=e.cache.duclo.data.filter((e=>e!==t))):e.cache.duclo.data=e.cache.duclo.data.filter((e=>e!==t))}else e.cache.duclo.data=e.cache.duclo.data.filter((e=>e!==t))}));let t=e.cache.duclo.id;if(0!==t){let i=e.my.ruong.data.find((e=>e.id===t&&"hanhtrang"===e.active));i||(e.cache.duclo.id=0,e.cache.duclo.data=[])}})(t),t.box.removeChildren(),t.backGroundBox(),e(t,[[9208,"shop","Đục lỗ",i,Se],[9200,"hanhtrang","Hành trang",i,Ce]],"shop");let n=t.box.getChildByName("body"),h=new PIXI.Container;h.name="container";let a=t.my,l=[],o=t.cache.duclo.data;if(o&&o.length>=1&&o.forEach((e=>{let t=a.ruong.data.find((t=>t.id===e&&"hanhtrang"===t.active));t&&l.push(t)})),n){let e=l.length+10,i=.2*n.width;i=i>48?48:i;let o=i,d=2,r=2,s=Math.floor(n.width/(i+d));for(let n=0;n<e;n++){let e=new PIXI.Graphics;e.beginFill(11440233,.5),e.drawRect(0,0,i,o),e.endFill(),e.x=n%s*(i+d),e.y=Math.floor(n/s)*(o+r),e.interactive=!0,e.keycode="int04",e.cursor="pointer";let a=0;l[n]&&(e.on("pointerdown",(()=>{a=Date.now()})),e.on("pointerup",(()=>{Date.now()-a<200&&t.previewItemBag(e,l[n],"btn_nangcap")})),e=t.showItem(e,l[n]),e.name="o_nguyen_lieu_"+l[n].id),h.addChild(e)}let c=new PIXI.Graphics;c.beginFill(0,.05),c.drawRect(0,0,n.width,.6*n.height),c.endFill(),n.addChild(c);let g=new PIXI.Graphics;g.beginFill(0,5e-12),g.drawRect(0,0,.6*c.width,c.height),g.endFill(),c.addChild(g);let p=new PIXI.Graphics;p.beginFill(0,2e-8),p.drawRect(0,0,g.width,.7*c.height),p.endFill(),g.addChild(p);let m=2,w=.2*p.width;w=w>48?48:w;let u=w,y=15,f=new PIXI.Container;for(let e=0;e<m;e++){let i=new PIXI.Graphics;i.beginFill(11440233,.5),i.drawRect(0,0,w,u),i.endFill(),i.x=y+e*(w+y),i.y=0;let n=t.cache.duclo.id;if(n){let h=!1,l=a.ruong.data.find((e=>e.id===n&&"hanhtrang"===e.active)),o=l;if(l){let n=t.item.find((e=>e.id==l.item));if(!n||n&&"trangbi"!==n.type);else if(0===e)i=t.showItem(i,l),h=!0,o=l;else{let e=(o.lo||[]).filter((e=>-1===e)).length,n=t.config.duclo[e];if(n&&-1!==n){let e=JSON.parse(JSON.stringify(o));e.lo=e.lo||[];for(let t=0;t<e.lo.length;t++)if(-1===e.lo[t]){e.lo[t]=0;break}i=t.showItem(i,e),h=!0,o=e;let n=t.createAnimationArray([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],.5,!1,"./assets/eff/6/");i.addChild(n),n.name="animation_run_nangcap",n.width=2*w,n.height=2*u,n.x=.5*-w,n.y=.5*-u,n.visible=!1;let a=t.createAnimationArray([1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21],.5,!1,"./assets/eff/9/");i.addChild(a),a.name="animation_success_nangcap",a.width=2*w,a.height=2*u,a.x=.5*-w,a.y=.5*-u,a.visible=!1}}}if(!0===h){i.interactive=!0,i.cursor="pointer";let e=0;i.on("pointerdown",(()=>{e=Date.now()})),i.on("pointerup",(()=>{Date.now()-e<200&&t.previewItemBag(i,o,"btn_duclo")}))}i.name="o_nangcap_"+e}f.addChild(i)}p.addChild(f),f.x=(p.width-f.width)/2,f.y=(p.height-f.height)/2;let x=new PIXI.Graphics;x.beginFill(0,.1),x.drawRect(0,0,g.width,.3*c.height),x.endFill(),x.y=g.height-x.height,g.addChild(x);let I=.3*x.width;I=I>100?100:I;let _=.5*x.height;_=_>50?50:_;let b=new PIXI.Graphics;b.beginFill(8810843,1),b.drawRect(0,0,I,_),b.lineStyle(1,16380627,3),b.endFill(),b.x=(x.width-b.width)/2,b.y=(x.height-b.height)/2,b.interactive=!0,b.keycode="int04",b.cursor="pointer",b.name="button_nangcap_item";let v=0;b.on("pointerdown",(()=>{v=Date.now()})),b.on("pointerup",(()=>{Date.now()-v<200&&(e=>{let t=e.my;if(t.id<=0)return e.chipi(e._("Bạn chưa đăng nhập"));let i=e.cache.duclo.id;if(!i)return e.chipi(e._("Bạn chưa chọn trang bị"));let n=t.ruong.data.find((e=>e.id==i&&"hanhtrang"===e.active));if(!n)return e.chipi(e._("Không tìm thấy trang bị"));let h=e.item.find((e=>e.id==n.item));if(!h)return e.chipi(e._("Không tìm thấy trang bị"));if("trangbi"!==h.type)return e.chipi(e._("Không phải trang bị"));if(e.cache.duclo.data.length>2)return e.chipi(e._("Để đục lỗ chỉ được chọn 2 vật phẩm"));let a=(n.lo||[]).filter((e=>-1===e)).length;if(a<=0)return e.chipi(e._("Trang bị này đã đục lỗ hết rồi"));let l=e.config.duclo[a];if(t.tien.ruby<l)return e.chipi(e._("Bạn không đủ ruby để đục lỗ"));let o=!1,d=!1;e.cache.duclo.data.forEach((i=>{let n=t.ruong.data.find((e=>e.id==i&&"hanhtrang"===e.active));if(n){let t=e.item.find((e=>e.id==n.item));t?"item"===t.type&&"duclo"!==t.type2&&(o=!0):d=!0}else d=!0})),o?e.chipi(e._("Không có vật phẩm búa đục")):d?e.chipi(e._("Không có vật phẩm này để đục")):(e.send(-9,[3,i,e.cache.duclo.data]),e.wait("Xin chờ..."))})(t)})),x.addChild(b);let C=new PIXI.Text(t._("Đục ngay"),{fontFamily:"Arial",fontSize:14,fill:16777215,align:"center"});C.anchor.set(.5),C.x=b.width/2,C.y=b.height/2,b.addChild(C);let P=new PIXI.Graphics;P.beginFill(0,.2),P.drawRect(0,0,.4*c.width,c.height),P.endFill(),P.x=c.width-P.width,c.addChild(P);let S=new PIXI.Container;if(t.cache.duclo.id){let e=a.ruong.data.find((e=>e.id===t.cache.duclo.id&&"hanhtrang"===e.active));if(e){e.level,t.config.nangcap;let i=(e.lo||[]).filter((e=>-1===e)).length,n=t.config.duclo[i];if(n&&-1!==n){let e=Pe(t,"Để đục thêm 1 lỗ cho trang bị này cần: ",P);S.addChild(e);let i=Pe(t,"- "+n+" ruby",P);i.y=e.y+e.height+5,S.addChild(i);let h=Pe(t,"- 1 búa đục lỗ",P);h.y=i.y+i.height+5,S.addChild(h)}else{let e=Pe(t,"Vật phẩm này đã có đủ lỗ.",P);S.addChild(e)}}}else{let e=Pe(t,"Lựa chọn vật phẩm cần đục lỗ, sau đó chọn búa để tiến hành đục.",P);S.addChild(e)}S.x=(P.width-S.width)/2,S.y=(P.height-S.height)/2,t.maskPointDefault(P),t.viewPointDefault(P,S);let X=new PIXI.Graphics;X.beginFill(0,1e-7),X.drawRect(0,n.height-.4*n.height,n.width,.4*n.height),X.endFill(),n.addChild(X),X.y=.6*n.height;let k=new pixi_viewport.Viewport({screenWidth:X.width,screenHeight:X.height,worldWidth:h.width,worldHeight:h.height});k.name="viewport",k.drag({direction:"y",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}),k.bounce({top:!0,bottom:!0,friction:.5,time:3.5,ease:"easeInOutSine"}),k.setZoom(1),k.addChild(h),X.addChild(k);let T=0,F=-1,M=-1,W=-1;k.on("pointerdown",(e=>{T=Date.now()})),k.on("pointerup",(e=>{if(Date.now()-T<200){let i=e.data.global.x,n=e.data.global.y,a=h.toLocal(new PIXI.Point(i,n));a.x=Math.round(a.x),a.y=Math.round(a.y);let l=h.children.filter((e=>"int04"==e.keycode));for(let e=0;e<l.length;e++)l[e].removeChild(l[e].getChildByName("xanhle"));for(let e=0;e<l.length;e++)if(l[e].x<=a.x&&a.x<=l[e].x+l[e].width&&l[e].y<=a.y&&a.y<=l[e].y+l[e].height){let i=l[e].width,n=l[e].height,h=new PIXI.Graphics;h.lineStyle(1,16777215,1),h.beginFill(16318026,1e-6),h.drawRoundedRect(0,0,i,n,0),h.endFill(),h.name="xanhle",l[e].addChild(h);let a=l[e],o=t.findInteractiveObjects(a);o.length>0&&(o[0].emit("pointerdown"),o[0].emit("pointerup")),M=e%s,W=Math.floor(e/s),F=e}}else clearInterval(t.pcSettimeEntactive),setTimeout((function(){clearInterval(t.pcSettimeEntactive),E()}),200)}));let E=()=>{t.pcSettimeEntactive&&clearInterval(t.pcSettimeEntactive),t.pcSettimeEntactive=setInterval((()=>{let e=t.pcKey;if(t.box.children.length<=0)return clearInterval(t.pcSettimeEntactive),!1;let i=h.children.filter((e=>"int04"==e.keycode));if("ArrowUp"==e?-1==W?W=0:W--:"ArrowDown"==e?-1==W?W=0:W++:"ArrowLeft"==e?-1==M?M=0:M--:"ArrowRight"==e&&(-1==M?M=0:M++),F=M>=0&&W>=0?W*s+M:M>=0&&-1==W?M:-1==M&&W>=0?W:-1,"Enter"==e&&F>=0){let e=i[F],n=t.findInteractiveObjects(e);n.length>0&&(n[0].emit("pointerdown"),n[0].emit("pointerup"))}if(i[F]&&t.pcKey.length>=1){for(let e=0;e<i.length;e++)i[e].removeChild(i[e].getChildByName("xanhle"));k.moveCenter(i[F].x,i[F].y);let e=i[F].width,n=i[F].height,h=new PIXI.Graphics;h.lineStyle(1,16777215,1),h.beginFill(16318026,1e-9),h.drawRoundedRect(0,0,e,n,0),h.endFill(),h.name="xanhle",i[F].addChild(h);let a=i[F],l=t.findInteractiveObjects(a);l.length>0&&(h.interactive=!0,h.cursor="pointer",h.on("pointerdown",(()=>{l[0].emit("pointerdown")})),h.on("pointerup",(()=>{l[0].emit("pointerup")})))}t.pcKey=""}),30)};E()}},Xe=(e,t)=>{console.log("open"),Se(e,t)},ke=(e,t)=>{let i=e.my;if(i.id<=0)return e.chipi(e._("Bạn chưa đăng nhập"));let n=i.ruong.data.find((e=>e.id==t&&"hanhtrang"===e.active));if(!n)return e.chipi(e._("Không tìm thấy vật phẩm"));let h=e.item.find((e=>e.id==n.item));if(!h)return e.chipi(e._("Không tìm thấy vật phẩm"));if("trangbi"===h.type&&0!==e.cache.duclo.id&&(e.cache.duclo.data=e.cache.duclo.data.filter((t=>t!==e.cache.duclo.id)),e.cache.duclo.id=0),Te(e,t))return"trangbi"===h.type&&(e.cache.duclo.id=0),e.cache.duclo.data=e.cache.duclo.data.filter((e=>e!==t)),e.duclo();if("item"===h.type&&"duclo"!==h.type2)return e.chipi(e._("Vật phẩm này không thể nâng cấp"));let a=!1;return e.cache.duclo.data.forEach((n=>{let l=i.ruong.data.find((e=>e.id==n&&"hanhtrang"===e.active));if(l){let i=e.item.find((e=>e.id==l.item));n!==t&&"item"===h.type&&i&&"item"===i.type&&i.type2===h.type2&&(a=!0)}})),a?e.chipi(e._("Không thể chọn 2 vật phẩm cùng loại với nhau")):("trangbi"===h.type&&(e.cache.duclo.id=t),e.cache.duclo.data.push(t),e.duclo())},Te=(e,t)=>!!e.cache.duclo.data.find((e=>e===t));class Fe extends se{constructor(){super(),this.cache.nangcap={id:"9A18H0AGyUM",data:["9A18H0AGyUM","QacK1XfXQCg"]},this.cache.ghepItem={id:-1,data:["RbIVgI4LLOv","MfgGm6jC4Hz"]},this.cache.duclo={id:"Ri84N6pRddU",data:["jMxnQcXl2Nk","Ri84N6pRddU"]}}duclo=(e=0)=>("a"===e&&(this.cache.duclo.data=[],this.cache.duclo.id=0),Xe(this,"int04"));btn_duclo=e=>((e,t)=>{let i=new PIXI.Container,n=e.preItem,h=.3*n.width,a=.3*n.height;h=h>70?70:h,a=a>50?50:a;let l=[],o=e.my;if(o.id<=0)return e.chipi(e._("Bạn chưa đăng nhập"));let d=o.ruong.data.find((e=>e.id==t&&"hanhtrang"===e.active));if(!d)return!1;let r=e.item.find((e=>e.id==d.item));return r?(l=Te(e,t)?[["Bỏ ra",ke,1],["Đóng"]]:[["Chọn",ke,2],["Đóng"]],l.forEach(((n,l)=>{let o=new PIXI.Graphics;o.interactive=!0,o.beginFill(8810843,1),o.lineStyle(2,16380627,1),o.drawRoundedRect(0,0,h,a,5),o.endFill(),o.name=n[1],o.x=l*(h+5),o.y=0,i.addChild(o);let d=new PIXI.Text(e._(n[0]),{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:o.width});o.addChild(d),d.x=(o.width-d.width)/2,d.y=(o.height-d.height)/2;let r=0;o.on("pointerdown",(()=>{r=Date.now()})),o.on("pointerup",(()=>{Date.now()-r<300&&(n[1]&&n[1](e,t,n[2]),e.preItem.removeChildren())}))})),i.y=n.height,i):e.chipi(e._("Không tìm thấy vật phẩm"))})(this,e);nangcap=(e=0)=>("a"===e&&(this.cache.nangcap.data=[],this.cache.nangcap.id=0),we(this,"int04"));ghep=(e=0)=>("a"===e&&(this.cache.ghepItem.data=[],this.cache.ghepItem.id=-1),_e(this,"int04"));btn_ghep=e=>((e,t)=>{let i=new PIXI.Container,n=e.preItem,h=.3*n.width,a=.3*n.height;h=h>70?70:h,a=a>50?50:a;let l=[],o=e.my;if(o.id<=0)return e.chipi(e._("Bạn chưa đăng nhập"));let d=o.ruong.data.find((e=>e.id==t&&"hanhtrang"===e.active));if(!d)return!1;let r=e.item.find((e=>e.id==d.item));return r?(l=ve(e,t)?[["Bỏ ra",be,1],["Đóng"]]:[["Chọn",be,2],["Đóng"]],l.forEach(((n,l)=>{let o=new PIXI.Graphics;o.interactive=!0,o.beginFill(8810843,1),o.lineStyle(2,16380627,1),o.drawRoundedRect(0,0,h,a,5),o.endFill(),o.name=n[1],o.x=l*(h+5),o.y=0,i.addChild(o);let d=new PIXI.Text(e._(n[0]),{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:o.width});o.addChild(d),d.x=(o.width-d.width)/2,d.y=(o.height-d.height)/2;let r=0;o.on("pointerdown",(()=>{r=Date.now()})),o.on("pointerup",(()=>{Date.now()-r<300&&(n[1]&&n[1](e,t,n[2]),e.preItem.removeChildren())}))})),i.y=n.height,i):e.chipi(e._("Không tìm thấy vật phẩm"))})(this,e);btn_nangcap=e=>((e,t)=>{let i=new PIXI.Container,n=e.preItem,h=.3*n.width,a=.3*n.height;h=h>70?70:h,a=a>50?50:a;let l=[],o=e.my;if(o.id<=0)return e.chipi(e._("Bạn chưa đăng nhập"));let d=o.ruong.data.find((e=>e.id==t&&"hanhtrang"===e.active));if(!d)return!1;let r=e.item.find((e=>e.id==d.item));return r?(l=ye(e,t)?[["Bỏ ra",ue,1],["Đóng"]]:[["Chọn",ue,2],["Đóng"]],l.forEach(((n,l)=>{let o=new PIXI.Graphics;o.interactive=!0,o.beginFill(8810843,1),o.lineStyle(2,16380627,1),o.drawRoundedRect(0,0,h,a,5),o.endFill(),o.name=n[1],o.x=l*(h+5),o.y=0,i.addChild(o);let d=new PIXI.Text(e._(n[0]),{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:o.width});o.addChild(d),d.x=(o.width-d.width)/2,d.y=(o.height-d.height)/2;let r=0;o.on("pointerdown",(()=>{r=Date.now()})),o.on("pointerup",(()=>{Date.now()-r<300&&(n[1]&&n[1](e,t,n[2]),e.preItem.removeChildren())}))})),i.y=n.height,i):e.chipi(e._("Không tìm thấy vật phẩm"))})(this,e);test_nangcap=()=>{ge(this)}}class Me extends Fe{constructor(){super(),this.cache.idShop=[],this.cache.costShop=[]}boxshop=e=>{n(this,e)};btn_shop=e=>((e,t)=>{let i=new PIXI.Container,n=e.preItem,l=.3*n.width,o=.3*n.height;l=l>70?70:l,o=o>50?50:o;let d=[],r=e.item.find((e=>e.id==t));return r?(d="trangbi"===r.type?[["Mua",h,1],["Đóng"]]:[["Mua x1",h,1],["Mua x10",h,10],["Mua x50",h,50],["Số lượng",a,null],["Đóng"]],d.forEach(((n,h)=>{let a=new PIXI.Graphics;a.interactive=!0,a.beginFill(8810843,1),a.lineStyle(2,16380627,1),a.drawRoundedRect(0,0,l,o,5),a.endFill(),a.name=n[1],a.x=h*(l+5),a.y=0,i.addChild(a);let d=new PIXI.Text(e._(n[0]),{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:a.width});a.addChild(d),d.x=(a.width-d.width)/2,d.y=(a.height-d.height)/2;let r=0;a.on("pointerdown",(()=>{r=Date.now()})),a.on("pointerup",(()=>{Date.now()-r<300&&(n[1]&&n[1](e,t,n[2]),e.preItem.removeChildren())}))})),i.y=n.height,i):e.chipi(e._("Không tìm thấy vật phẩm"))})(this,e);btnShopSell=e=>((e,t)=>{let i=new PIXI.Container,n=e.preItem,h=.3*n.width,a=.3*n.height;h=h>70?70:h,a=a>50?50:a;let o=[],d=e.my;if(d.id<=0)return e.chipi(e._("Bạn chưa đăng nhập"));let r=d.ruong.data.find((e=>e.id==t&&"hanhtrang"==e.active));if(!r)return!1;let s=e.item.find((e=>e.id==r.item));return s?(o="trangbi"===s.type?[["Bán",l,1],["Đóng"]]:[["bán 1",l,1],["bán 10",l,10],["bán hết",l,-999],["Đóng"]],o.forEach(((n,l)=>{let o=new PIXI.Graphics;o.interactive=!0,o.beginFill(8810843,1),o.lineStyle(2,16380627,1),o.drawRoundedRect(0,0,h,a,5),o.endFill(),o.name=n[1],o.x=l*(h+5),o.y=0,i.addChild(o);let d=new PIXI.Text(e._(n[0]),{fontFamily:"Arial",fontSize:15,fill:16777215,align:"center",fontWeight:"bold",wordWrap:!0,wordWrapWidth:o.width});o.addChild(d),d.x=(o.width-d.width)/2,d.y=(o.height-d.height)/2;let r=0;o.on("pointerdown",(()=>{r=Date.now()})),o.on("pointerup",(()=>{Date.now()-r<300&&(n[1]&&n[1](e,t,n[2]),e.preItem.removeChildren())}))})),i.y=n.height,i):e.chipi(e._("Không tìm thấy vật phẩm"))})(this,e)}class We extends Me{constructor(){super()}closeGiaoTiep=()=>(this.deleteAllChild(this.boxGiaoTiep,!1),!1);giaoTiep=e=>{if(!e)return!1;if(this.boxGiaoTiep.children.length>0)return!1;this.boxGiaoTiep.removeChildren();let t=new PIXI.Graphics;t.beginFill(0,1e-6),t.drawRect(0,0,this.gameWidth,this.gameHeight),t.endFill(),this.boxGiaoTiep.addChild(t),t.interactive=!0,t.name="backgound";let i=.3*this.gameHeight,n=.9*this.gameWidth;i=i>150?150:i,n=n>500?500:n;let h=new PIXI.Graphics;h.beginFill(8744014,1),h.lineStyle(2.5,6966058,1),h.drawRect(0,0,n,i),h.endFill(),h.x=(this.gameWidth-n)/2,h.y=.8*this.gameHeight-i,t.addChild(h),h.interactive=!0,h.name="khung",h.alpha=0;let a=new PIXI.Text(e.name,{fontFamily:"Arial",fontSize:16,fill:"white",align:"left"}),l=new PIXI.Graphics,o=a.width+30,d=a.height+10;l.beginFill(8744014,1),l.lineStyle(1,6966058,1),l.drawRect(0,0,o,d),l.endFill(),l.name="namenpc",l.x=this.gameWidth,l.y=h.y-l.height-3;let r=new PIXI.Text(e.name,{fontFamily:"Arial",fontSize:16,fill:16514363,align:"left"});r.x=l.width/2-r.width/2,r.y=l.height/2-r.height/2,l.addChild(r),t.addChild(l),new TWEEN.Tween(l).to({x:h.x},200).easing(TWEEN.Easing.Back.InOut).start().onComplete((i=>{let a="",l=e.giaotiep,o=this.rand(0,l.length-1);a=l[o],new TWEEN.Tween(h).to({alpha:1},500).start().onComplete((()=>{let e=new PIXI.Text(a,{fontFamily:"Arial",fontSize:16,fill:"white",align:"left",wordWrap:!0,wordWrapWidth:n-20});e.x=h.x+h.width/2-e.width/2,e.y=h.y+10;let i=new PIXI.Text("",{fontFamily:"Arial",fontSize:16,fill:"white",align:"left",wordWrap:!0,wordWrapWidth:n-20});i.x=h.x+h.width/2-e.width/2,i.y=h.y+10,t.addChild(i),i.name="textGiaoTiep2";let l=0,o="",d=(this.app.ticker.FPS,a.length,0),r=setInterval((()=>{0==this.boxGiaoTiep.children.length&&clearInterval(r),l<a.length?(o+=a[l],i.text=o,l++):(clearInterval(r),d=1)}),25);h.on("pointerdown",(()=>{1!=d&&(clearInterval(r),i.text=a,d=1)}))})),(()=>{let i=[];e.event&&e.event.forEach((e=>{i.push(e)})),i.push(["Đóng","close"]);let n=.2*this.gameWidth,a=.2*this.gameHeight;n=n>100?100:n,a=a>60?60:a;let l=new PIXI.Graphics;l.beginFill(0,1e-7),l.name="button",l.drawRect(0,0,h.width,a),l.endFill(),t.addChild(l);let o=this.mask(l,l);i.forEach(((e,t)=>{let i=new PIXI.Graphics;i.beginFill(8744014,1),i.lineStyle(2.5,6966058,1),i.drawRect(0,0,n,a),i.endFill(),i.x=t*(n+10),o.addChild(i),i.keycode="int04";let h=new PIXI.Text(e[0],{fontFamily:"Arial",fontSize:16,fill:"white",align:"center",wordWrap:!0,wordWrapWidth:n-10});h.x=i.width/2-h.width/2,h.y=i.height/2-h.height/2,i.addChild(h),i.interactive=!0,i.cursor="pointer";let l=0;i.on("pointerdown",(()=>{l=Date.now()})),i.on("pointerup",(()=>{Date.now()-l<200&&("close"===e[1]?this.closeGiaoTiep():"element"===e[1]?this.openShowMenu(e[0],e[2]):this[e[1]](void 0!==e[2]?e[2]:[]))}))})),l.addChild(this.intX(l,o)),l.x=0-this.gameWidth,l.y=h.y+h.height+5,l.y+l.height>this.gameHeight&&(l.y-=l.y+h.height-this.gameHeight),new TWEEN.Tween(l).to({x:h.x+h.width/2-l.width/2},500).easing(TWEEN.Easing.Back.InOut).start().onComplete((()=>{}))})()}))}}class Ee extends We{constructor(){super()}testSprite=()=>{this.test("xt3",this.click)};interPress=(e=0)=>{let t=this.click;if(this.my.id<=0)return!1;if(!1===this.isAttack(this.my.eff))return!1;let i=this.my;if(null!=this.click){let e=this.getMy(t);if("npc"==e.type)return this.giaoTiep(e)}let n="",h=this.getMy(t);h&&(n=h.type);let a=i.oskill[e];if(a&&-1!=a){let e=a,t=i.skill.find((t=>t[0]==e));if(t){let a=t[2];if(t[1],a>=Date.now())return!1;let l=this.skill.find((t=>t.id==e));if(!l)return!1;let o=l.type;if("bidong"==o)return!1;if(Math.round(l.mp+l.mp/100*t[1])>i.info.chiso.mp)return!1;if("tancong"==o&&(!this.click||!h||h.info.chiso.hp<=0))return!1;this.send(-6,[2,l.id,this.click,n])}else this.use_item(e)}}}class Re extends Ee{constructor(){super(),this.keypress={},this.created_key()}created_key=()=>{addEventListener("keydown",(e=>{this.keypress[e.keyCode]=!0,13===e.keyCode&&this.interPress()})),addEventListener("keyup",(e=>{let t=e.keyCode;113===t&&(e.preventDefault(),this.changeClick()),32===t&&this.testSprite(),82===t&&this.inputChatZone();let i=e.key;if(this.pcKey=i,(38===e.keyCode||40===e.keyCode||37===e.keyCode||39===e.keyCode)&&this.my.id>=1){this.action(this.my.id,"dungyen");let e=this.getSprite(this.my.id);e&&this.updateMoveToSocket(e.x,e.y)}if(this.keypress[e.keyCode]=!1,null!==this.pointer)return((e,t)=>{if(null!==e.pointer&&"menuleft"===e.pointer)return((e,t)=>{let i=e.getPointer(e.pointer);if(!i)return e.pointer=null,!1;let n=i.getChildByName("hienthinoidung");if(!n)return e.pointer=null,!1;let h=n.children.filter((e=>"int04"===e.keycode)),a=i.pages;if(38===t?(a-=1,a<0&&(a=h.length-1)):40===t&&(a+=1,a>=h.length&&(a=0)),13===t){let t=h[a],i=e.getAllInteractiveChildren(t);i.length>0&&(i[0].emit("pointerdown"),i[0].emit("pointerup"))}if(h[a]){for(let e=0;e<h.length;e++){let t=h[e].getChildByName("icon");t&&t.gotoAndStop(0)}let e=h[a].getChildByName("icon");e&&e.gotoAndStop(1)}i.pages=a})(e,t)})(this,e.keyCode)}))}}class Ge extends Re{constructor(){super()}create_chat_thong_bao=(e="trò chơi dành cho người trên 12 tuổi. Chơi quá 180 phút một ngày sẽ có hại cho sức khỏe.")=>{let t=this.button.getChildByName("chat_thong_bao");if(t){let i=this.gameWidth,n=.3*this.gameHeight;n=n>30?30:n;let h=new PIXI.Graphics;h.beginFill(0,.7),h.drawRect(0,0,i,n),h.endFill(),h.name="data",t.addChild(h),t.visible=!0,t.x=0,t.y=this.gameHeight-n;let a=new PIXI.Graphics;a.beginFill(0,.7),a.drawRect(0,0,i,n),a.endFill(),a.name="mask",t.addChild(a),t.mask=a;let l=new PIXI.Text(e,{fontFamily:"Arial",fontSize:16,fill:16777215,align:"center"});l.x=t.width,l.y=h.height/2-l.height/2,l.name="text",h.addChild(l)}};create_chat_the_gioi=(e={},t="admin",i="Trò chơi dành cho người trên 12 tuổi, chơi quá 180 phút một ngày sẽ có hại cho sức khỏe.")=>{let n=.5*this.gameWidth,h=this.button.getChildByName("player_mmo");if(h){h.width;let a=h.height,l=.5*this.gameWidth,o=.5*this.gameHeight;o-=a;let d=this.button.getChildByName("chat_the_gioi");if(d){d.visible=!0;let h=1*o,r=1*l;r=r>350?350:r,h=h>100?100:h;let s=new PIXI.Graphics;s.beginFill(0,.5),s.drawRect(0,0,r,h),s.endFill(),s.name="data";let c=.3*s.width,g=1*s.height;c=c>60?60:c;let p=new PIXI.Graphics;p.beginFill(0,5e-15),p.drawRect(0,0,c,g),p.endFill(),p.x=0,p.y=s.height/2-p.height/2,s.addChild(p);let m=this.create_sprite_ctg(e);m.scale.x=-1,m.x=p.width/2-m.width/2,p.addChild(m);let w=new PIXI.Text(t+":",{fontFamily:"Arial",fontSize:14,fill:16777215,align:"center"});w.x=p.width+5,w.y=0,s.addChild(w);let u=s.height-w.height;u*=.5;let y=new PIXI.Graphics;y.name="backgorund_text",y.beginFill(0,5e-13),y.lineStyle(1,16777215,1),y.drawRect(0,0,s.width-p.width-5,u),y.endFill(),y.x=p.width+5,y.y=(p.height-w.height)/2-w.height/2,s.addChild(y);let f=new PIXI.Graphics;f.beginFill(0,.5),f.drawRect(0,0,s.width-p.width-5,u),f.endFill(),f.x=p.width+5,f.y=(p.height-w.height)/2-w.height/2,s.addChild(f),y.mask=f;let x=new PIXI.Text(i,{fontFamily:"Arial",fontSize:14,fill:16777215,align:"center"});x.x=y.width,x.name="txt",x.y=y.height/2-x.height/2,y.addChild(x),d.x=n+l-r-3,d.y=0+a+5,d.addChild(s)}}}}class Be extends Ge{constructor(){super()}created_top_right_view_info_player=(e,t)=>{let i=e,n=new PIXI.Graphics;n.beginFill(0,0),n.drawRect(0,0,e,t),n.endFill(),n.x=i,n.y=0,this.button.addChild(n);let h=.8*e,a=.3*t;h=h>150?150:h,a=a>50?50:a;let l=new PIXI.Graphics;l.beginFill(0,.5),l.drawRect(0,0,h,a),l.endFill(),l.x=i+e-h-10,l.y=0,this.button.addChild(l),l.name="player_mmo";let o=new PIXI.Text("Name: ",{fontFamily:"Arial",fontSize:14,fill:55337,align:"center"});o.x=l.width/2-o.width/2,o.y=l.y+10,l.addChild(o),o.name="name_player";let d=new PIXI.Text("HP: ",{fontFamily:"Arial",fontSize:14,fill:16777215,align:"center"});d.x=l.width/2-d.width/2,d.y=o.y+o.height,l.addChild(d),d.name="hp_player";let r=new PIXI.Container;r.name="chat_the_gioi",r.visible=!1,this.button.addChild(r);let s=new PIXI.Container;s.name="chat_thong_bao",s.visible=!1,this.button.addChild(s)}}class Ae extends Be{constructor(){super()}createButtonright=(e,t)=>{let i={width:e,height:t,x:e,y:this.gameHeight-t},n=new PIXI.Container;n.name="oskill1";let h=new PIXI.Container;h.name="oskill2",this.button.addChild(n),this.button.addChild(h);let a=i.width,l=e/7;l=l>=30?30:l;const o=l+2,d=i.width/2,r=i.height/2;let s=e=>{let t=e;e.interactive=!0,e.cursor="grab";let i=0;e.on("pointerdown",(t=>{i=(new Date).getTime(),e.cursor="grabbing"})),e.on("pointerup",(n=>{(new Date).getTime()-i<200&&this.interPress(t.o),e.cursor="grab"}))};for(let e=-1;e<4;e++){let t=new PIXI.Graphics;if(t.name="id_"+(e+1),t.beginFill(1052688,1e-6),t.lineStyle(3,10575126,1),-1==e)t.drawCircle(0,0,l),t.endFill(),t.x=d,t.y=r;else{const i=e/4*Math.PI*2;t.drawCircle(d+(l+o)*Math.cos(i),r+(l+o)*Math.sin(i),l),t.endFill()}let i=t.getBounds(),h=new PIXI.Sprite(this.coverImg("4000"));h.width=.85*i.width,h.height=.85*i.height,h.x=i.x+(i.width-h.width)/2,h.y=i.y+(i.height-h.height)/2,h.visible=!0,h.name="skill_"+(e+1),h.o=e+1,s(h),n.addChild(t),n.addChild(h);let a=new PIXI.Text("Q",{fontFamily:"Arial",fontSize:24,fill:16777215,align:"center"});a.x=i.x-a.width/2+i.width/2,a.y=i.y-a.height/2+i.height/2,a.visible=!0,a.name="txt_"+(e+1),a.style.stroke="#000000",a.style.strokeThickness=4,a.o=e+1,s(a),n.addChild(a)}for(let e=-1;e<4;e++){let t={"-1":5,0:6,1:7,2:8,3:9},i=new PIXI.Graphics;if(i.name="id_"+(e+1),i.beginFill(1052688,1e-6),i.lineStyle(3,10575126,1),-1==e)i.drawCircle(0,0,l),i.endFill(),i.x=d,i.y=r;else{const t=e/4*Math.PI*2;i.drawCircle(d+(l+o)*Math.cos(t),r+(l+o)*Math.sin(t),l),i.endFill()}let n=i.getBounds(),a=new PIXI.Sprite(this.coverImg("4000"));a.width=.85*n.width,a.height=.85*n.height,a.x=n.x+(n.width-a.width)/2,a.y=n.y+(n.height-a.height)/2,a.visible=!0,a.name="skill_"+t[e],a.o=t[e],s(a),h.addChild(i),h.addChild(a);let c=new PIXI.Text("int04",{fontFamily:"Arial",fontSize:24,fill:16777215,align:"center"});c.x=n.x-c.width/2+n.width/2,c.y=n.y-c.height/2+n.height/2,c.visible=!0,c.name="txt_"+t[e],c.style.stroke="#000000",c.style.strokeThickness=4,c.o=t[e],s(c),h.addChild(c)}n.x=i.x+(a-n.width)/2,n.visible=!0,n.y=i.y,h.x=i.x+(a-h.width)/2,h.visible=!1,h.y=i.y;let c=.3*e;c=c>50?50:c;let g=this.createAnimation("x2Main_Image_point_other_3",50,50,2);g.width=c,g.height=c,this.button.addChild(g),g.x=i.x+i.width-g.width,g.y=n.y,this.animationEvent(g,(()=>{this.changeClick()}));let p=.2*e;p=p>36?36:p;let m=this.animation("x2Main_Image_point_other_10",36,108,3);m.width=p,m.height=p,this.button.addChild(m),m.x=i.x+i.width-m.width,m.y=n.y-g.height,m.interactive=!0,m.cursor="pointer";let w=0;m.on("pointerdown",(()=>{w=(new Date).getTime()})),m.loop=!1,m.animationSpeed=.15,m.onComplete=()=>{!0===this.auto?m.gotoAndPlay(1):m.gotoAndStop(0)},m.on("pointerup",(()=>{(new Date).getTime()-w<200&&(this.auto=!this.auto,m.gotoAndPlay(1))}));let u=this.createAnimation("x2Main_Image_point_other_2",50,50,2);u.width=c,u.height=c,this.button.addChild(u),this.animationEvent(u,(()=>{n.visible?(TweenMax.to(n,.5,{alpha:0,ease:Power1.easeInOut}).eventCallback("onComplete",(()=>{n.visible=!1})),TweenMax.to(h,.5,{alpha:1,ease:Power1.easeInOut}).eventCallback("onStart",(()=>{h.visible=!0}))):(TweenMax.to(n,.5,{alpha:1,ease:Power1.easeInOut}).eventCallback("onStart",(()=>{n.visible=!0})),TweenMax.to(h,.5,{alpha:0,ease:Power1.easeInOut}).eventCallback("onComplete",(()=>{h.visible=!1})))})),u.y=i.y+i.height-u.height,u.x=i.x+i.width-u.width}}class Ne extends Ae{constructor(){super()}closeMenuLeftView=()=>{let e=this.menuLeft.getChildByName("body");this.menuLeft.getChildByName("background").interactive=!1,e&&this.move(e,{x:-e.width},500,null,null,(()=>{let e=this.button;this.deleteAllChild(this.menuLeft,!1);let t=e.getChildByName("icon_menu");t&&(t.y,t.alpha=1)})),this.deletePointer("menuleft")};openMenuLeftView=()=>{this.menuLeft.removeChildren();let e=this.gameWidth,t=this.gameHeight,i=new PIXI.Graphics;i.beginFill(0),i.drawRect(0,0,e,t),i.name="background",i.endFill(),i.alpha=5e-17,this.menuLeft.addChild(i),i.interactive=!0,i.on("pointerdown",(e=>{this.closeMenuLeftView()}));let n=.4*e;n=n>70?70:n;let h=new PIXI.Graphics;h.beginFill(0),h.drawRect(0,0,n,t),h.endFill(),h.name="body",h.alpha=.6,this.menuLeft.addChild(h);let a=this.mask(h,h);h.addChild(a);let l=[["x2Main_Image_point_quick_0","bạn bè"],["x2Main_Image_point_quick_2","auto"],["x2Main_Image_point_quick_3","Chọn cờ"],["x2Main_Image_point_quick_8","Chát thế giới",this.inputChatWorld],["x2Main_Image_point_quick_11","Nạp tiền"],["x2Main_Image_point_quick_9","Thoát game"]],o=0;l.forEach(((e,t)=>{let i=new PIXI.Container;a.addChild(i);let n=this.animation(e[0],60,120,2);n.x=0,n.y=0,n.name="icon",i.addChild(n);let h=new PIXI.Text(e[1],{fontFamily:"Arial",fontSize:11,fill:16777215,align:"center",fontWeight:"bold"});h.x=n.width/2-h.width/2,h.y=n.height+5,i.addChild(h),i.y=o,o+=i.height+5,i.keycode="int04",i.interactive=!0,i.cursor="pointer";let l=0;i.on("pointerdown",(e=>{l=Date.now(),i.getChildByName("icon").gotoAndStop(1)})),i.on("pointerup",(t=>{if(Date.now()-l<200){this.closeMenuLeftView();let t=e[2];t&&t()}i.getChildByName("icon").gotoAndStop(0)}))}));let d=a,r=h;if(d.height<r.height){let e=r.height-d.height,t=new PIXI.Graphics;t.beginFill(0,8.00001e-10),t.drawRect(0,0,r.width,e),t.endFill(),t.x=0,t.y=d.height,d.addChild(t)}let s=new pixi_viewport.Viewport({screenWidth:r.width,screenHeight:r.height,worldWidth:r.width,worldHeight:d.height});s.name="viewport",s.drag({direction:"y"}),s.bounce({top:!0,bottom:!0,time:10.1,ease:"easeInOutSine"}),d.name="hienthinoidung",s.addChild(d),r.addChild(s),s.pages=-1;let c=0,g=-1;s.on("pointerdown",(e=>{c=Date.now(),this.addPointer("menuleft",s)})),this.addPointer("menuleft",s),s.on("pointerup",(e=>{if(Date.now()-c<200){let t=e.data.global.x,n=e.data.global.y,h=a.toLocal(new PIXI.Point(t,n));h.x=Math.round(h.x),h.y=Math.round(h.y);let l=a.children.filter((e=>"int04"===e.keycode));for(let e=0;e<l.length;e++){let t=l[e].getChildByName("icon");t&&t.gotoAndStop(0)}for(let e=0;e<l.length;e++)if(l[e].x<=h.x&&h.x<=l[e].x+l[e].width&&l[e].y<=h.y&&h.y<=l[e].y+l[e].height){g=e;let t=l[e],n=this.getAllInteractiveChildren(t);n.length>0&&(i.interactive=!0,i.cursor="pointer",i.on("pointerdown",(()=>{n[0].emit("pointerdown")})),i.on("pointerup",(()=>{n[0].emit("pointerup")})))}}else clearInterval(this.pcSettimeEntactiveY),setTimeout((function(){clearInterval(this.pcSettimeEntactiveY),p()}),200)}));let p=()=>!1;p(),h.x=-h.width,this.move(h,{x:0},500,null,null,null);let m=this.button.getChildByName("icon_menu");m&&this.move(m,{alpha:0},500,null,null,null)}}class De extends Ne{constructor(){super()}createButtonOnBottomLeft=(e,t)=>{let i={width:e,height:t},n=(this.my,new PIXI.Container);n.y=.5*this.gameHeight,this.button.addChild(n);let h=this.createAnimation("x2Main_Image_point_other_1",50,50,2);h.x=0,h.y=.5*this.gameHeight,this.animationEvent(h,(()=>{this.inputChatZone()})),this.button.addChild(h);let a=.3*e;a=a>32?32:a;let l=this.animation("x2Main_Image_point_other_4",32,160,2);l.x=0,l.y=h.y-l.height-10,l.name="icon_menu",this.button.addChild(l),this.animationEvent(l,(()=>{0===this.menuLeft.children.length?this.openMenuLeftView():this.closeMenuLeftView()}));let o=new PIXI.Sprite(this.coverImg("x2Main_Image_point_move_0")),d=new PIXI.Sprite(this.coverImg("x2Main_Image_point_move_1")),r=i.width,s=e/7;s=s>30?30:s,console.log(s);const c=s+2,g=i.width/2,p=i.height/2,m=new PIXI.Graphics;m.beginFill(16711680),m.drawCircle(0,0,10),m.endFill(),m.x=g,m.y=p,n.addChild(m),m.visible=!1;let w=(e,t,i,n,h,a,l,r,s="up")=>{let c=()=>{this.keypress[37]=null,this.keypress[38]=null,this.keypress[39]=null,this.keypress[40]=null,this.action(this.my.id,"dungyen")},g=[],p=new PIXI.Texture(o.texture,new PIXI.Rectangle(e,t,i,n)),m=new PIXI.Texture(d.texture,new PIXI.Rectangle(h,a,l,r));g.push(p),g.push(m);let w=new PIXI.AnimatedSprite(g);return w.animationSpeed=.1,w.loop=!1,w.interactive=!0,w.cursor="pointer",w.on("pointerdown",(()=>{w.gotoAndStop(1),this.keypress[37]=null,this.keypress[38]=null,this.keypress[39]=null,this.keypress[40]=null,this.keypress[s]=!0})),w.on("pointerup",(()=>{w.gotoAndStop(0),c()})),w};for(let e=0;e<4;e++){const t=e/4*Math.PI*2;let i=new PIXI.Graphics;i.beginFill(65280,.5),i.lineStyle(1,0,1),i.drawCircle(g+(s+c)*Math.cos(t),p+(s+c)*Math.sin(t),s),i.endFill(),i.visible=!1;let h=[[39,126,70,72,59,129,70,72,59],[40,69,130,64,68,70,132,64,68],[37,5,72,66,57,3,72,66,57],[38,70,4,61,68,70,2,61,68]];n.addChild(i),h.forEach(((i,h)=>{if(e===h){let e=w(i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[0]);e.x=g+(s+c)*Math.cos(t),e.y=p+(s+c)*Math.sin(t),e.anchor.set(.5),n.addChild(e)}}))}n.x=-(r-n.width)/2,n.x+n.width+.1*i.width<i.width&&(n.x+=.1*i.width)}}class He extends De{constructor(){super()}renderInfoPlayer=(e,t)=>{let i=this.my,n=e,h=t,a=new PIXI.Graphics;a.beginFill(0,0),a.drawRect(0,0,e,t),a.endFill(),a.x=0,a.y=0,this.button.addChild(a),n=n>250?250:n,h=h>100?100:h;let l=new PIXI.Graphics;l.beginFill(0,5e-6),l.drawRect(0,0,n,h),l.endFill(),this.button.addChild(l),l.x=5,l.y=5,l.name="khung_nhan_vat_chinh",l.interactive=!0,l.cursor="pointer";let o=0;l.on("pointerdown",(()=>{o=(new Date).getTime()})),l.on("pointerup",(()=>{(new Date).getTime()-o<200&&this.hanhTrang()}));let d=.8*l.width,r=.6*l.height,s=new PIXI.Graphics;s.beginFill(16246470,1),s.drawRect(0,0,d,r),s.endFill(),s.name="main";let c=(l.width-d)/2,g=(l.height-r)/2,p=Math.ceil(d/c);for(let e=0;e<p;e++){let t=new PIXI.Sprite(this.coverImg("x2Main_Image_interface_bga9"));t.width=c,t.height=g,t.x=c*e,t.y=0-g,t.x+c>=d&&(t.width=d-t.x),s.addChild(t);let i=new PIXI.Sprite(this.coverImg("x2Main_Image_interface_bga15"));i.width=c,i.height=g,i.x=c*e,i.y=0+r,i.x+c>=d&&(i.width=d-i.x),s.addChild(i)}let m=Math.ceil(r/g);for(let e=0;e<m;e++){let t=new PIXI.Sprite(this.coverImg("x2Main_Image_interface_bga11"));t.width=c,t.height=g,t.x=0-c,t.y=g*e,t.y+g>=r&&(t.height=r-t.y),s.addChild(t);let i=new PIXI.Sprite(this.coverImg("x2Main_Image_interface_bga13"));i.width=c,i.height=g,i.x=0+d,i.y=g*e,i.y+g>=r&&(i.height=r-i.y),s.addChild(i)}let w=new PIXI.Sprite(this.coverImg("x2Main_Image_interface_bga8"));w.width=c,w.height=g,w.x=0-c,w.y=0-g,s.addChild(w);let u=new PIXI.Sprite(this.coverImg("x2Main_Image_interface_bga10"));u.width=c,u.height=g,u.x=d,u.y=0-g,s.addChild(u);let y=new PIXI.Sprite(this.coverImg("x2Main_Image_interface_bga12"));y.width=c,y.height=g,y.x=0-c,y.y=r,s.addChild(y);let f=new PIXI.Sprite(this.coverImg("x2Main_Image_interface_bga14"));f.width=c,f.height=g,f.x=d,f.y=r,s.addChild(f);let x=1*d,I=.7*r,_=new PIXI.Graphics;_.name="borderHP",_.beginFill(0,5e-21),_.drawRect(0,0,x,I),_.endFill(),_.x=0,_.y=0,s.addChild(_);let b=1*_.width,v=.4*_.height,C=new PIXI.Graphics;C.beginFill(0,5e-12),C.drawRect(0,0,b,v),C.name="hpinfo",C.endFill(),C.x=0,C.y=0,_.addChild(C);let P=.2*C.width;P=P>20?20:P;let S=1*C.height,X=this.cropImg("x2Main_Image_interface_iconmphp",0,0,20,21),k=new PIXI.Sprite(X);k.width=P,k.height=S,k.x=0,k.y=0,C.addChild(k);let T=C.width-P,F=1*C.height,M=i.info.chiso.hp,W=i.info.chiso.hpmax,E=M/W*100,R=new PIXI.Graphics;R.beginFill(10040064,1),R.drawRect(0,0,T,F),R.endFill(),R.x=P,R.y=0,R.name="background_hp",C.addChild(R);let G=T*E/100,B=1*F,A=new PIXI.Graphics;A.beginFill(16711680,1),A.drawRect(0,0,G,B),A.endFill(),A.x=0,A.y=0,A.name="hpget",R.addChild(A);let N=new PIXI.Text(M+"/"+W,{fontFamily:"Arial",fontSize:12,fill:16777215,align:"center"});N.name="txt",N.x=(R.width-N.width)/2,N.y=(R.height-N.height)/2,R.addChild(N);let D=b,H=.4*_.height,O=new PIXI.Graphics;O.name="mpinfo",O.beginFill(0,1e-7),O.drawRect(0,0,D,H),O.endFill(),O.x=0,O.y=v+.1*_.height,_.addChild(O);let z=.2*O.width;z=z>20?20:z;let L=1*O.height,K=this.cropImg("x2Main_Image_interface_iconmphp",0,21,20,21),j=new PIXI.Sprite(K);j.width=z,j.height=L,j.x=0,j.y=0,O.addChild(j);let U=i.info.chiso.mp,V=i.info.chiso.mpmax,Y=U/V*100,q=new PIXI.Graphics;q.beginFill(3355443,1),q.drawRect(0,0,D-j.width,H),q.endFill(),q.x=z,q.name="background_mp",q.y=0,O.addChild(q);let Z=D*Y/100,J=1*H,Q=new PIXI.Graphics;Q.beginFill(255,1),Q.drawRect(0,0,Z,J),Q.endFill(),Q.x=0,Q.name="mpget",Q.y=0,q.addChild(Q);let $=new PIXI.Text(U+"/"+V,{fontFamily:"Arial",fontSize:12,fill:16777215,align:"center"});$.x=(q.width-$.width)/2,$.y=(q.height-$.height)/2,$.name="txt",q.addChild($);let ee=new PIXI.Graphics;ee.beginFill(16777215,1e-6),ee.drawRect(0,0,x,r-I),ee.endFill(),ee.x=0,ee.y=I,s.addChild(ee),ee.name="BorderLevel";let te=.2*ee.width,ie=1*ee.height;te=te>20?20:te;let ne=this.cropImg("x2Main_Image_interface_iconmphp",0,42,20,21),he=new PIXI.Sprite(ne);he.width=te,he.height=ie,he.x=0,he.y=0,ee.addChild(he);let ae=new PIXI.Text(i.info.coban.level,{fontFamily:"Arial",fontSize:.7*he.height,fill:0,align:"center",fontWeight:"bold"});ae.x=he.width+3,ae.y=(ee.height-ae.height)/2,ae.name="txtlevel",ee.addChild(ae),s.x=(l.width-d)/2,s.y=(l.height-r)/2,l.addChild(s);let le=.3*e;le=le>32?32:le;let oe=this.animation("x2Main_Image_interface_mess",44,64,2);oe.name="sms",oe.width=le,this.button.addChild(oe),oe.animationSpeed=.2,oe.x=l.width-2*oe.width,oe.y=l.y+l.height,oe.interactive=!0,oe.cursor="pointer";let de=0;oe.on("pointerdown",(()=>{de=Date.now(),oe.gotoAndStop(1)})),oe.on("pointerup",(()=>{Date.now(),oe.gotoAndStop(0)}));let re=this.animation("x2Main_Image_point_other_5",50,100,2);re.name="sms_bang",re.width=le,re.height=le,this.button.addChild(re),re.animationSpeed=.2,re.x=oe.x+oe.width,re.y=oe.y,re.interactive=!0;let se=0;re.on("pointerdown",(()=>{se=Date.now(),re.gotoAndStop(1)})),re.on("pointerup",(()=>{Date.now(),re.gotoAndStop(0)}));let ce=new PIXI.Container;ce.name="hieuung",ce.x=l.x,ce.y=re.y+re.height,this.button.addChild(ce)}}class Oe extends He{constructor(){super()}renderButton=()=>{this.my,this.deleteAllChild(this.button,!1);let e=.5*this.gameWidth,t=.5*this.gameHeight;this.renderInfoPlayer(e,t),this.created_top_right_view_info_player(e,t);let i=new PIXI.Graphics;i.beginFill(0,0),i.drawRect(0,0,e,t),i.endFill(),i.x=0,i.y=this.gameHeight-t,this.button.addChild(i),this.createButtonOnBottomLeft(e,t);let n=new PIXI.Graphics;n.name="button_right",n.beginFill(16777215,0),n.drawRect(0,0,e,t),n.endFill(),n.x=e,n.y=this.gameHeight-t,this.button.addChild(n),this.createButtonright(e,t),this.updateRenderSkill(.5555,!0)}}class ze extends Oe{constructor(){super()}create_cache_player=e=>{let t=e.my,i=this.getMy(t.id);i?i=t:(this.cache_player.push(t),this.create_sprite_my(t))};create_cache_mob=e=>{this.deleteSprite(e.id),e.type="mob",e.action={move:"left"},e.pos={x:e.x,y:e.y},e.info=e.info||{},e.info.coban=e.info.coban||{},e.info.coban.speed=e.data.speed,e.name="quái",this.cache_player.push(e),this.action(e.id,"dungyen")};create_cache_zone=e=>{let t={type:"zone",pos:{}};t.id="int04"+this.randomAZ(3);let i=e[1];t.position={x:i[0],y:i[1],width:i[2],height:i[3],move:["left","top","right","bottom"][i[4]]};let n=e[2];t.nextMap={id:n[0],x:n[1],y:n[2]};let h=this.cache_player.findIndex((e=>e.position&&e.position.x===t.position.x&&e.position.y===t.position.y&&e.position.width===t.position.width&&e.position.height===t.position.height));-1===h&&this.cache_player.push(t)}}class Le extends ze{constructor(){super()}created_sprite_skin_hi=(e=null,t="dungyen")=>{e||(e=this.my);let i=new PIXI.Container;i.name=e.id,i.id=e.id;let n=e.skin,h=e.skin.id;h&&h.length>=1&&this.getidSprite(h).forEach((t=>{e.skin[t.type]&&(e.skin[t.type]=t.name)}));let a=this.getImg(n.lung),l=this.getImg(n.quan),o=this.getImg(n.ao),d=this.getImg(n.tay),r=this.getImg(n.dau),s=this.getImg(n.toc),c=this.getImg(n.non),g=new PIXI.Sprite(this.coverImg(a[t].src[0]));g.name="lung",g.scale.set(.5),g.x=i.addChild(g);let p=new PIXI.Sprite(this.coverImg(l[t].src[0]));p.name="quan",p.scale.set(.4),i.addChild(p);let m=new PIXI.Sprite(this.coverImg(o[t].src[0]));m.name="ao",i.addChild(m),m.scale.set(.5);let w=new PIXI.Sprite(this.coverImg(d[t].src[0]));w.name="tay",w.scale.set(.5);let u=new PIXI.Sprite(this.coverImg(r[t].src[0]));u.name="dau",i.addChild(u),u.scale.set(.5);let y=new PIXI.Sprite(this.coverImg(s[t].src[0]));y.name="toc",i.addChild(y),y.scale.set(.5);let f=new PIXI.Sprite(this.coverImg(c[t].src[0]));f.name="non",i.addChild(f),f.scale.set(.5),i.addChild(w),m.x=o[t].x,m.y=o[t].y,p.x=l[t].x,p.y=l[t].y,w.x=d[t].x,w.y=d[t].y,y.x=s[t].x,y.y=s[t].y,f.x=c[t].x,f.y=c[t].y,g.x=a[t].x,g.y=a[t].y,u.xy=0;let x=setInterval((()=>{this.box.children.length<=0?clearInterval(x):0==u.xy?(u.y+=1,m.y+=1,g.y+=1,w.y+=1,y.y+=1,f.y+=1,u.xy=1):(u.y-=1,m.y-=1,m.first=0,u.xy=0,g.y-=1,w.y-=1,y.y-=1,f.y-=1)}),200);return i};create_sprite_ctg=(e=null,t="dungyen")=>{e||(e=this.my);let i=new PIXI.Container;i.name=e.id,i.id=e.id;let n=e,h=e.id;h&&h.length>=1&&this.getidSprite(h).forEach((t=>{e.skin[t.type]&&(e.skin[t.type]=t.name)}));let a=this.getImg(n.lung),l=this.getImg(n.quan),o=this.getImg(n.ao),d=this.getImg(n.tay),r=this.getImg(n.dau),s=this.getImg(n.toc),c=this.getImg(n.non),g=new PIXI.Sprite(this.coverImg(a[t].src[0]));g.name="lung",g.scale.set(.5),g.x=i.addChild(g);let p=new PIXI.Sprite(this.coverImg(l[t].src[0]));p.name="quan",p.scale.set(.4),i.addChild(p);let m=new PIXI.Sprite(this.coverImg(o[t].src[0]));m.name="ao",i.addChild(m),m.scale.set(.5);let w=new PIXI.Sprite(this.coverImg(d[t].src[0]));w.name="tay",w.scale.set(.5);let u=new PIXI.Sprite(this.coverImg(r[t].src[0]));u.name="dau",i.addChild(u),u.scale.set(.5);let y=new PIXI.Sprite(this.coverImg(s[t].src[0]));y.name="toc",i.addChild(y),y.scale.set(.5);let f=new PIXI.Sprite(this.coverImg(c[t].src[0]));f.name="non",i.addChild(f),f.scale.set(.5),i.addChild(w),m.x=o[t].x,m.y=o[t].y,p.x=l[t].x,p.y=l[t].y,w.x=d[t].x,w.y=d[t].y,y.x=s[t].x,y.y=s[t].y,f.x=c[t].x,f.y=c[t].y,g.x=a[t].x,g.y=a[t].y,u.xy=0;let x=setInterval((()=>{let e=this.button.getChildByName("chat_the_gioi");!e||e.children.length<=0||0==e.visible?clearInterval(x):0==u.xy?(u.y+=1,m.y+=1,g.y+=1,w.y+=1,y.y+=1,f.y+=1,u.xy=1):(u.y-=1,m.y-=1,m.first=0,u.xy=0,g.y-=1,w.y-=1,y.y-=1,f.y-=1)}),200);return this.cache_event.push(["chatthegioi",x]),i}}class Ke extends Le{constructor(){super()}create_sprite_my=(e=null)=>{e||(e=this.my),this.deleteSprite(e.id);let t=new PIXI.Container;t.name=e.id,t.id=e.id,this.player.addChild(t);let i=e.skin,n=e.skin.id;n&&n.length>=1&&this.getidSprite(n).forEach((t=>{e.skin[t.type]&&(e.skin[t.type]=t.name)}));let h=this.getImg(i.lung),a=this.getImg(i.quan),l=this.getImg(i.ao),o=this.getImg(i.tay),d=this.getImg(i.dau),r=this.getImg(i.toc),s=this.getImg(i.non),c="dungyen",g=new PIXI.Sprite(this.coverImg(h[c].src[0]));g.name="lung",g.scale.set(.5),t.addChild(g);let p=new PIXI.Sprite(this.coverImg(a[c].src[0]));p.name="quan",p.scale.set(.4),t.addChild(p);let m=new PIXI.Sprite(this.coverImg(l[c].src[0]));m.name="ao",t.addChild(m),m.scale.set(.5);let w=new PIXI.Sprite(this.coverImg(o[c].src[0]));w.name="tay",w.scale.set(.5);let u=new PIXI.Sprite(this.coverImg(d[c].src[0]));u.name="dau",t.addChild(u),u.scale.set(.5);let y=new PIXI.Sprite(this.coverImg(r[c].src[0]));y.name="toc",t.addChild(y),y.scale.set(.5);let f=new PIXI.Sprite(this.coverImg(s[c].src[0]));f.name="non",t.addChild(f),f.scale.set(.5);let x=e.pos;t.x=x.x,t.y=x.y,t.addChild(w),this.action(e.id,"dungyen")}}class je extends Ke{constructor(){super(),this.base_map="",this.srcDaLoad=[],this.gameMap={setting:{maxY:0,minY:0,maxX:0,minX:0},size:{idMaxX:0,idMaxY:0,idMinX:0,idMinY:0}}}deletePlayer=()=>{(e=>{let t=e.cache_player;t.forEach((i=>{let n=i.id;e.deleteSprite(n);let h=t.findIndex((e=>e.id==n));if(t.splice(h,1),e.cache_action.find((e=>e.id==n))){let t=e.cache_action.findIndex((e=>e.id==n));e.cache_action.splice(t,1)}}))})(this)};resetNone=()=>{var e;(e=this).player.children.forEach((t=>{let i=t.name;e.getMy(i)||e.deleteSprite(i)}))};goto=(e,t=null,i=null,n=null)=>{((e,t,i=null,n=null,h=null)=>{if(e.send(-2,[1,t,i,n,h]),null!==n&&null!==h&&e.my.id>=1){let t=e.getSprite(e.my.id);t.x=n,t.y=h}})(this,e,t,i,n)};insertMap=()=>{this.base_map,this.loadGame.visible=!0,this.LoadAssetMap()};LoadAssetMap=()=>{(e=>{e.loadGame.visible=!0,e.gameMap={setting:{maxY:0,minY:0,maxX:0,minX:0},size:{idMaxX:0,idMaxY:0,idMinX:0,idMinY:0}};let t=e.base_map.split("!"),i=[];for(let n=0;n<t.length;n++){let h=t[n];if(h.length>=1){let t=h.split("^")[0];if(t.split(",").length>=2)for(let n=0;n<t.split(",").length;n++){let h=t.split(",")[n],a=e.assets.find((e=>e.name===h));if(!a)return!1;if(i.find((e=>e===h)))continue;let l=e.srcDaLoad.find((e=>e===h));l||(e.srcDaLoad.push(h),i.push(h))}else{let n=e.assets.find((e=>e.name===t));if(!n)return!1;let h=e.srcDaLoad.find((e=>e===t));if(h)continue;e.srcDaLoad.push(t),i.push(t)}}}let n=0,h=e.loadGame.getChildByName("txtLoadgame"),a=e.loadGame.getChildByName("bgLoadTip"),l=["Tham gia các hoạt động để trở nên mạnh mẽ","Bạn có thể kiếm beri từ việc buôn","Mỗi trái ác quỷ đều mang một sức mạnh đáng sợ..."],o=()=>{let t=Math.floor(Math.random()*l.length);a&&(a.text=l[t],a.x=e.gameWidth/2-a.width/2)},d=setInterval((()=>{o()}),2e3);o();let r=t=>new Promise(((a,l)=>{if(PIXI.utils.TextureCache[t])return n+=1,a(!0);e.loadGame.visible=!0,h.visible=!0,PIXI.Assets.load(t).then((t=>{n+=1,h.text="Đã tải "+n+"/"+(i.length-1)+" gói tài nguyên bản đồ... ",h.x=e.gameWidth/2-h.width/2,a(!0)}))})),s=[];console.log(i);for(let t=0;t<i.length;t++){let n=e.assets.find((e=>e.name===i[t])),h="./assets/map/"+n.src+"/"+n.name+".png";s.push(r(h))}let c=Date.now();Promise.all(s).then((t=>{console.log("loadMap ("+i.length+") packages: "+(Date.now()-c)+"ms"),h.visible=!1,clearInterval(d),e.loadMap()}))})(this)};resetMap=()=>{var e;(e=this).map.removeChildren(),e.che.removeChildren(),e.may.removeChildren(),e.bien.removeChildren(),e.nui1.removeChildren(),e.nui2.removeChildren(),e.isGoToZone=!1};loadMap=()=>{(e=>{e.resetMap();let t=e.base_map.split("!"),i=e.gameMap,n=[];for(let h=0;h<t.length;h++){let a=t[h];if(a.length>=1){let t={},h=a.split("^");t.name=h[0],t.type=h[1];let l=h[2].split(",");t.x=+l[0],t.y=+l[1],t.width=+l[2],t.height=+l[3];let o,d=t.name;{let h,a=d.split(",");if(a.length<=1){let i=e.assets.find((e=>e.name==t.name));o="./assets/map/"+i.src+"/"+i.name+".png";let n=PIXI.Texture.from(o);h=new PIXI.Sprite(n),h.name=t.name}else{const e=a.map((e=>PIXI.Texture.from("./assets/map/dat/"+e+".png")));h=new PIXI.AnimatedSprite(e),h.animationSpeed=.1,h.play(),h.name=d}h.x=t.x,h.y=t.y,h.width=t.width,h.height=t.height,h.type=t.type,h.visible=!0,"may"==h.type?null==n.find((e=>"may"==e.name))&&n.push({name:"may",type:"may",src:o,x:t.x,y:t.y,width:t.width,height:t.height}):"bien"==h.type?null==n.find((e=>"bien"==e.name))&&n.push({name:"bien",type:"bien",x:t.x,y:t.y,src:o,width:t.width,height:t.height}):"nui2"==h.type?null==n.find((e=>"nui2"==e.name))&&n.push({name:"nui2",type:"nui2",x:t.x,src:o,y:t.y,width:t.width,height:t.height}):"nui1"==h.type?null==n.find((e=>"nui1"==e.name))&&n.push({name:"nui1",type:"nui1",src:o,x:t.x,y:t.y,width:t.width,height:t.height}):"che"==h.type?e.che.addChild(h):(e.map.addChild(h),h.type,i.setting.maxY<t.y&&(i.setting.maxY=t.y,i.size.idMaxY=t.height),i.setting.minY>t.y&&(i.setting.minY=t.y-t.height,i.size.idMinY=t.height),i.setting.maxX<t.x&&(i.setting.maxX=t.x,i.size.idMaxX=t.width),i.setting.minX>t.x&&(i.setting.minX=t.x,i.size.idMinX=t.width))}}}n.forEach((t=>{let n=i.setting.minX,h=i.setting.maxX,a=Math.ceil((h-n)/t.width);for(let i=0;i<a;i++){let h=PIXI.Texture.from(t.src),a=new PIXI.Sprite(h);a.x=n+t.width*i,a.y=t.y,a.width=t.width,a.height=t.height,a.name=t.name,a.type=t.type,a.visible=!0,"may"==t.type?e.may.addChild(a):"bien"==t.type?e.bien.addChild(a):"nui2"==t.type?e.nui2.addChild(a):"nui1"==t.type&&e.nui1.addChild(a)}})),e.loadGame.visible=!1,e.configMap()})(this)};configMap=()=>{(e=>{e.config.map=0;let t=e.my.pos.map,i=e.listMap.find((e=>e.id===t));i&&i.config&&1===i.config.sea&&(e.config.map=1)})(this)}}class Ue extends je{constructor(){super(),this.cache.ghep=[]}createObjectIO=()=>{this.ws.on(-1,(()=>{this.notice("Tài khoản hoặc mật khẩu không chính xác")})),this.ws.on(-2,(()=>{this.notice(this._("Tài khoản chưa có nhân vật nào cả."))})),this.ws.on(-3,(e=>{this.my=e,this.create_sprite_my(this.my),this.closeLogin(),this.deleteNotice(),this.goto(this.my.pos.map,null,this.my.pos.x,this.my.pos.y),this.loadGame.visible=!0,this.renderButton()})),this.ws.on(-5,(e=>{for(let t=0;t<e.length;t++){let i=e[t],n=i[0],h=i[1],a=i[2],l=this.getMy(n);if(!l){this.getObjectMap();break}l.pos.x=h,l.pos.y=a}})),this.ws.on(-6,(e=>{let t=e[0],i=e[1],n=e[2],h=this.getMy(t);h?(h.pos.x=i,h.pos.y=n):this.getObjectMap()})),this.ws.on(-4,(e=>{this.cache_player=[],this.cache_action=[],this.resetNone();let t=e[0];this.base_map=t,this.insertMap();let i=e[1];this.create_sprite_my(this.my),i.forEach((e=>{this.getMy(e.id)||(e.action={},e.type="npc",e.info=e.info||{},e.info.coban=e.info.coban||{},e.info.coban.speed=1,this.cache_player.push(e),this.action(e.id,"dungyen"))})),e[2].forEach((e=>{this.create_cache_mob(e)})),e[3].forEach((e=>{this.create_cache_player(e)}));let n=e[4];"object"==typeof n&&n.forEach((e=>{this.create_cache_zone(e)}))})),this.ws.on(-7,(e=>{e[0].forEach((e=>{this.getMy(e.id)||(e.action={},e.type="npc",e.info=e.info||{},e.info.coban=e.info.coban||{},e.info.coban.speed=1,this.cache_player.push(e),this.action(e.id,"dungyen"))})),e[1].forEach((e=>{this.getMy(e.id)||this.create_cache_mob(e)})),e[2].forEach((e=>{this.create_cache_player(e)}));let t=e[3];"object"==typeof t&&t.forEach((e=>{this.create_cache_zone(e)}))})),this.ws.on("_",(e=>{this.item=e[0],this.expskill=e[1],this.skill=e[2],this.explevel=e[3],this.listMap=e[4],this.cache.idShop=e[5],this.cache.costShop=e[6],this.config=e[7],this.cache.ghep=e[8]})),this.ws.on(-8,(()=>{this.notice(this._("Không tìm thấy vật phẩm"))})),this.ws.on(-9,(()=>{this.notice(this._("Mã lỗi -9, vui lòng báo admin."))})),this.ws.on(-10,(()=>{this.notice(this._("Bạn chưa đủ cấp độ để sử dụng vật phẩm này"))})),this.ws.on(-11,(()=>{this.notice(this._("Nhân vật của bạn không thể sử dụng vật phẩm này."))})),this.ws.on(-12,(()=>{this.deleteNotice()})),this.ws.on(-13,(e=>{let t=e[0],i=e[1],n=e[2],h=e[3],a=e[4],l=this.getMy(t);l.trangbi=i,l.info=n,l.skin=h,l.ruong=a,l.id==this.my.id&&(this.deleteNotice(),this.hanhTrang())})),this.ws.on(-14,(()=>{this.deleteNotice()})),this.ws.on(-15,(e=>{let t=this.my;if(t.id<=0)return!1;let i=t.skill.find((t=>t[0]==e[0]));i&&(i[2]=Date.now()+e[1],i[4]=Date.now()),t.info.chiso.mp=e[2]})),this.ws.on(-16,(e=>{let t=e[0],i=(e[1],e[2]),n=e[3],h=e[4],a=this.getSprite(n),l=this.getSprite(h);if(l&&a){let e=this.getMy(n);a.x<l.x?e.action.move="right":e.action.move="left";let t=this.getMy(h);"right"===e.action.move?"dungyen"===t.action.action&&(t.action.move="left"):"dungyen"===t.action.action&&(t.action.move="right")}this.setSkill({from:n,to:h,type:i,keycode:t,value:0})})),this.ws.on(-17,(e=>{e[0];let t=e[1],i=e[2],n=e[3],h=e[4],a=this.getMy(t);a?"empty"!=h&&(a.info.chiso.hp=h):this.getObjectMap(),this.setSkill({from:t,type:"hp",value:i,st:n})})),this.ws.on(-18,(e=>{let t=e[0],i=e[1],n=e[2],h=e[3],a=e[4],l=e[5],o=this.getMy(t);if(o){let e=["","hp","mp"];o.info.chiso[e[i]]=h;let d=o.ruong.data.find((e=>e.id==l));d&&(d.soluong=a,d.soluong<=0&&(o.ruong.data=o.ruong.data.filter((e=>e.id!=l)))),0!=n&&this.setSkill({from:t,who:i,type:"conghp",value:n}),o.id==this.my.id&&(this.deleteNotice(),this.box.children.length>=1&&this.hanhTrang())}})),this.ws.on(-19,(()=>{this.notice(this._("Bạn không thể sử dụng vật phẩm khi đang bị thương"))})),this.ws.on(-20,(()=>{this.notice(this._("Đã hết vật phẩm"))})),this.ws.on(-21,(()=>{this.notice(this._("Có lỗi xẩy ra, vui lòng thử lại sau. #-21"))})),this.ws.on(-22,(e=>{let t=e[0],i=e[1],n=e[2],h=e[3],a=e[4],l=this.getMy(t);if(l){if(h){let e=l.skill.find((e=>e[0]==h));e&&(e[3]=a)}l.info.coban.exp=n,0!=i&&this.setSkill({from:t,type:"congexp",value:i})}})),this.ws.on(-23,(e=>{let t=e[0],i=e[1],n=this.getMy(t);n&&(n.info.coban=i)})),this.ws.on(-24,(e=>{let t=e[0];this.my.skill=t})),this.ws.on(-25,(e=>{let t=e[0],i=e[1],n=this.getMy(t);n?n.info.chiso.hp=i:this.getObjectMap()})),this.ws.on(-26,(e=>{let t=e[0],i=this.getMy(t);i?i.info.chiso.hp=0:this.getObjectMap()})),this.ws.on(-27,(e=>{let t=e[0],i=e[1],n=this.getMy(t);n&&(n.info.chiso.hp=i)})),this.ws.on(-28,(e=>{let t=e[0],i=e[1],n=e[2],h=this.getMy(t);h?(h.eff=i,n&&(h.info.chiso=n)):this.getObjectMap()})),this.ws.on(-29,(e=>{let t=e[0],i=e[1];this.ioInsertChat({_1:t,_2:i})})),this.ws.on(-30,(e=>{let t=this.my;t.tien.beri=e[0],t.tien.ruby=e[1]})),this.ws.on(-31,(e=>{let t=e[0],i=e[1],n=e[2];this.cache_chat_the_gioi.push([t,i,n])})),this.ws.on(-32,(e=>{this.isGoToZone=!1})),this.ws.on(-33,(e=>{this.chipi(this._("Không thể mua vật phẩm này"))})),this.ws.on(-34,(e=>{this.chipi(this._("Tài khoản của bạn không đủ bery để thực hiện."))})),this.ws.on(-35,(e=>{this.chipi(this._("Tài khoản của bạn không đủ ruby để thực hiện."))})),this.ws.on(-36,(e=>{this.chipi(this._("Hành trang đã mang 999 vật phẩm."))})),this.ws.on(-37,(e=>{this.chipi(this._("Hành trang không còn đủ chỗ trống."))})),this.ws.on(-38,(e=>{this.deleteNotice(),this.chipi(this._("Giao dịch thành công."));let t=this.my;t.tien=e[0],t.ruong=e[1];let i=this.findText("text_ruby");i&&(i.text=this.number_format(t.tien.ruby));let n=this.findText("text_beri");n&&(n.text=this.number_format(t.tien.beri))})),this.ws.on(-39,(e=>{this.chipi(this._("Không đủ số lượng để bán"))})),this.ws.on(-40,(e=>{this.deleteNotice(),this.chipi(this._("Giao dịch thành công."));let t=this.my;t.tien=e[0],t.ruong=e[1];let i=this.findText("text_ruby");i&&(i.text=this.number_format(t.tien.ruby));let n=this.findText("text_beri");n&&(n.text=this.number_format(t.tien.beri));let h=e[2],a=h[0],l=h[1];if(1===h[2])if(l<1){let e=this.findText("item_"+a);e&&this.hideTextChild(e)}else{let e=this.findText("quantity_"+a);e&&(e.text=l)}else{let e=this.findText("item_"+a);e&&this.hideTextChild(e)}})),this.ws.on(-41,(e=>{this.chipi(this._("Không tìm thấy trang bị"))})),this.ws.on(-42,(e=>{this.chipi(this._("Không phải trang bị"))})),this.ws.on(-43,(e=>{this.chipi(this._("Trang bị đã đạt cấp tối đa."))})),this.ws.on(-44,(e=>{this.chipi(this._("Thiếu vật phẩm nâng cấp."))})),this.ws.on(-45,(e=>{this.chipi(this._("Nâng cấp thất bại, có loại vật phẩm cùng loại với nhau."))})),this.ws.on(-46,(e=>{this.chipi(this._("Nâng cấp thất bại, có vật phẩm không thể sử dụng để có thể nâng cấp"))})),this.ws.on(-47,(e=>{this.chipi(this._("Bạn không đủ đá để nâng cấp"))})),this.ws.on(-48,(e=>{this.chipi(this._("Bạn không đủ beri để nâng cấp."))})),this.ws.on(-49,(e=>{this.chipi(this._("Để nâng cấp trang bị này, bạn cần có loại đá cấp cao hơn."))})),this.ws.on(-50,(e=>{((e,t)=>{let i=e.my;i.tien=t[0],i.ruong=t[1];let n=t[2];e.deleteNotice();let h=n[0]?1:0,a=e.findText("o_nangcap_0"),l=e.findText("o_nangcap_1");l&&a&&e.move(a,{x:l.x,y:l.y},1e3,null,null,(()=>{let t=e.findText("animation_run_nangcap"),i=()=>{n[0]?e.chipi(e._("Nâng cấp thành công")):n[1]>=1?n[2]?e.chipi(e._("Nâng cấp thất bại, trang bị được bảo vệ cấp thành công.")):e.chipi(e._("Nâng cấp thất bại, trang bị của bạn bị tụt 1 cấp độ.")):e.chipi(e._("Nâng cấp thất bại ! Hãy thử lại nhé !")),e.nangcap()};t&&(t.visible=!0,t.play(),t.onComplete=()=>{t.visible=!1;let n=e.findText("animation_success_nangcap");1===h&&n?(n.visible=!0,n.play(),n.onComplete=()=>{i(),n.visible=!1}):0===h&&i()})}))})(this,e)})),this.ws.on(-51,(e=>{this.chipi(this._("Không tìm thấy công thức để ghép, vui lòng kiểm tra lại nguyên liệu."))})),this.ws.on(-52,(e=>{this.chipi(this._("Bạn không có đủ bery để ghép vật phẩm này."))})),this.ws.on(-53,(e=>{this.chipi(this._("Bạn không có đủ ruby để ghép vật phẩm này."))})),this.ws.on(-54,(e=>{this.chipi(this._("Danh sách nguyên liệu chưa đủ."))})),this.ws.on(-55,(e=>{this.chipi(this._("Bạn không còn nguyên liệu này ở hành trang."))})),this.ws.on(-56,(e=>{this.chipi(this._("Số lượng nguyên liệu chưa đủ, hãy bổ sung thêm để có thể ghép vật phẩm."))})),this.ws.on(-57,(e=>{this.chipi(this._("không tìm thấy vật phẩm trong công thức này."))})),this.ws.on(-58,(e=>{((e,t)=>{e.deleteNotice(),e.my.tien=t[0],e.my.ruong=t[1];let i=t[2],n=()=>{i?e.chipi(e._("Ghép vật phẩm thành công.")):e.chipi(e._("Ghép vật phẩm thất bại.")),e.ghep()},h=e.findText("animation_run_ghep");h&&(h.visible=!0,h.play(),h.onComplete=()=>{if(h.visible=!1,i){let t=e.findText("animation_success_ghep");t.visible=!0,t.play(),t.onComplete=()=>{t.visible=!1,n()}}else n()})})(this,e)})),this.ws.on(-59,(e=>{this.chipi(this._("Không tìm thấy trang bị"))})),this.ws.on(-60,(e=>{this.chipi(this._("Bạn chỉ được  chọn 2 món để đục thôi"))})),this.ws.on(-61,(e=>{this.chipi(this._("Trang bị đã được đục hết các lỗ"))})),this.ws.on(-62,(e=>{this.chipi(this._("Bạn không có đủ ruby để thực hiện chức năng này"))})),this.ws.on(-63,(e=>{this.chipi(this._("Không tìm thấy búa đục."))})),this.ws.on(-64,(e=>{this.deleteNotice(),this.my.tien=e[0],this.my.ruong=e[1],this.chipi(this._("Đục lỗ thành công")),this.duclo()}))};getObjectMap=()=>{this.send(-4)}}class Ve extends Ue{constructor(){super()}IoEvent=e=>{if(!e)return!1};readData=e=>{if(!(e instanceof ArrayBuffer))return e;return msgpack.decode(new Uint8Array(e))||e};handleData=()=>{this.ws.onAny(((e,...t)=>{if(t[0]){let e=t[0];if("string"==typeof e)return this.IoEvent(t);if("number"==typeof e)return this.IoEvent(t);if("boolean"==typeof e)return this.IoEvent(t);if(void 0===e)return this.IoEvent(t);if("function"==typeof e)return this.IoEvent(t);e=this.readData(t[0]),this.IoEvent(e)}}))}}class Ye extends Ve{constructor(){super()}confirm=(e,t,i)=>((e,t,i,n)=>{e.noticeMain.removeChildren(),e.noticeMain.visible=!0;let h=new PIXI.Graphics;h.beginFill(16777215,1e-7),h.drawRect(0,0,e.gameWidth,e.gameHeight),h.endFill(),h.name="background",e.noticeMain.addChild(h),h.interactive=!0;let a=.7*e.gameWidth;a=a>400?400:a;let l=.3*e.gameHeight;l=l>100?100:l;let o=new PIXI.Text(t,{align:"center",breakWords:!0,fontSize:15,whiteSpace:"normal",wordWrap:!0,wordWrapWidth:.8*a,fill:0,fontWeight:"bold"});o.name="notice",l+=o.height;let d=e.createUI(a,l,{leftTop:"x2Main_Image_interface_paper0,28,38",centerTop:"x2Main_Image_interface_paper5,60,16",rightTop:"x2Main_Image_interface_paper450,28,38",leftCenter:"x2Main_Image_interface_paper100,28,20",centerCenter:"x2Main_Image_interface_paper_7,20,16",rightCenter:"x2Main_Image_interface_paper1,28,20",leftBottom:"x2Main_Image_interface_paper2,28,38",centerBottom:"x2Main_Image_interface_paper6,60,16",rightBottom:"x2Main_Image_interface_paper244,28,38",leftPre:"x2Main_Image_interface_paper_4,34,16",rightPre:"x2Main_Image_interface_paper_3,32,16"});d.addChild(o),o.x=(d.width-o.width)/2,o.y=(d.height-o.height)/2-20;let r=.3*d.width;r=r>100?100:r;let s=new PIXI.Container,c=10;if(i){let t=new PIXI.Graphics;t.beginFill(9929061,1),t.lineStyle(3,10253387,1),t.drawRoundedRect(0,0,r,30,10),t.endFill(),t.name="buttonOK",c+=r,t.interactive=!0,t.cursor="pointer";let n=new PIXI.Text("Đồng ý",{align:"center",breakWords:!0,fontSize:15,whiteSpace:"normal",wordWrap:!0,wordWrapWidth:r,fill:16777215,fontWeight:"bold"});n.name="textButton",n.x=(t.width-n.width)/2,n.y=(t.height-n.height)/2,t.addChild(n);let h=0;t.on("pointerdown",(()=>{h=Date.now()})),t.on("pointerup",(()=>{Date.now()-h<200&&(e.deleteNotice(),i&&i())})),s.addChild(t)}let g=new PIXI.Graphics;g.beginFill(9929061,1),g.lineStyle(3,10253387,1),g.drawRoundedRect(0,0,r,30,10),g.endFill(),g.name="buttonClose",g.x=c,g.interactive=!0,g.cursor="pointer";let p=new PIXI.Text("Đóng",{align:"center",breakWords:!0,fontSize:15,whiteSpace:"normal",wordWrap:!0,wordWrapWidth:r,fill:16777215,fontWeight:"bold"});p.name="textButton",p.x=(g.width-p.width)/2,p.y=(g.height-p.height)/2,g.addChild(p);let m=0;g.on("pointerdown",(()=>{m=Date.now()})),g.on("pointerup",(()=>{Date.now()-m<200&&(e.deleteNotice(),n&&n())})),s.addChild(g),s.x=(d.width-s.width)/2,s.y=o.y+20+o.height,s.visible=!0,d.addChild(s),d.x=(e.gameWidth-d.width)/2,d.y=.8*e.gameHeight-d.height,h.addChild(d),h.visible=!0,h.alpha=0,TweenMax.to(h,.2,{alpha:1,onComplete:()=>{h.visible=!0}})})(this,e,t,i);deleteNotice=()=>{let e=this.noticeMain.getChildByName("background");e?TweenMax.to(e,.5,{alpha:0,onComplete:()=>{this.noticeMain.visible=!1,this.noticeMain.removeChildren()}}):(this.noticeMain.visible=!1,this.noticeMain.removeChildren())};wait=e=>this.notice(e,!1);notice=(e,t=!0)=>{this.noticeMain.removeChildren(),this.noticeMain.visible=!0;let i=new PIXI.Graphics;i.beginFill(16777215,1e-7),i.drawRect(0,0,this.gameWidth,this.gameHeight),i.endFill(),i.name="background",this.noticeMain.addChild(i),i.interactive=!0;let n=.7*this.gameWidth;n=n>400?400:n;let h=.3*this.gameHeight;h=h>100?100:h;let a=new PIXI.Text(e,{align:"center",breakWords:!0,fontSize:15,whiteSpace:"normal",wordWrap:!0,wordWrapWidth:.8*n,fill:0,fontWeight:"bold"});a.name="notice",h+=a.height;let l=this.createUI(n,h,{leftTop:"x2Main_Image_interface_paper0,28,38",centerTop:"x2Main_Image_interface_paper5,60,16",rightTop:"x2Main_Image_interface_paper450,28,38",leftCenter:"x2Main_Image_interface_paper100,28,20",centerCenter:"x2Main_Image_interface_paper_7,20,16",rightCenter:"x2Main_Image_interface_paper1,28,20",leftBottom:"x2Main_Image_interface_paper2,28,38",centerBottom:"x2Main_Image_interface_paper6,60,16",rightBottom:"x2Main_Image_interface_paper244,28,38",leftPre:"x2Main_Image_interface_paper_4,34,16",rightPre:"x2Main_Image_interface_paper_3,32,16"});l.addChild(a),a.x=(l.width-a.width)/2,a.y=(l.height-a.height)/2-20;let o=.3*l.width;o=o>100?100:o;let d=new PIXI.Container,r=new PIXI.Graphics;r.beginFill(9929061,1),r.lineStyle(3,10253387,1),r.drawRoundedRect(0,0,o,30,10),r.endFill(),r.name="buttonClose",r.interactive=!0,r.cursor="pointer";let s=new PIXI.Text("Đóng",{align:"center",breakWords:!0,fontSize:15,whiteSpace:"normal",wordWrap:!0,wordWrapWidth:o,fill:16777215,fontWeight:"bold"});s.name="textButton",s.x=(r.width-s.width)/2,s.y=(r.height-s.height)/2,r.addChild(s);let c=0;r.on("pointerdown",(()=>{c=Date.now()})),r.on("pointerup",(()=>{Date.now()-c<200&&this.deleteNotice()})),d.addChild(r),d.x=(l.width-d.width)/2,d.y=a.y+20+a.height,d.visible=!1,t&&(d.visible=!0),l.addChild(d),l.x=(this.gameWidth-l.width)/2,l.y=.8*this.gameHeight-l.height,i.addChild(l),i.visible=!0,i.alpha=0,TweenMax.to(i,.2,{alpha:1,onComplete:()=>{i.visible=!0}})}}class qe extends Ye{constructor(){super(),this.username=this.getCookie("int04_username"),this.password=this.getCookie("int04_password")}connectGame=()=>this.username.length<=0?this.notice("Vui lòng nhập tài khoản"):this.password.length<=0?this.notice("Vui lòng nhập mật khẩu"):(this.notice("Đang tiến vào biển cả, xin chờ...",!1),this.setCookie("int04_username",this.username,30),this.setCookie("int04_password",this.password,30),void this.send(-1,[1,this.username,this.password]));createUI=(e,t,i)=>{let n=new PIXI.Container,h=i.centerCenter.split(","),a=(h[0],h[1],h[2],new PIXI.Graphics);a.beginFill(16246719),a.drawRect(0,0,e,t),a.endFill(),n.addChild(a);let l=i.centerTop.split(","),o=l[0],d=1*l[1],r=(l[2],Math.ceil(e/d));for(let t=0;t<r;t++){let i=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/"+o+".png"));i.x=t*d,i.x+d>e&&(i.x-=i.x+d-e),n.addChild(i)}let s=i.centerBottom.split(","),c=s[0],g=1*s[1],p=1*s[2],m=Math.ceil(e/g);for(let i=0;i<m;i++){let h=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/"+c+".png"));h.x=i*g,h.y=t-p,h.x+g>e&&(h.x-=h.x+g-e),n.addChild(h)}let w=i.leftCenter.split(","),u=w[0],y=(w[1],1*w[2]),f=Math.ceil(t/y),x=i.leftPre.split(","),I=(x[0],x[1],1*x[2]);Math.ceil(t/I);for(let e=0;e<f;e++){let i=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/"+u+".png"));i.y=e*y,i.y+y>t&&(i.y-=i.y+y-t),n.addChild(i)}let _=i.rightCenter.split(","),b=_[0],v=1*_[1],C=1*_[2],P=Math.ceil(t/C);for(let i=0;i<P;i++){let h=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/"+b+".png"));h.x=e-v,h.y=i*C,h.y+C>t&&(h.y-=h.y+C-t),n.addChild(h)}let S=i.leftTop.split(","),X=S[0],k=(S[1],S[2],new PIXI.Sprite(PIXI.Texture.from("./assets/ui/"+X+".png")));k.x=-2.3,k.y=-10,n.addChild(k);let T=i.rightTop.split(","),F=T[0],M=1*T[1],W=(T[2],new PIXI.Sprite(PIXI.Texture.from("./assets/ui/"+F+".png")));W.x=e-M+2.3,W.y=-10,n.addChild(W);let E=i.leftBottom.split(","),R=E[0],G=(E[1],1*E[2]),B=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/"+R+".png"));B.y=t-G,B.x=-2.3,n.addChild(B);let A=i.rightBottom.split(","),N=A[0],D=1*A[1],H=1*A[2],O=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/"+N+".png"));return O.x=e-D+2.3,O.y=t-H,n.addChild(O),n};closeLogin=()=>{this.mainLogin.visible=!1,this.main.visible=!0,this.mainLogin.removeChildren()};loginPage=()=>{this.loadGame.visible=!1,this.main.visible=!1,this.mainLogin.visible=!0,this.mainLogin.removeChildren();let e=new PIXI.Graphics;e.beginFill(1683704),e.drawRect(0,0,this.gameWidth,this.gameHeight),e.endFill(),this.mainLogin.addChild(e);let t=this.createBackGroundGame();e.addChild(t);let i=new PIXI.Container;i.name="containerLogo",i.y=0,e.addChild(i);let n=.3*this.gameHeight,h=.7*this.gameHeight,a=new PIXI.Container;a.name="containerBox",a.y=n,e.addChild(a);let l=.9*this.gameWidth;l=l>500?500:l;let o=new PIXI.Graphics;o.beginFill(16777215,1e-7),o.drawRect(0,0,l,h),o.endFill(),a.addChild(o);let d=.7*h;d=d>310?310:d;let r=this.createUI(l,d,{leftTop:"x2Main_Image_interface_paper0,28,38",centerTop:"x2Main_Image_interface_paper5,60,16",rightTop:"x2Main_Image_interface_paper450,28,38",leftCenter:"x2Main_Image_interface_paper100,28,20",centerCenter:"x2Main_Image_interface_paper_7,20,16",rightCenter:"x2Main_Image_interface_paper1,28,20",leftBottom:"x2Main_Image_interface_paper2,28,38",centerBottom:"x2Main_Image_interface_paper6,60,16",rightBottom:"x2Main_Image_interface_paper244,28,38",leftPre:"x2Main_Image_interface_paper_4,34,16",rightPre:"x2Main_Image_interface_paper_3,32,16"});o.addChild(r);let s=this.CreateLogo(o.width);s.x=o.width/2-s.width/2,s.y=0+s.height,o.addChild(s),new TWEEN.Tween(s).to({y:0-s.height/2},1e3).easing(TWEEN.Easing.Back.Out).start();let c=new PIXI.Container;r.addChild(c);let g=new PIXI.TextInput({input:{fontSize:"17px",padding:"10px",color:"#7a1125",width:.7*r.width,height:.2*r.height},box:{default:{fill:15647621,rounded:0,stroke:{color:16774891,width:1}},focused:{fill:11006636,rounded:0,stroke:{color:16774891,width:1}},disabled:{fill:14408667,rounded:0}}});g.placeholder="Tên tài khoản",g.text=this.username,c.addChild(g);let p=new PIXI.TextInput({input:{fontSize:"17px",padding:"10px",color:"#7a1125",width:.7*r.width,height:.2*r.height},box:{default:{fill:15647621,rounded:0,stroke:{color:16774891,width:1}},focused:{fill:11006636,rounded:0,stroke:{color:16774891,width:1}},disabled:{fill:14408667,rounded:0}}});p.placeholder="mật khẩu",p.htmlInput.setAttribute("type","password"),p.y=g.height+10,p.text=this.password,c.addChild(p),c.x=0,c.y=(r.height-c.height)/2,new TWEEN.Tween(c).to({x:(r.width-c.width)/2},500).easing(TWEEN.Easing.Bounce.Out).start();let m=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/22359.png")),w=[];for(let e=0;e<3;e++){let t=new PIXI.Texture(m.texture,new PIXI.Rectangle(0,80*e,80,80));w.push(t)}let u=new PIXI.AnimatedSprite(w);u.animationSpeed=.15,u.loop=!0,u.play(),u.width=.2*r.width,u.height=.3*r.height,u.x=(r.width-u.width)/2,u.y=0,a.addChild(u),u.interactive=!0,u.cursor="pointer",u.on("pointerdown",(()=>{this.username=g.text,this.password=p.text,this.connectGame()})),new TWEEN.Tween(u).to({y:r.x+r.height-u.height/2},1e3).easing(TWEEN.Easing.Bounce.Out).start(),a.x=(this.gameWidth-a.width)/2,a.alpha=0,new TWEEN.Tween(a).to({alpha:1},500).easing(TWEEN.Easing.Bounce.Out).start(),i.x=(this.gameWidth-i.width)/2,setTimeout((()=>{this.username.length>=1&&this.connectGame(),setTimeout((()=>{this.duclo("a1")}),400)}),30)}}class Ze extends qe{constructor(){super()}CreateLogo=e=>{let t=new PIXI.Container,i=new PIXI.Text("Thời đại",new PIXI.TextStyle({fontFamily:"Itim-Regular",fontSize:40,fill:16489827,fontWeight:"bold"}));i.resolution=2,i.style.stroke="#591327",i.style.strokeThickness=10;i.width=1*this.gameWidth,i.width=i.width>300?300:i.width,i.width=i.width>.5*this.gameWidth?.5*this.gameWidth:i.width;let n=new PIXI.Text("Hải Tặc",new PIXI.TextStyle({fontFamily:"PottaOne-Regular",fontSize:20,fill:5882473,fontWeight:"bold"}));n.resolution=2,n.style.stroke="#3c4b24",n.style.strokeThickness=6,n.style.dropShadow=!0,n.style.dropShadowColor="#3c4b24",n.style.dropShadowBlur=2,n.style.dropShadowAngle=Math.PI/10,n.style.dropShadowDistance=3,n.y=i.height,n.x=i.width/2-n.width/2;return n.width=1*this.gameWidth,n.width=n.width>100?100:n.width,n.width=n.width>.5*this.gameWidth?.5*this.gameWidth:n.width,t.addChild(n),t.addChild(i),t};WarningViewController=()=>{this.loadGame.visible=!0,this.loadGame.removeChildren();let e=new PIXI.Graphics;this.loadGame.addChild(e),e.beginFill(1683704,1),e.lineStyle(0,5704481,1),e.drawRoundedRect(0,0,this.gameWidth,this.gameHeight,0),e.endFill(),e.interactive=!0;let t=this.createBackGroundGame();e.addChild(t);let i=this.CreateLogo(this.gameWidth);i.x=this.gameWidth/2-i.width/2,i.y=0+.1*i.height;let n=.7*this.gameWidth,h=.6*this.gameHeight;n=n>300?300:n,h=h>400?400:h;let a=new PIXI.Graphics;a.name="menu",a.beginFill(16246719,1),a.drawRect(0,0,n,h),a.endFill(),a.x=(this.gameWidth-n)/2,a.y=i.y+i.height+10,e.addChild(a),a.alpha=0,TweenMax.to(a,1,{alpha:1}),e.addChild(i),i.y=this.gameHeight,new TWEEN.Tween(i).to({y:0+.1*i.height},1e3).easing(TWEEN.Easing.Bounce.Out).start();let l=Math.ceil(h/20);for(let t=0;t<l;t++){let i=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_paper_6.png"));i.x=a.x,i.y=a.y+20*t,i.y+60>a.y+h&&(i.y=a.y+h-60),e.addChild(i)}let o=Math.ceil(h/20);for(let t=0;t<o;t++){let i=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_paper_6.png"));i.x=a.x+n,i.y=a.y+20*t,i.scale.x=-1,i.y+60>a.y+h&&(i.y=a.y+h-60),e.addChild(i)}let d=Math.ceil(n/20);for(let t=0;t<d;t++){let i=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_paper_1.png"));i.anchor.set(.5),i.x=a.x+20*t+10,i.y=a.y,e.addChild(i)}let r=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_paper_2.png"));r.anchor.set(.5),r.x=a.x,r.y=a.y,e.addChild(r);let s=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_paper_2.png"));s.anchor.set(.5),s.x=a.x+n,s.y=a.y,s.scale.x=-1,e.addChild(s);let c=Math.ceil(n/20);for(let t=0;t<c;t++){let i=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_paper_1.png"));i.anchor.set(.5),i.x=a.x+20*t+10,i.y=a.y+h,i.scale.y=-1,e.addChild(i)}let g=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_paper_2.png"));g.anchor.set(.5),g.x=a.x,g.y=a.y+h,g.scale.y=-1,e.addChild(g);let p=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/x2Main_Image_interface_paper_2.png"));p.anchor.set(.5),p.x=a.x+n,p.y=a.y+h,p.scale.x=-1,p.scale.y=-1,e.addChild(p);let m=.9*n,w=.9*h,u=new PIXI.Graphics;u.name="body",u.beginFill(16777215,1e-7),u.drawRect(0,0,m,w),u.endFill(),u.x=a.x+(n-m)/2,u.y=a.y+(h-w)/2,e.addChild(u);let y=new PIXI.Graphics;y.beginFill(16777215,1),y.drawRect(0,0,m,w),y.endFill(),y.x=a.x+(n-m)/2,y.y=a.y+(h-w)/2,u.mask=y,e.addChild(y);let f=' "Của cải, danh tiếng, quyền lực" ! \n';f+="Người có tất cả mọi thứ trên đời là Vua hải tặc God D. Roger.\n \n",f+='"Logue Town" 20 năm về trước, trên đường God D. Roger tới pháp trường, mặc dù hai tay ông ta bị trói chặt, nhưng ông ta vẫn mang trong mình vẻ kiêu hãnh. \n \n',f+='"Như một sự kế thừa, vận mệnh của mỗi thời đại là do con người quyết định, điều này sẽ không bao giờ kết thúc cho đến khi nào loài người vẫn muốn tìm đến tự do" - Gol D. Roger.\n \n',f+='Trước khi chết, Roger đã để lại một câu nói khiến cho cả thế giới phải chấn động: \n \n - "Các ngươi muốn lấy kho báu của ta à ? Có giỏi thì tự đi lấy đi ? Hãy ra biển mà tìm. Ta để kho báu ở ngoài biển hết rồi !". \n \n',f+='Và như vậy, một thời đại mới đã bắt đầu, "Thời đại hải tặc" ! \n \n';let x=new PIXI.Text(f,{fontFamily:"Itim-Regular",fontSize:17,fill:0,fontWeight:"bold",align:"left",wordWrap:!0,wordWrapWidth:m-20});x.y=0;let I=new PIXI.Text("",{fontFamily:"Itim-Regular",fontSize:17,fill:0,fontWeight:"bold",align:"left",wordWrap:!0,wordWrapWidth:m-20});I.x=5,I.y=0;let _=0,b=new pixi_viewport.Viewport({screenWidth:u.width,screenHeight:u.height,worldWidth:x.width,worldHeight:x.height});b.name="viewport",b.drag({direction:"y",pressDrag:!0,factor:1}).decelerate({friction:.95,bounce:.8,minSpeed:.01}).clamp({direction:"y"}),b.bounce({top:!0,bottom:!0,friction:.5,time:.1,ease:"easeInOutSine"}),b.addChild(I),u.addChild(b);let v=setInterval((()=>{_<718?(I.text+=f[_],_++,b.moveCenterY(I.height)):clearInterval(v)}),30),C=new PIXI.Text(this._("Click to continue"),{fontSize:30,fill:16777215,fontFamily:"Arial",wordWrap:!0,wordWrapWidth:this.gameWidth-20,fontWeight:"bold",align:"center"});C.x=.9*this.gameWidth-C.width,C.y=.9*this.gameHeight-C.height,e.addChild(C),C.style.stroke="#3c4b24",C.style.strokeThickness=3,C.style.dropShadow=!0,C.style.dropShadowColor="#3c4b24",C.style.dropShadowBlur=2,C.style.dropShadowAngle=Math.PI/10,C.style.dropShadowDistance=3,TweenMax.to(C,.5,{alpha:0,repeat:-1,yoyo:!0,ease:Power0.easeNone,speed:10,delay:.1}),C.interactive=!0;let P=0;C.on("pointerdown",(()=>{P=Date.now()})),C.on("pointerup",(()=>{Date.now()-P<200&&(clearInterval(v),this.ObjectCreatePageLoading())})),C.cursor="pointer"}}class Je extends Ze{constructor(){super(),this.gameInfo={}}createGameConfig=()=>{this.loadGame.removeChildren();let e=new PIXI.Graphics;this.loadGame.addChild(e),e.beginFill(0,1),e.lineStyle(0,5704481,1),e.drawRoundedRect(0,0,this.gameWidth,this.gameHeight,0),e.endFill(),e.interactive=!0;let t=new PIXI.Text("Đang tải cấu hình cơ bản...",{fontFamily:"Arial",fontSize:16,fill:16777215,fontWeight:"bold",align:"center"});t.x=this.gameWidth/2-t.width/2,t.y=this.gameHeight/2-t.height/2;let i=new PIXI.Text(".",{fontFamily:"Arial",fontSize:16,fill:16777215,fontWeight:"bold",align:"center"});i.x=this.gameWidth/2-i.width/2,i.y=t.y+t.height,i.name="txt2",this.loadGame.addChild(t,i);let n=0,h=setInterval((()=>{0==n&&(i.text="."),1==n&&(i.text=".."),2==n&&(i.text="..."),n++,3==n&&(n=0)}),300),a=new XMLHttpRequest;a.open("GET","./config.json?date="+Date.now(),!0),a.send(),a.onreadystatechange=()=>{if(4==a.readyState&&200==a.status){let e=JSON.parse(a.response);for(let t in e)"object"==typeof e?console.log(e[t]):console.log(t+" : "+e[t]);this.gameInfo.version=e.version,this.gameInfo.timeloadWelcome=e.time,this.gameInfo.server=e.server,this.gameInfo.gameName=e.name,this.gameInfo.name=e.nameDEV,this.gameInfo.debug=e.debug,this.gameInfo.login=e.login,this.gameInfo.debug,this.ConnectToServer();let i=[];this.gameInfo.font=[];for(let t in e.font){let n="./assets/font/"+(e.font[t].length>=1?e.font[t]:t)+".ttf";this.gameInfo.font.push(t),i.push({name:t,url:n})}let n=()=>{let e=(e,t)=>new Promise(((i,n)=>{new FontFace(e,"url("+t+")").load().then((e=>{document.fonts.add(e),i()}))})),n=[],h=Date.now();for(let t in i)n.push(e(i[t].name,i[t].url));Promise.all(n).then((e=>{this.packageCombo(t,h),console.log("LoadFont ("+i.length+") packge : "+(Date.now()-h)+"ms")}))};n()}4==a.readyState&&200!=a.status&&(clearInterval(h),alert("Không thể đọc file dữ liệu của trò chơi"))}};packageCombo=(e,t)=>{let i=["ao","camtay","face","lung","non","quan","toc","sprite","base","map","npc","quai","skin"],n=t=>new Promise(((n,h)=>{let a=t;t="./assets/json/"+t+".json?v="+this.gameInfo.version,e.text="Đang tải gói cơ bản: "+a,e.x=this.gameWidth/2-e.width/2;let l=new XMLHttpRequest;l.open("GET",t,!0),l.onload=()=>{if(4==l.readyState&&200==l.status){let e=JSON.parse(l.responseText);"combo"==a?this.spriteComBo=e:"map"==a?this.assets=e:this.images=this.images.concat(e),n()}else h(),alert("Can not load package:"+i[0]+". Please reload page or contact admin in forum.")},l.send()})),h=[];for(let e=0;e<i.length;e++)h.push(n(i[e]));let a=Date.now();Promise.all(h).then((()=>{console.log("loading package ("+i.length+") time: "+(Date.now()-a)+"ms"),this.CreateFontLogin(),clearInterval(t)}))};fontSize=(e,t)=>{let i=0;return i=t/(e.width/e.height),e.style.fontSize=i,e};CreateFontLogin=()=>{this.loadGame.removeChildren();let e=new PIXI.Graphics;this.loadGame.addChild(e),e.beginFill(0,1),e.lineStyle(0,5704481,1),e.drawRoundedRect(0,0,this.gameWidth,this.gameHeight,0),e.endFill(),e.interactive=!0;let t=new PIXI.Container;this.loadGame.addChild(t),this.gameInfo.font,t.visible=!1;let i=new PIXI.Text(this.gameInfo.name,{fontFamily:"Itim-Regular",fontSize:50,fill:16777215,fontWeight:"bold",align:"center"}),n=.7*this.gameWidth;n=n>350?350:n,i=this.fontSize(i,n),i.x=0,i.y=this.gameHeight/2-i.height,this.loadGame.addChild(i);let h=this;if(1==this.gameInfo.debug)return h.ObjectCreatePageLoading(),!1;new TWEEN.Tween(i).to({x:this.gameWidth/2-i.width/2},1e3).easing(TWEEN.Easing.Bounce.Out).onComplete((()=>{let e="For everyone, for all platforms",t=new PIXI.Text(e,{fontFamily:"Itim-Regular",fontSize:15,fill:16777215,fontWeight:"bold",align:"center"});t.x=i.x,t.y=i.y+i.height,t=this.fontSize(t,.5*i.width),this.loadGame.addChild(t),t.visible=!1;let n="Fast, lightweight, smooth, and exciting ^_^",a=new PIXI.Text(n,{fontFamily:"Itim-Regular",fontSize:15,fill:16777215,fontWeight:"bold",align:"center"});a.x=i.x,a.y=i.y+i.height,a=this.fontSize(a,.5*i.width),this.loadGame.addChild(a),a.visible=!1;let l=0,o=new PIXI.Text("",{fontFamily:"Itim-Regular",fontSize:15,fill:16777215,fontWeight:"bold",align:"center"});o.x=t.x,o.y=t.y,o.style.fontSize=t.style.fontSize,this.loadGame.addChild(o);let d=()=>{l=0,o.x=a.x,o.y=a.y,o.style.fontSize=a.style.fontSize;let e=setInterval((()=>{l<43?(o.text+=n[l],l++):(clearInterval(e),setTimeout((()=>{h.WarningViewController()}),300))}),this.gameInfo.timeloadWelcome)},r=()=>{let e=setInterval((()=>{let t=o.text;t.length>=1?o.text=t.substring(0,t.length-1):(clearInterval(e),d())}),this.gameInfo.timeloadWelcome)};(()=>{let t=setInterval((()=>{l<31?(o.text+=e[l],l++):(clearInterval(t),setTimeout((()=>{r()}),300))}),this.gameInfo.timeloadWelcome)})();let s=new PIXI.HTMLText('<font color="white">Made with</font> <a href="https://pixijs.com/"><font color="e72264"><b>PixiJS</b></font></a> ',{fontFamily:"Arial",fontSize:16,fontWeight:"bold",align:"center"});s.y=i.height+i.y,s.x=i.width+i.x-s.width+10,this.loadGame.addChild(s),s.alpha=0,TweenMax.to(s,1,{alpha:1,onComplete:()=>{}})})).start();let a=new PIXI.Text("Client v. "+this.gameInfo.version,{fontFamily:"Arial",fontSize:14,fill:16777215,fontWeight:"bold",align:"center"});a.y=this.gameHeight-a.height-10,a.x=10,this.loadGame.addChild(a);let l=new PIXI.Text("Since04",{fontFamily:"Arial",fontSize:9,fill:16777215,fontWeight:"bold",align:"center"});l.y=this.gameHeight-l.height-5,l.x=this.gameWidth-l.width-30,this.loadGame.addChild(l);let o=new PIXI.Text("PixiJS v. "+PIXI.VERSION,{fontFamily:"Arial",fontSize:14,fill:16777215,fontWeight:"bold",align:"center"});o.y=a.y-o.height,o.x=10,this.loadGame.addChild(o)};ObjectCreatePageLoading=()=>{this.loadGame.removeChildren();let e=new PIXI.Graphics;e.beginFill(1683704),e.drawRect(0,0,this.gameWidth,this.gameHeight),e.endFill(),e.x=0,e.y=0,e.alpha=1,e.visible=!0;let t=this.CreateLogo(e.width);t.x=e.width/2-t.width/2,t.y=.5*e.height-t.height-10,e.addChild(t);let i=new PIXI.Text("Đang tiến vào biển cả...",{fontFamily:"Arial",fontSize:16,fill:0,fontWeight:"bold"});i.x=this.gameWidth/100*50-i.width/100*50,i.y=this.gameHeight/100*50-i.height/100*50+t.height/100*50+20;let n=["Cấp kĩ năng càng cao, càng mạnh"],h=new PIXI.Text(n[Math.floor(Math.random()*n.length)],{fontFamily:"Arial",fontSize:16,fill:10301744,fontWeight:"bold"});h.name="bgLoadTip",h.x=this.gameWidth/100*50-h.width/100*50,h.y=this.gameHeight/100*50-h.height/100*50+t.height/100*50+20+i.height/100*50+20;let a=this.createBackGroundGame();this.loadGame.addChild(e,a,i,h),this.loadGame.visible=!0;let l=new PIXI.Sprite(PIXI.Texture.from("./assets/ui/22359.png")),o=[];for(let e=0;e<3;e++){let t=new PIXI.Texture(l.texture,new PIXI.Rectangle(0,80*e,80,80));o.push(t)}let d=new PIXI.AnimatedSprite(o);d.animationSpeed=.15,d.loop=!0,d.play();let r=.2*this.gameWidth,s=.2*this.gameHeight;r=r>80?80:r,s=s>80?80:s,d.width=r,d.height=s,d.x=this.gameWidth-d.width-d.width,d.y=this.gameHeight-d.height-d.height,this.loadGame.addChild(d);let c=new PIXI.Text("Đang tải 0%",{fontFamily:"Arial",fontSize:16,fill:16711680,fontWeight:"bold"});c.x=this.gameWidth/2-c.width/2,c.y=h.y+h.height+20,c.name="txtLoadgame",this.loadGame.addChild(c),c.visible=!1,0==this.my.id&&this.loginPage()}}class Qe extends Je{constructor(){super(),this.assets=[]}loadAssets=()=>this.createGameConfig();loadAssetMap=()=>{let e=e=>new Promise(((t,i)=>{let n=new XMLHttpRequest;n.open("GET","./assets/"+e+".json"),n.onload=()=>{if(n.status<400){try{let e=JSON.parse(n.responseText);e&&e.forEach((e=>{this.assets.push(e)}))}catch(e){}t("true")}},n.send()}));Promise.all(["map"].map((t=>e(t)))).then((e=>{}))}}let $e=new class extends Qe{constructor(){super(),this.loadAssets()}};window.game=$e})();